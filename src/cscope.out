cscope 15 /home/pxw/osdldbt-dbt2/src -q 0000001091 0000219444
	@_semaphore.c

13 
	~<_£m­hÜe.h
>

14 
	~<”ºo.h
>

16 #ià!
defšed
(
HAVE_SEMAPHORE_H
è|| defšed(
BROKEN_SEMAPHORES
)

18 
	$£m_š™
(
£m_t
 * 
£m
, 
psh¬ed
, 
v®ue
)

20 
£m
->
couÁ
=
v®ue
;

21 
	`±h»ad_cÚd_š™
(&
£m
->
cÚd
, 0);

22 
	`±h»ad_mu‹x_š™
(&
£m
->
mu‹x
, 0);

24 
	}
}

26 
	$£m_de¡roy
(
£m_t
 * 
£m
)

28 
”r1
,
”r2
;

29 
”r1
=
	`±h»ad_cÚd_de¡roy
(&
£m
->
cÚd
);

30 
”r2
=
	`±h»ad_mu‹x_de¡roy
(&
£m
->
mu‹x
);

31 ià(
”r1
 || 
”r2
)

33 
”ºo
=
”r1
 ?ƒ¼1 : 
”r2
;

37 
	}
}

39 
	$£m_wa™
(
£m_t
 * 
£m
)

41 ià((
”ºo
=
	`±h»ad_mu‹x_lock
(&
£m
->
mu‹x
)))

43 !
£m
->
couÁ
)

44 
	`±h»ad_cÚd_wa™
(&
£m
->
cÚd
, &£m->
mu‹x
);

45 ià(
”ºo
)

47 
£m
->
couÁ
--;

48 
	`±h»ad_mu‹x_uÆock
(&
£m
->
mu‹x
);

50 
	}
}

52 
	$£m_Œywa™
(
£m_t
 * 
£m
)

54 ià((
”ºo
=
	`±h»ad_mu‹x_lock
(&
£m
->
mu‹x
)))

56 ià(
£m
->
couÁ
)

57 
£m
->
couÁ
--;

59 
”ºo
=
EAGAIN
;

60 
	`±h»ad_mu‹x_uÆock
(&
£m
->
mu‹x
);

61  
”ºo
 ? -1 : 0;

62 
	}
}

65 
	$£m_po¡
(
£m_t
 * 
£m
)

67 ià((
”ºo
=
	`±h»ad_mu‹x_lock
(&
£m
->
mu‹x
)))

69 
£m
->
couÁ
++;

70 
	`±h»ad_mu‹x_uÆock
(&
£m
->
mu‹x
);

71 
	`±h»ad_cÚd_sigÇl
(&
£m
->
cÚd
);

73 
	}
}

75 
	$£m_po¡_muÉË
(
£m_t
 * 
£m
, 
couÁ
)

77 ià((
”ºo
=
	`±h»ad_mu‹x_lock
(&
£m
->
mu‹x
)))

79 
£m
->
couÁ
+=count;

80 
	`±h»ad_mu‹x_uÆock
(&
£m
->
mu‹x
);

81 
	`±h»ad_cÚd_brßdÿ¡
(&
£m
->
cÚd
);

83 
	}
}

85 
	$£m_g‘v®ue
(
£m_t
 * 
£m
, *
sv®
)

87 ià((
”ºo
=
	`±h»ad_mu‹x_lock
(&
£m
->
mu‹x
)))

89 *
sv®
=
£m
->
couÁ
;

90 
	`±h»ad_mu‹x_uÆock
(&
£m
->
mu‹x
);

92 
	}
}

	@_socket.c

11 
	~<¡dio.h
>

12 
	~<¡ršg.h
>

13 
	~<uni¡d.h
>

14 
	~<¡ršgs.h
>

16 
	~"_sock‘.h
"

18 #iâdeà
INADDR_NONE


19 
	#INADDR_NONE
 -1

	)

22 
»sŞv•rÙo
(cÚ¡ *
´Ùo
);

24 
	$_acû±
(*
s
)

26 
sockËn_t
 
add¾’
;

27 
sockaddr_š
 
§
;

28 
sockfd
;

30 
add¾’
 = (
sockaddr_š
);

31 
sockfd
 = 
	`acû±
(*
s
, (
sockaddr
 *è&
§
, &
add¾’
);

32 ià(
sockfd
 == -1)

34 
	`³¼Ü
("_accept");

35 
	`´štf
("Can't‡ccept driver connection,…ossible„easons may be\n");

36 
	`´štf
("thathe‚umber of‡llowed open files may beƒxceeded.\n");

37 
	`´štf
("This could be†imited byhe operating system or byhe\n");

38 
	`´štf
("user's security†imits.\n");

40  
sockfd
;

41 
	}
}

43 
	$_cÚÃù
(*
add»ss
, 
pÜt
) {

44 
sockfd
 = -1;

45 
sockaddr_š
 
§
;

46 
ho¡’t
 *
he
;

47 
š_addr_t
 
addr
;

49 
	`bz”o
(&
§
, (
sockaddr_š
));

51 
§
.
sš_çmy
 = 
AF_INET
;

52 
§
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

53 ià(
§
.
sš_pÜt
 == 0) {

54 
	`´štf
("Please specify…ort on which client†isten for„equest\n");

59 
addr
 = 
	`š‘_addr
(
add»ss
);

60 ià(
addr
 =ğ
INADDR_NONE
) {

62 ià((
he
 = 
	`g‘ho¡byÇme
(
add»ss
)è=ğ
NULL
) {

63 
	`şo£
(
sockfd
);

64 
	`´štf
("specify correct hostname of system where client is„unning: %s\n",

65 
add»ss
);

70 ià((
he
 = 
	`g‘ho¡byaddr
((*è(&
addr
), (addr),

71 
AF_INET
)è=ğ
NULL
) {

72 
	`şo£
(
sockfd
);

73 
	`´štf
("Please specify correct IP of box where client„unning\n");

76 
	`memıy
(&
§
.
sš_addr
, &
addr
, (addr));

78 
	`memıy
(&
§
.
sš_addr
, 
he
->
h_addr_li¡
[0], he->
h_Ëngth
);

80 
sockfd
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 
	`»sŞv•rÙo
("tcp"));

81 ià(
sockfd
 == -1) {

82 
	`´štf
("Can't create socket for connectiono client\n");

83  
sockfd
;

86 ià(
	`cÚÃù
(
sockfd
, (
sockaddr
 *è&
§
,

87 (
sockaddr_š
)) == -1) {

88 
	`³¼Ü
("connect");

89 
	`´štf
("Can't connecto client socket\n");

93  
sockfd
;

94 
	}
}

96 
	$_»ûive
(
s
, *
d©a
, 
Ëngth
)

98 
»ûived
, 
tÙ®
, 
»maššg
;

99 
»maššg
 = 
Ëngth
;

100 
tÙ®
 = 0;

102 
»ûived
 = 
	`»cv
(
s
, 
d©a
, 
»maššg
, 0);

103 ià(
»ûived
 == -1) {

104 
	`³¼Ü
("recv");

106 } ià(
»ûived
 == 0) {

109 
tÙ®
 +ğ
»ûived
;

110 
d©a
 +ğ
»ûived
;

111 
»maššg
 -ğ
»ûived
;

113 
tÙ®
 !ğ
Ëngth
);

114  
tÙ®
;

115 
	}
}

117 
	$_£nd
(
s
, *
d©a
, 
Ëngth
)

119 
£Á
 = 0;

120 
»maššg
 = 
Ëngth
;

122 
£Á
 = 
	`£nd
(
s
, (*è
d©a
, 
»maššg
, 0);

123 ià(
£Á
 == -1) {

125 } ià(
£Á
 == 0) {

128 
d©a
 +ğ
£Á
;

129 
»maššg
 -ğ
£Á
;

130 } 
£Á
 !ğ
Ëngth
);

131  
£Á
;

132 
	}
}

134 
	$_li¡’
(
pÜt
)

136 
sockaddr_š
 
§
;

137 
v®
;

138 
sockfd
;

140 
v®
= 1;

142 
	`bz”o
(&
§
, (
sockaddr_š
));

143 
§
.
sš_çmy
 = 
AF_INET
;

144 
§
.
sš_addr
.
s_addr
 = 
INADDR_ANY
;

145 
§
.
sš_pÜt
 = 
	`htÚs
((è
pÜt
);

147 
sockfd
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 
	`»sŞv•rÙo
("TCP"));

148 ià(
sockfd
 < 0) {

149 
	`³¼Ü
("_listen");

150  
ERR_SOCKET_CREATE
;

153 
	`£tsockİt
(
sockfd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
v®
,  (val));

155 ià(
	`bšd
(
sockfd
, (
sockaddr
 *)&
§
,

156 (
sockaddr_š
)) < 0) {

157 
	`³¼Ü
("_listen");

158  
ERR_SOCKET_BIND
;

161 ià(
	`li¡’
(
sockfd
, 1) < 0) {

162 
	`³¼Ü
("_listen");

163  
ERR_SOCKET_LISTEN
;

165  
sockfd
;

166 
	}
}

168 
	$»sŞv•rÙo
(cÚ¡ *
´Ùo
)

170 
´ÙÛÁ
 *
´ÙocŞ
;

172 
´ÙocŞ
 = 
	`g‘´ÙobyÇme
(
´Ùo
);

173 ià(!
´ÙocŞ
) {

174  
ERR_SOCKET_RESOLVPROTO
;

177  
´ÙocŞ
->
p_´Ùo
;

178 
	}
}

	@client.c

10 #ifdeà
HAVE_CONFIG_H


11 
	~<cÚfig.h
>

14 
	~<¡dio.h
>

15 
	~<uni¡d.h
>

16 
	~<¡ršg.h
>

17 
	~<g‘İt.h
>

18 
	~<”ºo.h
>

20 
	~<±h»ad.h
>

22 
	~"commÚ.h
"

23 
	~"loggšg.h
"

24 
	~"db_th»adpoŞ.h
"

25 
	~"li¡’”.h
"

26 
	~"_sock‘.h
"

27 
	~"Œª§ùiÚ_queue.h
"

30 
·r£_¬gum’ts
(
¬gc
, *
¬gv
[]);

31 
·r£_commªd
(*
commªd
);

34 
	g¢ame
[32] = "";

35 
	gdÇme
[32] = "";

36 
	gpÜt
 = 
CLIENT_PORT
;

37 
	gsockfd
;

38 
	gex™šg
 = 0;

39 
	gfÜû_¦“p
 = 0;

41 #ià
defšed
(
LIBMYSQL
è|| defšed(
ODBC
è|| defšed(
LIBDRIZZLE
)

42 
	gdbt2_u£r
[128] = 
DB_USER
;

43 
	gdbt2_·ss
[128] = 
DB_PASS
;

46 #ifdeà
LIBPQ


47 
	gpo¡ma¡”_pÜt
[32] = "5432";

50 #ifdeà
LIBMYSQL


51 
	gdbt2_mysql_ho¡
[128];

52 
	gdbt2_mysql_pÜt
[32];

53 
	gdbt2_mysql_sock‘
[256];

56 #ifdeà
LIBDRIZZLE


57 
	gdbt2_drizzË_ho¡
[128];

58 
	gdbt2_drizzË_pÜt
[32];

59 
	gdbt2_drizzË_sock‘
[256];

62 
¡¬tup
();

64 
	$maš
(
¬gc
, *
¬gv
[])

66 
couÁ
;

67 
commªd
[128];

69 
	`š™_commÚ
();

71 ià(
	`·r£_¬gum’ts
(
¬gc
, 
¬gv
è!ğ
OK
) {

72 
	`´štf
("u§ge: % -d <db_Çme> -ø# [-°#]\n", 
¬gv
[0]);

73 
	`´štf
("\n");

74 
	`´štf
("-f\n");

75 
	`´štf
("\tset force sleep\n");

76 
	`´štf
("-c #\n");

77 
	`´štf
("\tnumber of database connections\n");

78 
	`´štf
("-p #\n");

79 
	`´štf
("\tporto†isten for incoming connections, default %d\n",

80 
CLIENT_PORT
);

81 #ifdeà
ODBC


82 
	`´štf
("-d <db_name>\n");

83 
	`´štf
("\tdatabase connect string\n");

85 #ifdeà
LIBPQ


86 
	`´štf
("-d <hostname>\n");

87 
	`´štf
("\tdatabase hostname\n");

88 
	`´štf
("-l #\n");

89 
	`´štf
("\tpostmaster…ort\n");

90 
	`´štf
("-b <dbname>\n");

91 
	`´štf
("\tdatabase‚ame\n");

93 #ifdeà
LIBMYSQL


94 
	`´štf
("-h <hostname of mysql server>\n");

95 
	`´štf
("\tname of host where mysql server is„unning\n");

96 
	`´štf
("-d <db_name>\n");

97 
	`´štf
("\tdatabase‚ame\n");

98 
	`´štf
("-l #\n");

99 
	`´štf
("\tport‚umbero use for connectiono mysql server\n");

100 
	`´štf
("-t <socket>\n");

101 
	`´štf
("\tsocket for connectiono mysql server\n");

103 #ifdeà
LIBDRIZZLE


104 
	`´štf
("-h <hostname of drizzle server>\n");

105 
	`´štf
("\tname of host where drizzle server is„unning\n");

106 
	`´štf
("-d <db_name>\n");

107 
	`´štf
("\tdatabase‚ame\n");

108 
	`´štf
("-l #\n");

109 
	`´štf
("\tport‚umbero use for connectiono drizzle server\n");

110 
	`´štf
("-t <socket>\n");

111 
	`´štf
("\tsocket for connectiono drizzle server\n");

113 
	`´štf
("-s #\n");

114 
	`´štf
("\tsecondso sleep between openning db connections, default 1 s\n");

115 #ià
	`defšed
(
LIBMYSQL
è|| defšed(
ODBC
è|| defšed (
LIBDRIZZLE
)

116 
	`´štf
("-u <db user>\n");

117 
	`´štf
("-a <db…assword>\n");

119 #ifdeà
LIBSQLITE


120 
	`´štf
("-d <db_file>\n");

121 
	`´štf
("\tpatho database file\n");

127 ià(
	`¡¾’
(
¢ame
) == 0) {

128 
	`´štf
("-d‚ot used\n");

131 ià(
db_cÚÃùiÚs
 == 0) {

132 
	`´štf
("-c‚ot used\n");

136 #ià
	`defšed
(
LIBMYSQL
è|| defšed(
ODBC
è|| defšed(
LIBDRIZZLE
)

137 
	`´štf
("U£¸% Pas %s\n", 
dbt2_u£r
, 
dbt2_·ss
);

141 
	`š™_loggšg
();

143 
	`´štf
("İ’šg %d cÚÃùiÚ(sètØ%s...\n", 
db_cÚÃùiÚs
, 
¢ame
);

144 ià(
	`¡¬tup
(è!ğ
OK
) {

145 
	`LOG_ERROR_MESSAGE
("startup() failed\n");

146 
	`´štf
("startup() failed\n");

149 
	`´štf
("client has started\n");

151 
	`´štf
("%d DB wÜk”h»ad hav¡¬‹d\n", 
db_cÚÃùiÚs
);

152 
	`fæush
(
¡dout
);

153 
	`ü—‹_pid_fe
();

157 ià(
fÜû_¦“p
 == 1) {

158 
	`¦“p
(600);

161 
	`sÿnf
("%s", 
commªd
);

162 ià(
	`·r£_commªd
(
commªd
è=ğ
EXIT_CODE
) {

167 
	`´štf
("closing socket...\n");

168 
	`şo£
(
sockfd
);

169 
	`´štf
("waiting forhreadsoƒxit... [NOT!]\n");

175 
	`ex™
(0);

178 
	`£m_g‘v®ue
(&
db_wÜk”_couÁ
, &
couÁ
);

179 
	`¦“p
(1);

180 } 
couÁ
 > 0);

183 
	`´štf
("exiting...\n");

186 
	}
}

188 
	$·r£_¬gum’ts
(
¬gc
, *
¬gv
[])

190 
c
;

192 ià(
¬gc
 < 3) {

193  
ERROR
;

197 
İtiÚ_šdex
 = 0;

198 
İtiÚ
 
lÚg_İtiÚs
[] = {

202 
c
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "c:d:b:l:o:p:s:t:h:u:a:f",

203 
lÚg_İtiÚs
, &
İtiÚ_šdex
);

204 ià(
c
 == -1) {

208 
c
) {

212 
db_cÚÃùiÚs
 = 
	`©oi
(
İrg
);

215 
	`¡rıy
(
¢ame
, 
İrg
);

218 
	`¡rıy
(
dÇme
, 
İrg
);

221 
fÜû_¦“p
=1;

224 #ià
	`defšed
(
LIBPQ
)

225 
	`¡rıy
(
po¡ma¡”_pÜt
, 
İrg
);

227 #ià
	`defšed
(
LIBMYSQL
)

228 
	`¡rıy
(
dbt2_mysql_pÜt
, 
İrg
);

230 #ià
	`defšed
(
LIBDRIZZLE
)

231 
	`¡rıy
(
dbt2_drizzË_pÜt
, 
İrg
);

236 #ià
	`defšed
(
LIBMYSQL
)

237 
	`¡rıy
(
dbt2_mysql_ho¡
, 
İrg
);

239 #ià
	`defšed
(
LIBDRIZZLE
)

240 
	`¡rıy
(
dbt2_drizzË_ho¡
, 
İrg
);

245 
	`¡rıy
(
ouut_·th
, 
İrg
);

248 
pÜt
 = 
	`©oi
(
İrg
);

251 
db_cÚn_¦“p
 = 
	`©oi
(
İrg
);

254 #ià
	`defšed
(
LIBMYSQL
)

255 
	`¡rıy
(
dbt2_mysql_sock‘
, 
İrg
);

258 #ià
	`defšed
(
LIBMYSQL
è|| defšed(
ODBC
è|| defšed(
LIBDRIZZLE
)

260 
	`¡ºıy
(
dbt2_u£r
, 
İrg
, 127);

263 
	`¡ºıy
(
dbt2_·ss
, 
İrg
, 127);

267 
	`´štf
("?? g‘İˆ»tuºed ch¬aù” cod0%Ø??\n", 
c
);

271  
OK
;

272 
	}
}

274 
	$·r£_commªd
(*
commªd
)

276 
i
, 
j
;

277 
couÁ
;

278 
¡©s
[2][
TRANSACTION_MAX
];

280 ià(
	`¡rcmp
(
commªd
, "status") == 0) {

281 
time_t
 
cu¼’t_time
;

282 
	`´štf
("------\n");

283 
	`£m_g‘v®ue
(&
queue_Ëngth
, &
couÁ
);

284 
	`´štf
("Œª§ùiÚ wa™šg = %d\n", 
couÁ
);

285 
	`£m_g‘v®ue
(&
db_wÜk”_couÁ
, &
couÁ
);

286 
	`´štf
("db cÚÃùiÚ ğ%d\n", 
couÁ
);

287 
	`£m_g‘v®ue
(&
li¡’”_wÜk”_couÁ
, &
couÁ
);

288 
	`´štf
("‹rmš® cÚÃùiÚ ğ%d\n", 
couÁ
);

289 
i
 = 0; i < 2; i++) {

290 
j
 = 0; j < 
TRANSACTION_MAX
; j++) {

291 
	`±h»ad_mu‹x_lock
(

292 &
mu‹x_Œª§ùiÚ_couÁ”
[
i
][
j
]);

293 
¡©s
[
i
][
j
] = 
Œª§ùiÚ_couÁ”
[i][j];

294 
	`±h»ad_mu‹x_uÆock
(

295 &
mu‹x_Œª§ùiÚ_couÁ”
[
i
][
j
]);

298 
	`´štf
("transaction queuedƒxecuting\n");

299 
	`´štf
("------------ ------ ---------\n");

300 
i
 = 0; i < 
TRANSACTION_MAX
; i++) {

301 
	`´štf
("%12  %6d %9d\n", 
Œª§ùiÚ_Çme
[
i
],

302 
¡©s
[
REQ_QUEUED
][
i
], sts[
REQ_EXECUTING
][i]);

304 
	`´štf
("------------ ------ ---------\n");

305 
	`´štf
("------ ------------ --------\n");

306 
	`´štf
("Thread Transactions Last (s)\n");

307 
	`´štf
("------ ------------ --------\n");

308 
	`time
(&
cu¼’t_time
);

309 
i
 = 0; i < 
db_cÚÃùiÚs
; i++) {

310 
	`´štf
("%6d %12d %8d\n", 
i
, 
wÜk”_couÁ
[i],

311 (è(
cu¼’t_time
 - 
Ï¡_txn
[
i
]));

313 
	`´štf
("------ ------------ --------\n");

314 } ià(
	`¡rcmp
(
commªd
, "exit") == 0 ||

315 
	`¡rcmp
(
commªd
, "quit") == 0) {

316 
ex™šg
 = 1;

317  
EXIT_CODE
;

318 } ià(
	`¡rcmp
(
commªd
, "help") == 0 || strcmp(command, "?") == 0) {

319 
	`´štf
("help or ?\n");

320 
	`´štf
("status\n");

321 
	`´štf
("exit or quit\n");

323 
	`´štf
("unknowÀcommªd: %s\n", 
commªd
);

325  
OK
;

326 
	}
}

328 
	$¡¬tup
()

330 
±h»ad_t
 
tid
;

331 
»t
;

333 
	`´štf
("li¡’šg oÀpÜˆ'%d'\n", 
pÜt
);

334 
	`fæush
(
¡dout
);

335 
sockfd
 = 
	`_li¡’
(
pÜt
);

336 ià(
sockfd
 < 1) {

337 
	`´štf
("_li¡’(èçed oÀpÜˆ%d\n", 
pÜt
);

338  
ERROR
;

340 ià(
	`š™_Œª§ùiÚ_queue
(è!ğ
OK
) {

341 
	`LOG_ERROR_MESSAGE
("init_transaction_queue() failed");

342  
ERROR
;

344 
»t
 = 
	`±h»ad_ü—‹
(&
tid
, 
NULL
, &
š™_li¡’”
, &
sockfd
);

345 ià(
»t
 != 0) {

346 
	`LOG_ERROR_MESSAGE
(

348 ià(
»t
 =ğ
EAGAIN
) {

349 
	`LOG_ERROR_MESSAGE
("notƒnough system„esources");

351  
ERROR
;

353 
	`´štf
("li¡’šgØpÜˆ%d\n", 
pÜt
);

355 ià(
	`db_th»adpoŞ_š™
(è!ğ
OK
) {

356 
	`LOG_ERROR_MESSAGE
("db_thread_pool_init() failed");

357  
ERROR
;

360  
OK
;

361 
	}
}

363 
	$ü—‹_pid_fe
()

365 
FILE
 * 
åid
;

366 
pid_f’ame
[1024];

368 
	`¥rštf
(
pid_f’ame
, "%s%s", 
ouut_·th
, 
CLIENT_PID_FILENAME
);

370 
åid
 = 
	`fİ’
(
pid_f’ame
,"w");

371 ià(!
åid
)

373 
	`´štf
("ÿÂ'ˆü—‹…id fe: %s\n", 
pid_f’ame
);

374  
ERROR
;

377 
	`årštf
(
åid
,"%d", (è
	`g‘pid
());

378 
	`fşo£
(
åid
);

380  
OK
;

381 
	}
}

	@client_interface.c

10 
	~<commÚ.h
>

11 
	~<loggšg.h
>

12 
	~<ş›Á_š‹rçû.h
>

13 
	~<_sock‘.h
>

15 
	$cÚÃù_to_ş›Á
(*
addr
, 
pÜt
)

17 
sockfd
;

19 
sockfd
 = 
	`_cÚÃù
(
addr
, 
pÜt
);

21  
sockfd
;

22 
	}
}

24 
	$»ûive_Œª§ùiÚ_d©a
(
s
, 
ş›Á_Œª§ùiÚ_t
 *
ş›Á_d©a
)

26 
Ëngth
;

28 
Ëngth
 = 
	`_»ûive
(
s
, 
ş›Á_d©a
, (
ş›Á_Œª§ùiÚ_t
));

29 ià(
Ëngth
 == -1) {

30 
	`LOG_ERROR_MESSAGE
("cannot„eceive interaction data");

31  
ERROR
;

32 } ià(
Ëngth
 == 0) {

33 
	`LOG_ERROR_MESSAGE
("socket closed on _receive");

34  
ERROR_SOCKET_CLOSED
;

35 } ià(
Ëngth
 !ğ(
ş›Á_Œª§ùiÚ_t
)) {

36 
	`LOG_ERROR_MESSAGE
("did‚ot„eceive‡ll data");

37  
ERROR
;

40  
Ëngth
;

41 
	}
}

43 
	$£nd_Œª§ùiÚ_d©a
(
s
, 
ş›Á_Œª§ùiÚ_t
 *
ş›Á_d©a
)

45 
Ëngth
;

47 
Ëngth
 = 
	`_£nd
(
s
, (*è
ş›Á_d©a
,

48 (
ş›Á_Œª§ùiÚ_t
));

49 ià(
Ëngth
 == -1) {

50 
	`LOG_ERROR_MESSAGE
("cannot sendransaction data");

51  
ERROR
;

52 } ià(
Ëngth
 == 0) {

53 
	`LOG_ERROR_MESSAGE
("socket closed on _send");

54  
ERROR_SOCKET_CLOSED
;

55 } ià(
Ëngth
 !ğ(
ş›Á_Œª§ùiÚ_t
)) {

56 
	`LOG_ERROR_MESSAGE
("did‚ot send‡ll data");

57  
ERROR
;

60  
Ëngth
;

61 
	}
}

	@common.c

13 
	~<±h»ad.h
>

14 
	~<¡d¬g.h
>

15 
	~<m©h.h
>

16 
	~<¡ršg.h
>

17 
	~<commÚ.h
>

18 
	~<Œª§ùiÚ_d©a.h
>

20 
	gouut_·th
[256] = "";

21 
	ga_¡ršg_ch¬
[
A_STRING_CHAR_LEN
];

22 cÚ¡ *
	gn_¡ršg_ch¬
 = "0123456789";

23 cÚ¡ *
	gl_¡ršg_ch¬
 =

26 cÚ¡ *
	gc_Ï¡_syl
[
C_LAST_SYL_MAX
] =

32 cÚ¡ 
	gŒª§ùiÚ_shÜt_Çme
[
TRANSACTION_MAX
] =

35 *
	gŒª§ùiÚ_Çme
[
TRANSACTION_MAX
] =

43 
bË_ÿrdš®™y_t
 
	gbË_ÿrdš®™y
;

45 
	$difáimev®
(
timev®
 
¹1
, timev® 
¹0
)

47  (
¹1
.
tv_£c
 - 
¹0
.tv_sec) +

48 (è(
¹1
.
tv_u£c
 - 
¹0
.tv_usec) / 1000000.00;

49 
	}
}

52 
	$g‘_a_¡ršg
(*
a_¡ršg
, 
x
, 
y
)

54 
Ëngth
;

55 
i
;

57 
Ëngth
 = 
x
 + 
	`g‘_¿ndom
(
y
 - x + 1) + 1;

58 
a_¡ršg
[
Ëngth
 - 1] = '\0';

60 
i
 = 0; i < 
Ëngth
 - 1; i++)

62 
a_¡ršg
[
i
] = 
a_¡ršg_ch¬
[
	`g‘_¿ndom
(
A_STRING_CHAR_LEN
 - 1)];

66 
	}
}

69 
	$g‘_c_Ï¡
(*
c_Ï¡
, 
i
)

71 
tmp
[4];

73 
c_Ï¡
[0] = '\0';

75 ià(
i
 < 0 || i > 999)

77  
ERROR
;

81 
	`¥rštf
(
tmp
, "%03d", 
i
);

83 
	`¡rÿt
(
c_Ï¡
, 
c_Ï¡_syl
[
tmp
[0] - '0']);

84 
	`¡rÿt
(
c_Ï¡
, 
c_Ï¡_syl
[
tmp
[1] - '0']);

85 
	`¡rÿt
(
c_Ï¡
, 
c_Ï¡_syl
[
tmp
[2] - '0']);

86  
OK
;

87 
	}
}

89 
	$g‘_l_¡ršg
(*
a_¡ršg
, 
x
, 
y
)

91 
Ëngth
;

92 
i
;

94 
Ëngth
 = 
x
 + 
	`g‘_¿ndom
(
y
 - x + 1) + 1;

95 
a_¡ršg
[
Ëngth
 - 1] = '\0';

97 
i
 = 0; i < 
Ëngth
 - 1; i++)

99 
a_¡ršg
[
i
] = 
l_¡ršg_ch¬
[
	`g‘_¿ndom
(
L_STRING_CHAR_LEN
 - 1)];

103 
	}
}

106 
	$g‘_n_¡ršg
(*
n_¡ršg
, 
x
, 
y
)

108 
Ëngth
;

109 
i
;

111 
Ëngth
 = 
x
 + 
	`g‘_¿ndom
(
y
 - x + 1) + 1;

112 
n_¡ršg
[
Ëngth
 - 1] = '\0';

114 
i
 = 0; i < 
Ëngth
 - 1; i++)

116 
n_¡ršg
[
i
] = 
n_¡ršg_ch¬
[
	`g‘_¿ndom
(
N_STRING_CHAR_LEN
)];

120 
	}
}

123 
	$g‘_nu¿nd
(
a
, 
x
, 
y
)

125  ((
	`g‘_¿ndom
(
a
 + 1è| (
x
 + g‘_¿ndom(
y
 + 1))) % (y - x + 1)) + x;

126 
	}
}

129 
	$g‘_³rûÁage
()

131  (è
	`¿nd
(è/ (è
RAND_MAX
;

132 
	}
}

134 
	$g‘_¿ndom
(
max
)

136  
	`¿nd
(è% 
max
;

137 
	}
}

147 
	$g‘_thšk_time
(
m—n_thšk_time
)

149  (-1.0 * 
	`log
(
	`g‘_³rûÁage
(è+ 0.000001è* 
m—n_thšk_time
);

150 
	}
}

152 
	$š™_commÚ
()

154 
i
, 
j
;

156 
	`¤ªd
(1);

159 
bË_ÿrdš®™y
.
w¬ehou£s
 = 1;

160 
bË_ÿrdš®™y
.
di¡riùs
 = 
DISTRICT_CARDINALITY
;

161 
bË_ÿrdš®™y
.
cu¡om”s
 = 
CUSTOMER_CARDINALITY
;

162 
bË_ÿrdš®™y
.
™ems
 = 
ITEM_CARDINALITY
;

163 
bË_ÿrdš®™y
.
Üd”s
 = 
ORDER_CARDINALITY
;

164 
bË_ÿrdš®™y
.
Ãw_Üd”s
 = 
NEW_ORDER_CARDINALITY
;

170 
j
 = 0;

171 
a_¡ršg_ch¬
[
j
++] = () 33;

172 
i
 = 35; i <= 43; i++)

174 
a_¡ršg_ch¬
[
j
++] = (è
i
;

176 
i
 = 45; i <= 126; i++)

178 
a_¡ršg_ch¬
[
j
++] = (è
i
;

180 #ià
	`defšed
(
LIBDRIZZLE
)

185 
i
 = 45; i <= 80; i++)

187 
i
 = 220; i <= 255; i++)

190 
a_¡ršg_ch¬
[
j
++] = (è
i
;

193  
OK
;

194 
	}
}

	@datagen.c

11 
	~"commÚ.h
"

13 
	~<¡dio.h
>

14 
	~<¡dlib.h
>

15 
	~<¡ršg.h
>

16 
	~<time.h
>

17 
	~<uni¡d.h
>

18 
	~<g‘İt.h
>

20 
	~<sys/ty³s.h
>

21 
	~<sys/¡©.h
>

22 
	~<”ºo.h
>

24 
	#CUSTOMER_DATA
 "cu¡om”.d©a"

	)

25 
	#DISTRICT_DATA
 "di¡riù.d©a"

	)

26 
	#HISTORY_DATA
 "hi¡Üy.d©a"

	)

27 
	#ITEM_DATA
 "™em.d©a"

	)

28 
	#NEW_ORDER_DATA
 "Ãw_Üd”.d©a"

	)

29 
	#ORDER_DATA
 "Üd”.d©a"

	)

30 
	#ORDER_LINE_DATA
 "Üd”_lše.d©a"

	)

31 
	#STOCK_DATA
 "¡ock.d©a"

	)

32 
	#WAREHOUSE_DATA
 "w¬ehou£.d©a"

	)

34 
	#MODE_SAPDB
 0

	)

35 
	#MODE_PGSQL
 1

	)

36 
	#MODE_MYSQL
 2

	)

37 
	#MODE_DRIZZLE
 3

	)

39 
	#MODE_FLAT
 0

	)

40 
	#MODE_DIRECT
 1

	)

42 
g’_cu¡om”s
();

43 
g’_di¡riùs
();

44 
g’_hi¡Üy
();

45 
g’_™ems
();

46 
g’_Ãw_Üd”
();

47 
g’_Üd”s
();

48 
g’_¡ock
();

49 
g’_w¬ehou£s
();

51 
	gw¬ehou£s
 = 0;

52 
	gcu¡om”s
 = 
CUSTOMER_CARDINALITY
;

53 
	g™ems
 = 
ITEM_CARDINALITY
;

54 
	gÜd”s
 = 
ORDER_CARDINALITY
;

55 
	gÃw_Üd”s
 = 
NEW_ORDER_CARDINALITY
;

57 
	gmode_lßd
 = 
MODE_FLAT
;

59 
	gmode_¡ršg
 = 
MODE_PGSQL
;

60 
	gd–im™”
 = ',';

61 
	gnuÎ_¡r
[16] = "\"NULL\"";

63 
	#ERR_MSG
Ğ
â
 ) { ()
	`fæush
(
¡d”r
); \

64 ()
	`årštf
(
¡d”r
, 
__FILE__
 ":%d:" #fn ": %s\n", \

65 
__LINE__
, 
	`¡»¼Ü
(
”ºo
)); }

	)

66 
	#METAPRINTF
Ğ
¬gs
 ) ifĞ
årštf
‡rg < 0 ) 
	`ERR_MSG
Ğ
â
 )

	)

69 
	#FPRINTF
(
a
, 
b
, 
c
) \

70 ià(
mode_¡ršg
 =ğ
MODE_SAPDB
) { \

71 
	`METAPRINTF
((
a
, "\""
b
"\"", 
c
)); \

72 } ià(
mode_¡ršg
 =ğ
MODE_PGSQL
 || mode_¡ršg =ğ
MODE_MYSQL
 || \

73 
mode_¡ršg
 =ğ
MODE_DRIZZLE
) { \

74 
	`METAPRINTF
((
a
, 
b
, 
c
)); \

75 }

	)

76 
	#FPRINTF2
(
a
, 
b
) \

77 ià(
mode_¡ršg
 =ğ
MODE_SAPDB
) { \

78 
	`METAPRINTF
((
a
, "\""
b
"\"")); \

79 } ià(
mode_¡ršg
 =ğ
MODE_PGSQL
 || mode_¡ršg =ğ
MODE_MYSQL
 || \

80 
mode_¡ršg
 =ğ
MODE_DRIZZLE
) { \

81 
	`METAPRINTF
((
a
, 
b
)); \

82 }

	)

84 
	$esÿ³_me
(*
¡r
)

87 
bufãr
[4096] = "";

88 
i
 = 0;

89 
j
 = 0;

90 
k
 = 0;

93 ià(
mode_¡ršg
 =ğ
MODE_PGSQL
 || mode_¡ršg =ğ
MODE_MYSQL
 ||\

94 
mode_¡ršg
 =ğ
MODE_DRIZZLE
) {

95 
	`¡rıy
(
bufãr
, 
¡r
);

96 
i
 = 
	`¡¾’
(
bufãr
);

97 
k
 = 0; k <ğ
i
; k++) {

98 ià(
bufãr
[
k
] == '\\') {

99 
¡r
[
j
++] = '\\';

101 
¡r
[
j
++] = 
bufãr
[
k
];

104 
	}
}

106 
	$´št_time¡amp
(
FILE
 *
ofe
, 
tm
 *
d©e
)

108 ià(
mode_¡ršg
 =ğ
MODE_SAPDB
) {

109 
	`METAPRINTF
((
ofe
, "\"%04d%02d%02d%02d%02d%02d000000\"",

110 
d©e
->
tm_y—r
 + 1900, d©e->
tm_mÚ
 + 1, d©e->
tm_mday
,

111 
d©e
->
tm_hour
, d©e->
tm_mš
, d©e->
tm_£c
));

112 } ià(
mode_¡ršg
 =ğ
MODE_PGSQL
 || mode_¡ršg =ğ
MODE_MYSQL
 || \

113 
mode_¡ršg
 =ğ
MODE_DRIZZLE
) {

114 
	`METAPRINTF
((
ofe
, "%04d-%02d-%02d %02d:%02d:%02d",

115 
d©e
->
tm_y—r
 + 1900, d©e->
tm_mÚ
 + 1, d©e->
tm_mday
,

116 
d©e
->
tm_hour
, d©e->
tm_mš
, d©e->
tm_£c
));

118 
	`´štf
("unknowÀ¡ršg mode: %d\n", 
mode_¡ršg
);

119 
	`ex™
(1);

121 
	}
}

124 
	$g’_cu¡om”s
()

126 
FILE
 *
ouut
;

127 
i
, 
j
, 
k
;

128 
a_¡ršg
[1024];

129 
tm
 *
tm1
;

130 
time_t
 
t1
;

131 
f’ame
[1024] = "\0";

133 
	`¤ªd
(0);

134 
	`´štf
("Generating customerable data...\n");

136 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

137 ià(
	`¡¾’
(
ouut_·th
) > 0) {

138 
	`¡rıy
(
f’ame
, 
ouut_·th
);

139 
	`¡rÿt
(
f’ame
, "/");

141 
	`¡rÿt
(
f’ame
, 
CUSTOMER_DATA
);

142 
ouut
 = 
	`fİ’
(
f’ame
, "w");

143 ià(
ouut
 =ğ
NULL
) {

144 
	`´štf
("ÿÂÙ o³À%s\n", 
CUSTOMER_DATA
);

147 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

148 
mode_¡ršg
) {

149 
MODE_PGSQL
:

150 
ouut
 = 
	`pİ’
("psql", "w");

151 ià(
ouut
 =ğ
NULL
) {

152 
	`´štf
("error cannot open…ipe for direct†oad\n");

156 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

158 
	`årštf
(
ouut
, "BEGIN;\n");

160 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

162 
	`årštf
(
ouut
,

164 
d–im™”
, 
nuÎ_¡r
);

166 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

170 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

173 
i
 = 0; i < 
w¬ehou£s
; i++) {

174 
j
 = 0; j < 
DISTRICT_CARDINALITY
; j++) {

175 
k
 = 0; k < 
cu¡om”s
; k++) {

177 
	`FPRINTF
(
ouut
, "%d", 
k
 + 1);

178 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

181 
	`FPRINTF
(
ouut
, "%d", 
j
 + 1);

182 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

185 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

186 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

189 
	`g‘_a_¡ršg
(
a_¡ršg
, 8, 16);

190 
	`esÿ³_me
(
a_¡ršg
);

191 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

192 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

195 
	`FPRINTF2
(
ouut
, "OE");

196 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

199 ià(
k
 < 1000) {

200 
	`g‘_c_Ï¡
(
a_¡ršg
, 
k
);

202 
	`g‘_c_Ï¡
(
a_¡ršg
, 
	`g‘_nu¿nd
(255, 0, 999));

204 
	`esÿ³_me
(
a_¡ršg
);

205 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

206 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

209 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

210 
	`esÿ³_me
(
a_¡ršg
);

211 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

212 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

215 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

216 
	`esÿ³_me
(
a_¡ršg
);

217 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

218 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

221 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

222 
	`esÿ³_me
(
a_¡ršg
);

223 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

224 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

227 
	`g‘_l_¡ršg
(
a_¡ršg
, 2, 2);

228 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

229 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

232 
	`g‘_n_¡ršg
(
a_¡ršg
, 4, 4);

233 
	`FPRINTF
(
ouut
, "%s11111", 
a_¡ršg
);

234 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

237 
	`g‘_n_¡ršg
(
a_¡ršg
, 16, 16);

238 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

239 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

247 
	`time
(&
t1
);

248 
tm1
 = 
	`loÿÉime
(&
t1
);

249 
	`´št_time¡amp
(
ouut
, 
tm1
);

250 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

253 ià(
	`g‘_³rûÁage
() < .10) {

254 
	`FPRINTF2
(
ouut
, "BC");

256 
	`FPRINTF2
(
ouut
, "GC");

258 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

261 
	`FPRINTF2
(
ouut
, "50000.00");

262 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

265 
	`FPRINTF
(
ouut
, "0.%04d", 
	`g‘_¿ndom
(5000));

266 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

269 
	`FPRINTF2
(
ouut
, "-10.00");

270 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

273 
	`FPRINTF2
(
ouut
, "10.00");

274 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

277 
	`FPRINTF2
(
ouut
, "1");

278 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

281 
	`FPRINTF2
(
ouut
, "0");

282 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

285 
	`g‘_a_¡ršg
(
a_¡ršg
, 300, 500);

286 
	`esÿ³_me
(
a_¡ršg
);

287 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

289 
	`METAPRINTF
((
ouut
, "\n"));

294 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

295 
	`fşo£
(
ouut
);

297 
mode_¡ršg
) {

298 
MODE_PGSQL
:

299 
	`årštf
(
ouut
, "\\.\n");

301 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

303 
	`årštf
(
ouut
, "COMMIT;\n");

305 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

307 
	`pşo£
(
ouut
);

312 
	`´štf
("Finished customerable data...\n");

314 
	}
}

317 
	$g’_di¡riùs
()

319 
FILE
 *
ouut
;

320 
i
, 
j
;

321 
a_¡ršg
[48];

322 
f’ame
[1024] = "\0";

324 
	`¤ªd
(0);

325 
	`´štf
("Generating districtable data...\n");

327 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

328 ià(
	`¡¾’
(
ouut_·th
) > 0) {

329 
	`¡rıy
(
f’ame
, 
ouut_·th
);

330 
	`¡rÿt
(
f’ame
, "/");

332 
	`¡rÿt
(
f’ame
, 
DISTRICT_DATA
);

333 
ouut
 = 
	`fİ’
(
f’ame
, "w");

334 ià(
ouut
 =ğ
NULL
) {

335 
	`´štf
("ÿÂÙ o³À%s\n", 
DISTRICT_DATA
);

338 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

339 
mode_¡ršg
) {

340 
MODE_PGSQL
:

341 
ouut
 = 
	`pİ’
("psql", "w");

342 ià(
ouut
 =ğ
NULL
) {

343 
	`´štf
("error cannot open…ipe for direct†oad\n");

347 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

349 
	`årštf
(
ouut
, "BEGIN;\n");

351 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

353 
	`årštf
(
ouut
,

355 
d–im™”
, 
nuÎ_¡r
);

357 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

361 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

364 
i
 = 0; i < 
w¬ehou£s
; i++) {

365 
j
 = 0; j < 
DISTRICT_CARDINALITY
; j++) {

367 
	`FPRINTF
(
ouut
, "%d", 
j
 + 1);

368 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

371 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

372 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

375 
	`g‘_a_¡ršg
(
a_¡ršg
, 6, 10);

376 
	`esÿ³_me
(
a_¡ršg
);

377 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

378 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

381 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

382 
	`esÿ³_me
(
a_¡ršg
);

383 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

384 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

387 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

388 
	`esÿ³_me
(
a_¡ršg
);

389 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

390 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

393 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

394 
	`esÿ³_me
(
a_¡ršg
);

395 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

396 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

399 
	`g‘_l_¡ršg
(
a_¡ršg
, 2, 2);

400 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

401 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

404 
	`g‘_n_¡ršg
(
a_¡ršg
, 4, 4);

405 
	`FPRINTF
(
ouut
, "%s11111", 
a_¡ršg
);

406 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

409 
	`FPRINTF
(
ouut
, "0.%04d", 
	`g‘_¿ndom
(2000));

410 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

413 
	`FPRINTF2
(
ouut
, "30000.00");

414 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

417 
	`FPRINTF2
(
ouut
, "3001");

419 
	`METAPRINTF
((
ouut
, "\n"));

423 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

424 
	`fşo£
(
ouut
);

426 
mode_¡ršg
) {

427 
MODE_PGSQL
:

428 
	`årštf
(
ouut
, "\\.\n");

430 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

432 
	`årštf
(
ouut
, "COMMIT;\n");

434 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

436 
	`pşo£
(
ouut
);

441 
	`´štf
("Finished districtable data...\n");

443 
	}
}

446 
	$g’_hi¡Üy
()

448 
FILE
 *
ouut
;

449 
i
, 
j
, 
k
;

450 
a_¡ršg
[64];

451 
tm
 *
tm1
;

452 
time_t
 
t1
;

453 
f’ame
[1024] = "\0";

455 
	`¤ªd
(0);

456 
	`´štf
("Generating historyable data...\n");

458 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

459 ià(
	`¡¾’
(
ouut_·th
) > 0) {

460 
	`¡rıy
(
f’ame
, 
ouut_·th
);

461 
	`¡rÿt
(
f’ame
, "/");

463 
	`¡rÿt
(
f’ame
, 
HISTORY_DATA
);

464 
ouut
 = 
	`fİ’
(
f’ame
, "w");

465 ià(
ouut
 =ğ
NULL
) {

466 
	`´štf
("ÿÂÙ o³À%s\n", 
HISTORY_DATA
);

469 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

470 
mode_¡ršg
) {

471 
MODE_PGSQL
:

472 
ouut
 = 
	`pİ’
("psql", "w");

473 ià(
ouut
 =ğ
NULL
) {

474 
	`´štf
("error cannot open…ipe for direct†oad\n");

478 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

480 
	`årštf
(
ouut
, "BEGIN;\n");

482 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

484 
	`årštf
(
ouut
,

486 
d–im™”
, 
nuÎ_¡r
);

488 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

492 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

495 
i
 = 0; i < 
w¬ehou£s
; i++) {

496 
j
 = 0; j < 
DISTRICT_CARDINALITY
; j++) {

497 
k
 = 0; k < 
cu¡om”s
; k++) {

499 
	`FPRINTF
(
ouut
, "%d", 
k
 + 1);

500 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

503 
	`FPRINTF
(
ouut
, "%d", 
j
 + 1);

504 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

507 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

508 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

511 
	`FPRINTF
(
ouut
, "%d", 
j
 + 1);

512 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

515 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

516 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

524 
	`time
(&
t1
);

525 
tm1
 = 
	`loÿÉime
(&
t1
);

526 
	`´št_time¡amp
(
ouut
, 
tm1
);

527 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

530 
	`FPRINTF2
(
ouut
, "10.00");

531 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

534 
	`g‘_a_¡ršg
(
a_¡ršg
, 12, 24);

535 
	`esÿ³_me
(
a_¡ršg
);

536 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

538 
	`METAPRINTF
((
ouut
, "\n"));

543 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

544 
	`fşo£
(
ouut
);

546 
mode_¡ršg
) {

547 
MODE_PGSQL
:

548 
	`årštf
(
ouut
, "\\.\n");

550 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

552 
	`årštf
(
ouut
, "COMMIT;\n");

554 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

556 
	`pşo£
(
ouut
);

561 
	`´štf
("Finished historyable data...\n");

563 
	}
}

566 
	$g’_™ems
()

568 
FILE
 *
ouut
;

569 
i
;

570 
a_¡ršg
[128];

571 
j
;

572 
f’ame
[1024] = "\0";

574 
	`¤ªd
(0);

575 
	`´štf
("Generating itemable data...\n");

577 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

578 ià(
	`¡¾’
(
ouut_·th
) > 0) {

579 
	`¡rıy
(
f’ame
, 
ouut_·th
);

580 
	`¡rÿt
(
f’ame
, "/");

582 
	`¡rÿt
(
f’ame
, 
ITEM_DATA
);

583 
ouut
 = 
	`fİ’
(
f’ame
, "w");

584 ià(
ouut
 =ğ
NULL
) {

585 
	`´štf
("ÿÂÙ o³À%s\n", 
ITEM_DATA
);

588 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

589 
mode_¡ršg
) {

590 
MODE_PGSQL
:

591 
ouut
 = 
	`pİ’
("psql", "w");

592 ià(
ouut
 =ğ
NULL
) {

593 
	`´štf
("error cannot open…ipe for direct†oad\n");

597 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

599 
	`årštf
(
ouut
, "BEGIN;\n");

601 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

603 
	`årštf
(
ouut
,

605 
d–im™”
, 
nuÎ_¡r
);

607 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

611 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

614 
i
 = 0; i < 
™ems
; i++) {

616 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

617 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

620 
	`FPRINTF
(
ouut
, "%d", 
	`g‘_¿ndom
(9999) + 1);

621 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

624 
	`g‘_a_¡ršg
(
a_¡ršg
, 14, 24);

625 
	`esÿ³_me
(
a_¡ršg
);

626 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

627 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

630 
	`FPRINTF
(
ouut
, "%0.2f", ((è
	`g‘_¿ndom
(9900) + 100.0) / 100.0);

631 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

634 
	`g‘_a_¡ršg
(
a_¡ršg
, 26, 50);

635 ià(
	`g‘_³rûÁage
() < .10) {

636 
j
 = 
	`g‘_¿ndom
(
	`¡¾’
(
a_¡ršg
) - 8);

637 
	`¡ºıy
(
a_¡ršg
 + 
j
, "ORIGINAL", 8);

639 
	`esÿ³_me
(
a_¡ršg
);

640 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

642 
	`METAPRINTF
((
ouut
, "\n"));

645 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

646 
	`fşo£
(
ouut
);

648 
mode_¡ršg
) {

649 
MODE_PGSQL
:

650 
	`årštf
(
ouut
, "\\.\n");

652 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

654 
	`årštf
(
ouut
, "COMMIT;\n");

656 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

658 
	`pşo£
(
ouut
);

663 
	`´štf
("Finished itemable data...\n");

665 
	}
}

668 
	$g’_Ãw_Üd”s
()

670 
FILE
 *
ouut
;

671 
i
, 
j
, 
k
;

672 
f’ame
[1024] = "\0";

674 
	`¤ªd
(0);

675 
	`´štf
("Generating‚ew-orderable data...\n");

677 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

678 ià(
	`¡¾’
(
ouut_·th
) > 0) {

679 
	`¡rıy
(
f’ame
, 
ouut_·th
);

680 
	`¡rÿt
(
f’ame
, "/");

682 
	`¡rÿt
(
f’ame
, 
NEW_ORDER_DATA
);

683 
ouut
 = 
	`fİ’
(
f’ame
, "w");

684 ià(
ouut
 =ğ
NULL
) {

685 
	`´štf
("ÿÂÙ o³À%s\n", 
NEW_ORDER_DATA
);

688 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

689 
mode_¡ršg
) {

690 
MODE_PGSQL
:

691 
ouut
 = 
	`pİ’
("psql", "w");

692 ià(
ouut
 =ğ
NULL
) {

693 
	`´štf
("error cannot open…ipe for direct†oad\n");

697 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

699 
	`årštf
(
ouut
, "BEGIN;\n");

701 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

703 
	`årštf
(
ouut
,

705 
d–im™”
, 
nuÎ_¡r
);

707 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

711 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

714 
i
 = 0; i < 
w¬ehou£s
; i++) {

715 
j
 = 0; j < 
DISTRICT_CARDINALITY
; j++) {

716 
k
 = 
Üd”s
 - 
Ãw_Üd”s
; k < orders; k++) {

718 
	`FPRINTF
(
ouut
, "%d", 
k
 + 1);

719 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

722 
	`FPRINTF
(
ouut
, "%d", 
j
 + 1);

723 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

726 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

728 
	`METAPRINTF
((
ouut
, "\n"));

733 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

734 
	`fşo£
(
ouut
);

736 
mode_¡ršg
) {

737 
MODE_PGSQL
:

738 
	`årštf
(
ouut
, "\\.\n");

740 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

742 
	`årštf
(
ouut
, "COMMIT;\n");

744 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

746 
	`pşo£
(
ouut
);

751 
	`´štf
("Finished‚ew-orderable data...\n");

753 
	}
}

756 
	$g’_Üd”s
()

758 
FILE
 *
Üd”
, *
Üd”_lše
;

759 
i
, 
j
, 
k
, 
l
;

760 
a_¡ršg
[64];

761 
tm
 *
tm1
;

762 
time_t
 
t1
;

763 
f’ame
[1024] = "\0";

765 
	snode_t
 {

766 
v®ue
;

767 
node_t
 *
Ãxt
;

769 
node_t
 *
h—d
;

770 
node_t
 *
cu¼’t
;

771 
node_t
 *
´ev
;

772 
node_t
 *
Ãw_node
;

773 
™”
;

775 
o_Ş_út
;

777 
	`¤ªd
(0);

778 
	`´štf
("Generating order‡nd order-lineable data...\n");

780 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

781 ià(
	`¡¾’
(
ouut_·th
) > 0) {

782 
	`¡rıy
(
f’ame
, 
ouut_·th
);

783 
	`¡rÿt
(
f’ame
, "/");

785 
	`¡rÿt
(
f’ame
, 
ORDER_DATA
);

786 
Üd”
 = 
	`fİ’
(
f’ame
, "w");

787 ià(
Üd”
 =ğ
NULL
) {

788 
	`´štf
("ÿÂÙ o³À%s\n", 
ORDER_DATA
);

792 
f’ame
[0] = '\0';

793 ià(
	`¡¾’
(
ouut_·th
) > 0) {

794 
	`¡rıy
(
f’ame
, 
ouut_·th
);

795 
	`¡rÿt
(
f’ame
, "/");

797 
	`¡rÿt
(
f’ame
, 
ORDER_LINE_DATA
);

798 
Üd”_lše
 = 
	`fİ’
(
f’ame
, "w");

799 ià(
Üd”_lše
 =ğ
NULL
) {

800 
	`´štf
("ÿÂÙ o³À%s\n", 
ORDER_LINE_DATA
);

803 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

804 
mode_¡ršg
) {

805 
MODE_PGSQL
:

806 
Üd”
 = 
	`pİ’
("psql", "w");

807 ià(
Üd”
 =ğ
NULL
) {

808 
	`´štf
("error cannot open…ipe for direct†oad\n");

812 
	`fg‘c
(
Üd”
è!ğ
EOF
) ;

814 
	`årštf
(
Üd”
, "BEGIN;\n");

816 
	`fg‘c
(
Üd”
è!ğ
EOF
) ;

818 
	`årštf
(
Üd”
,

820 
d–im™”
, 
nuÎ_¡r
);

822 
	`fg‘c
(
Üd”
è!ğ
EOF
) ;

824 
Üd”_lše
 = 
	`pİ’
("psql", "w");

825 ià(
Üd”_lše
 =ğ
NULL
) {

826 
	`´štf
("error cannot open…ipe for direct†oad\n");

830 
	`fg‘c
(
Üd”_lše
è!ğ
EOF
) ;

832 
	`årštf
(
Üd”_lše
, "BEGIN;\n");

834 
	`fg‘c
(
Üd”_lše
è!ğ
EOF
) ;

836 
	`årštf
(
Üd”_lše
,

838 
d–im™”
, 
nuÎ_¡r
);

840 
	`fg‘c
(
Üd”_lše
è!ğ
EOF
) ;

844 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

847 
i
 = 0; i < 
w¬ehou£s
; i++) {

848 
j
 = 0; j < 
DISTRICT_CARDINALITY
; j++) {

852 
h—d
 = (
node_t
 *è
	`m®loc
((node_t));

853 
h—d
->
v®ue
 = 1;

854 
h—d
->
Ãxt
 = 
NULL
;

855 
k
 = 2; k <ğ
cu¡om”s
; k++) {

856 
cu¼’t
 = 
´ev
 = 
h—d
;

859 
™”
 = 
	`g‘_¿ndom
(
k
 - 1);

860 
™”
 > 0) {

861 
´ev
 = 
cu¼’t
;

862 
cu¼’t
 = cu¼’t->
Ãxt
;

863 --
™”
;

867 
Ãw_node
 = (
node_t
 *è
	`m®loc
((node_t));

868 ià(
cu¼’t
 =ğ
´ev
) {

870 
Ãw_node
->
Ãxt
 = 
h—d
;

871 
h—d
 = 
Ãw_node
;

872 } ià(
cu¼’t
 =ğ
NULL
) {

874 
´ev
->
Ãxt
 = 
Ãw_node
;

875 
Ãw_node
->
Ãxt
 = 
NULL
;

878 
´ev
->
Ãxt
 = 
Ãw_node
;

879 
Ãw_node
->
Ãxt
 = 
cu¼’t
;

881 
Ãw_node
->
v®ue
 = 
k
;

884 
cu¼’t
 = 
h—d
;

885 
k
 = 0; k < 
Üd”s
; k++) {

887 
	`FPRINTF
(
Üd”
, "%d", 
k
 + 1);

888 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

891 
	`FPRINTF
(
Üd”
, "%d", 
j
 + 1);

892 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

895 
	`FPRINTF
(
Üd”
, "%d", 
i
 + 1);

896 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

899 
	`FPRINTF
(
Üd”
, "%d", 
cu¼’t
->
v®ue
);

900 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

901 
cu¼’t
 = cu¼’t->
Ãxt
;

909 
	`time
(&
t1
);

910 
tm1
 = 
	`loÿÉime
(&
t1
);

911 
	`´št_time¡amp
(
Üd”
, 
tm1
);

912 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

915 ià(
mode_¡ršg
 =ğ
MODE_DRIZZLE
) {

920 
	`FPRINTF
(
Üd”
, "%d", 
	`g‘_¿ndom
(9) + 1);

923 ià(
k
 < 2101) {

924 
	`FPRINTF
(
Üd”
, "%d", 
	`g‘_¿ndom
(9) + 1);

926 
	`METAPRINTF
((
Üd”
, "%s", 
nuÎ_¡r
));

929 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

932 
o_Ş_út
 = 
	`g‘_¿ndom
(10) + 5;

933 
	`FPRINTF
(
Üd”
, "%d", 
o_Ş_út
);

934 
	`METAPRINTF
((
Üd”
, "%c", 
d–im™”
));

937 
	`FPRINTF2
(
Üd”
, "1");

939 
	`METAPRINTF
((
Üd”
, "\n"));

945 
l
 = 0;† < 
o_Ş_út
;†++) {

947 
	`FPRINTF
(
Üd”_lše
, "%d", 
k
 + 1);

948 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

951 
	`FPRINTF
(
Üd”_lše
, "%d", 
j
 + 1);

952 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

955 
	`FPRINTF
(
Üd”_lše
, "%d", 
i
 + 1);

956 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

959 
	`FPRINTF
(
Üd”_lše
, "%d", 
l
 + 1);

960 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

963 
	`FPRINTF
(
Üd”_lše
, "%d",

964 
	`g‘_¿ndom
(
ITEM_CARDINALITY
 - 1) + 1);

965 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

968 
	`FPRINTF
(
Üd”_lše
, "%d", 
i
 + 1);

969 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

972 ià(
mode_¡ršg
 =ğ
MODE_DRIZZLE
) {

977 
	`time
(&
t1
);

978 
tm1
 = 
	`loÿÉime
(&
t1
);

979 
	`´št_time¡amp
(
Üd”_lše
, 
tm1
);

982 ià(
k
 < 2101) {

989 
	`time
(&
t1
);

990 
tm1
 = 
	`loÿÉime
(&
t1
);

991 
	`´št_time¡amp
(
Üd”_lše
, 
tm1
);

993 
	`METAPRINTF
((
Üd”_lše
, "%s", 
nuÎ_¡r
));

996 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

999 
	`FPRINTF2
(
Üd”_lše
, "5");

1000 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

1003 ià(
k
 < 2101) {

1004 
	`FPRINTF2
(
Üd”_lše
, "0.00");

1006 
	`FPRINTF
(
Üd”_lše
, "%f",

1007 (è(
	`g‘_¿ndom
(999998) + 1) / 100.0);

1009 
	`METAPRINTF
((
Üd”_lše
, "%c", 
d–im™”
));

1012 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1013 
	`FPRINTF
(
Üd”_lše
, "%s", 
a_¡ršg
);

1015 
	`METAPRINTF
((
Üd”_lše
, "\n"));

1018 
h—d
 !ğ
NULL
) {

1019 
cu¼’t
 = 
h—d
;

1020 
h—d
 = h—d->
Ãxt
;

1021 
	`ä“
(
cu¼’t
);

1026 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

1027 
	`fşo£
(
Üd”
);

1028 
	`fşo£
(
Üd”_lše
);

1030 
mode_¡ršg
) {

1031 
MODE_PGSQL
:

1032 
	`årštf
(
Üd”
, "\\.\n");

1034 
	`fg‘c
(
Üd”
è!ğ
EOF
) ;

1035 
	`årštf
(
Üd”_lše
, "\\.\n");

1037 
	`fg‘c
(
Üd”_lše
è!ğ
EOF
) ;

1039 
	`årštf
(
Üd”
, "COMMIT;\n");

1041 
	`fg‘c
(
Üd”
è!ğ
EOF
) ;

1042 
	`årštf
(
Üd”_lše
, "COMMIT;\n");

1044 
	`fg‘c
(
Üd”_lše
è!ğ
EOF
) ;

1046 
	`pşo£
(
Üd”
);

1047 
	`pşo£
(
Üd”_lše
);

1051 
	`´štf
("Finished order‡nd order-lineable data...\n");

1053 
	}
}

1056 
	$g’_¡ock
()

1058 
FILE
 *
ouut
;

1059 
i
, 
j
, 
k
;

1060 
a_¡ršg
[128];

1061 
f’ame
[1024] = "\0";

1063 
	`¤ªd
(0);

1064 
	`´štf
("Generating stockable data...\n");

1066 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

1067 ià(
	`¡¾’
(
ouut_·th
) > 0) {

1068 
	`¡rıy
(
f’ame
, 
ouut_·th
);

1069 
	`¡rÿt
(
f’ame
, "/");

1071 
	`¡rÿt
(
f’ame
, 
STOCK_DATA
);

1072 
ouut
 = 
	`fİ’
(
f’ame
, "w");

1073 ià(
ouut
 =ğ
NULL
) {

1074 
	`´štf
("ÿÂÙ o³À%s\n", 
STOCK_DATA
);

1077 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

1078 
mode_¡ršg
) {

1079 
MODE_PGSQL
:

1080 
ouut
 = 
	`pİ’
("psql", "w");

1081 ià(
ouut
 =ğ
NULL
) {

1082 
	`´štf
("error cannot open…ipe for direct†oad\n");

1086 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1088 
	`årštf
(
ouut
, "BEGIN;\n");

1090 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1092 
	`årštf
(
ouut
,

1094 
d–im™”
, 
nuÎ_¡r
);

1096 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1100 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

1103 
i
 = 0; i < 
w¬ehou£s
; i++) {

1104 
j
 = 0; j < 
™ems
; j++) {

1106 
	`FPRINTF
(
ouut
, "%d", 
j
 + 1);

1107 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1110 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

1111 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1114 
	`FPRINTF
(
ouut
, "%d", 
	`g‘_¿ndom
(90) + 10);

1115 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1118 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1119 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1120 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1123 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1124 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1125 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1128 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1129 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1130 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1133 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1134 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1135 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1138 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1139 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1140 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1143 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1144 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1145 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1148 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1149 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1150 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1153 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1154 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1155 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1158 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1159 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1160 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1163 
	`g‘_l_¡ršg
(
a_¡ršg
, 24, 24);

1164 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1165 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1168 
	`FPRINTF2
(
ouut
, "0");

1169 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1172 
	`FPRINTF2
(
ouut
, "0");

1173 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1176 
	`FPRINTF2
(
ouut
, "0");

1177 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1180 
	`g‘_a_¡ršg
(
a_¡ršg
, 26, 50);

1181 ià(
	`g‘_³rûÁage
() < .10) {

1182 
k
 = 
	`g‘_¿ndom
(
	`¡¾’
(
a_¡ršg
) - 8);

1183 
	`¡ºıy
(
a_¡ršg
 + 
k
, "ORIGINAL", 8);

1185 
	`esÿ³_me
(
a_¡ršg
);

1186 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1188 
	`METAPRINTF
((
ouut
, "\n"));

1192 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

1193 
	`fşo£
(
ouut
);

1195 
mode_¡ršg
) {

1196 
MODE_PGSQL
:

1197 
	`årštf
(
ouut
, "\\.\n");

1199 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1201 
	`årštf
(
ouut
, "COMMIT;\n");

1203 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1205 
	`pşo£
(
ouut
);

1210 
	`´štf
("Finished stockable data...\n");

1212 
	}
}

1215 
	$g’_w¬ehou£s
()

1217 
FILE
 *
ouut
;

1218 
i
;

1219 
a_¡ršg
[48];

1220 
f’ame
[1024] = "\0";

1222 
	`¤ªd
(0);

1223 
	`´štf
("Generating warehouseable data...\n");

1225 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

1226 ià(
	`¡¾’
(
ouut_·th
) > 0) {

1227 
	`¡rıy
(
f’ame
, 
ouut_·th
);

1228 
	`¡rÿt
(
f’ame
, "/");

1230 
	`¡rÿt
(
f’ame
, 
WAREHOUSE_DATA
);

1231 
ouut
 = 
	`fİ’
(
f’ame
, "w");

1232 ià(
ouut
 =ğ
NULL
) {

1233 
	`´štf
("ÿÂÙ o³À%s\n", 
WAREHOUSE_DATA
);

1236 } ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

1237 
mode_¡ršg
) {

1238 
MODE_PGSQL
:

1239 
ouut
 = 
	`pİ’
("psql", "w");

1240 ià(
ouut
 =ğ
NULL
) {

1241 
	`´štf
("error cannot open…ipe for direct†oad\n");

1245 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1247 
	`årštf
(
ouut
, "BEGIN;\n");

1249 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1251 
	`årštf
(
ouut
,

1253 
d–im™”
, 
nuÎ_¡r
);

1255 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1259 
	`´štf
("”rÜ unknowÀlßd mode: %d\n", 
mode_lßd
);

1262 
i
 = 0; i < 
w¬ehou£s
; i++) {

1264 
	`FPRINTF
(
ouut
, "%d", 
i
 + 1);

1265 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1268 
	`g‘_a_¡ršg
(
a_¡ršg
, 6, 10);

1269 
	`esÿ³_me
(
a_¡ršg
);

1270 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1271 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1274 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

1275 
	`esÿ³_me
(
a_¡ršg
);

1276 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1277 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1280 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

1281 
	`esÿ³_me
(
a_¡ršg
);

1282 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1283 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1286 
	`g‘_a_¡ršg
(
a_¡ršg
, 10, 20);

1287 
	`esÿ³_me
(
a_¡ršg
);

1288 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1289 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1292 
	`g‘_l_¡ršg
(
a_¡ršg
, 2, 2);

1293 
	`FPRINTF
(
ouut
, "%s", 
a_¡ršg
);

1294 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1297 
	`g‘_n_¡ršg
(
a_¡ršg
, 4, 4);

1298 
	`FPRINTF
(
ouut
, "%s11111", 
a_¡ršg
);

1299 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1302 
	`FPRINTF
(
ouut
, "0.%04d", 
	`g‘_¿ndom
(2000));

1303 
	`METAPRINTF
((
ouut
, "%c", 
d–im™”
));

1306 
	`FPRINTF2
(
ouut
, "300000.00");

1308 
	`METAPRINTF
((
ouut
, "\n"));

1311 ià(
mode_lßd
 =ğ
MODE_FLAT
) {

1312 
	`fşo£
(
ouut
);

1314 
mode_¡ršg
) {

1315 
MODE_PGSQL
:

1316 
	`årštf
(
ouut
, "\\.\n");

1318 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1320 
	`årštf
(
ouut
, "COMMIT;\n");

1322 
	`fg‘c
(
ouut
è!ğ
EOF
) ;

1324 
	`pşo£
(
ouut
);

1329 
	`´štf
("Finished warehouseable data...\n");

1331 
	}
}

1333 
	$maš
(
¬gc
, *
¬gv
[])

1335 
¡©
 
¡
;

1338 
c
;

1340 
	`š™_commÚ
();

1342 ià(
¬gc
 < 2) {

1343 
	`´štf
("Usage: %s -w # [-c #] [-i #] [-o #] [-s #] [-n #] [-d <str>]\n",

1344 
¬gv
[0]);

1345 
	`´štf
("\n");

1346 
	`´štf
("-w #\n");

1347 
	`´štf
("\twarehouse cardinality\n");

1348 
	`´štf
("-c #\n");

1349 
	`´štf
("\tcu¡om” c¬dš®™y, deçuÉ %d\n", 
CUSTOMER_CARDINALITY
);

1350 
	`´štf
("-i #\n");

1351 
	`´štf
("\t™em c¬dš®™y, deçuÉ %d\n", 
ITEM_CARDINALITY
);

1352 
	`´štf
("-o #\n");

1353 
	`´štf
("\tÜd” c¬dš®™y, deçuÉ %d\n", 
ORDER_CARDINALITY
);

1354 
	`´štf
("-n #\n");

1355 
	`´štf
("\Šew-Üd” c¬dš®™y, deçuÉ %d\n", 
NEW_ORDER_CARDINALITY
);

1356 
	`´štf
("-d <path>\n");

1357 
	`´štf
("\toutput…ath of data files\n");

1358 
	`´štf
("--drizzle\n");

1359 
	`´štf
("\tformat data for Drizzle\n");

1360 
	`´štf
("--mysql\n");

1361 
	`´štf
("\tformat data for MySQL\n");

1362 
	`´štf
("--pgsql\n");

1363 
	`´štf
("\tformat data for PostgreSQL\n");

1364 
	`´štf
("--sapdb\n");

1365 
	`´štf
("\tformat data for SAP DB\n");

1366 
	`´štf
("--direct\n");

1367 
	`´štf
("\tdon't generate flat files,†oad directly into database\n");

1373 
İtiÚ_šdex
 = 0;

1374 
İtiÚ
 
lÚg_İtiÚs
[] = {

1375 { "dœeù", 
no_¬gum’t
, &
mode_lßd
, 
MODE_DIRECT
 },

1376 { "pgsql", 
no_¬gum’t
, &
mode_¡ršg
, 
MODE_PGSQL
 },

1377 { "§pdb", 
no_¬gum’t
, &
mode_¡ršg
, 
MODE_SAPDB
 },

1378 { "mysql", 
no_¬gum’t
, &
mode_¡ršg
, 
MODE_MYSQL
 },

1379 { "drizzË", 
no_¬gum’t
, &
mode_¡ršg
, 
MODE_DRIZZLE
 },

1383 
c
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, "c:d:i:n:o:w:",

1384 
lÚg_İtiÚs
, &
İtiÚ_šdex
);

1385 ià(
c
 == -1) {

1389 
c
) {

1393 
cu¡om”s
 = 
	`©oi
(
İrg
);

1396 
	`¡rıy
(
ouut_·th
, 
İrg
);

1399 
™ems
 = 
	`©oi
(
İrg
);

1402 
Ãw_Üd”s
 = 
	`©oi
(
İrg
);

1405 
Üd”s
 = 
	`©oi
(
İrg
);

1408 
w¬ehou£s
 = 
	`©oi
(
İrg
);

1411 
	`´štf
("?? g‘İˆ»tuºed ch¬aù” cod0%Ø??\n", 
c
);

1416 ià(
w¬ehou£s
 == 0) {

1417 
	`´štf
("-w must be used\n");

1421 ià(
	`¡¾’
(
ouut_·th
è> 0 && ((
	`¡©
(ouut_·th, &
¡
) < 0) ||

1422 (
¡
.
¡_mode
 & 
S_IFMT
è!ğ
S_IFDIR
)) {

1423 
	`´štf
("OuuˆdœeùÜy oàd©¨fe '%s'‚Ùƒxi¡s\n", 
ouut_·th
);

1428 ià(
mode_lßd
 =ğ
MODE_DIRECT
) {

1429 
mode_¡ršg
) {

1430 
MODE_SAPDB
:

1431 
MODE_MYSQL
:

1432 
MODE_DRIZZLE
:

1433 
	`´štf
("the„dbms select does‚ot support direct†oading\n");

1439 ià(
mode_¡ršg
 =ğ
MODE_SAPDB
) {

1440 
d–im™”
 = ',';

1441 
	`¡rıy
(
nuÎ_¡r
, "\"NULL\"");

1442 } ià(
mode_¡ršg
 =ğ
MODE_PGSQL
 || mode_¡ršg =ğ
MODE_MYSQL
 ||

1443 
mode_¡ršg
 =ğ
MODE_DRIZZLE
) {

1444 
d–im™”
 = '\t';

1445 
	`¡rıy
(
nuÎ_¡r
, "");

1448 
	`´štf
("w¬ehou£ ğ%d\n", 
w¬ehou£s
);

1449 
	`´štf
("di¡riù ğ%d\n", 
DISTRICT_CARDINALITY
);

1450 
	`´štf
("cu¡om” ğ%d\n", 
cu¡om”s
);

1451 
	`´štf
("™em ğ%d\n", 
™ems
);

1452 
	`´štf
("Üd” ğ%d\n", 
Üd”s
);

1453 
	`´štf
("¡ock = %d\n", 
™ems
);

1454 
	`´štf
("Ãw_Üd” ğ%d\n", 
Ãw_Üd”s
);

1455 
	`´štf
("\n");

1457 ià(
	`¡¾’
(
ouut_·th
) > 0) {

1458 
	`´štf
("OuuˆdœeùÜy oàd©¨fes: %s\n",
ouut_·th
);

1460 
	`´štf
("Output directory of data files: current directory\n");

1462 
	`´štf
("\n");

1464 
	`´štf
("G’”©šg d©¨fe fÜ %d w¬ehou£(s)...\n", 
w¬ehou£s
);

1466 
	`g’_™ems
();

1467 
	`g’_w¬ehou£s
();

1468 
	`g’_¡ock
();

1469 
	`g’_di¡riùs
();

1470 
	`g’_cu¡om”s
();

1471 
	`g’_hi¡Üy
();

1472 
	`g’_Üd”s
();

1473 
	`g’_Ãw_Üd”s
();

1476 
	}
}

	@db.c

10 #ifdeà
HAVE_CONFIG_H


11 
	~<cÚfig.h
>

14 
	~"db.h
"

15 
	~"loggšg.h
"

17 #ifdeà
ODBC


18 
	~"odbc_d–iv”y.h
"

19 
	~"odbc_Üd”_¡©us.h
"

20 
	~"odbc_·ym’t.h
"

21 
	~"odbc_¡ock_Ëv–.h
"

22 
	~"odbc_Ãw_Üd”.h
"

23 
	~"odbc_š‹gr™y.h
"

26 #ifdeà
LIBPQ


27 
	~"libpq_d–iv”y.h
"

28 
	~"libpq_Üd”_¡©us.h
"

29 
	~"libpq_·ym’t.h
"

30 
	~"libpq_¡ock_Ëv–.h
"

31 
	~"libpq_Ãw_Üd”.h
"

32 
	~"libpq_š‹gr™y.h
"

36 #ifdeà
LIBMYSQL


37 
	~"mysql_d–iv”y.h
"

38 
	~"mysql_Üd”_¡©us.h
"

39 
	~"mysql_·ym’t.h
"

40 
	~"mysql_¡ock_Ëv–.h
"

41 
	~"mysql_Ãw_Üd”.h
"

42 
	~"mysql_š‹gr™y.h
"

46 #ifdeà
LIBSQLITE


47 
	~"nÚ¥_d–iv”y.h
"

48 
	~"nÚ¥_Üd”_¡©us.h
"

49 
	~"nÚ¥_·ym’t.h
"

50 
	~"nÚ¥_¡ock_Ëv–.h
"

51 
	~"nÚ¥_Ãw_Üd”.h
"

52 
	~"nÚ¥_š‹gr™y.h
"

55 #ifdeà
LIBDRIZZLE


56 
	~"drizzË_d–iv”y.h
"

57 
	~"drizzË_Üd”_¡©us.h
"

58 
	~"drizzË_·ym’t.h
"

59 
	~"drizzË_¡ock_Ëv–.h
"

60 
	~"drizzË_Ãw_Üd”.h
"

61 
	~"drizzË_š‹gr™y.h
"

64 
	$cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
) {

65 
rc
;

67 
rc
 = 
	`_cÚÃù_to_db
(
dbc
);

68 ià(
rc
 !ğ
OK
) {

69  
ERROR
;

72  
OK
;

73 
	}
}

75 #ifdeà
ODBC


76 
	$db_š™
(*
¢ame
, *
uÇme
, *
auth
)

78 #ifdeà
LIBPQ


79 
	$db_š™
(*
_dbÇme
, *
_pgho¡
, *
_pgpÜt
)

81 #ifdeà
LIBMYSQL


82 
	$db_š™
(* 
_mysql_dbÇme
, *
_mysql_ho¡
, * 
_mysql_u£r
,

83 * 
_mysql_·ss
, * 
_mysql_pÜt
, * 
_mysql_sock‘
)

85 #ifdeà
LIBDRIZZLE


86 
	$db_š™
(* 
_drizzË_dbÇme
, *
_drizzË_ho¡
, * 
_drizzË_u£r
,

87 * 
_drizzË_·ss
, * 
_drizzË_pÜt
, * 
_drizzË_sock‘
)

89 #ifdeà
LIBSQLITE


90 
	$db_š™
(*
_dbÇme
)

94 
rc
;

96 #ifdeà
ODBC


97 
rc
 = 
	`_db_š™
(
¢ame
, 
uÇme
, 
auth
);

100 #ifdeà
LIBPQ


101 
rc
 = 
	`_db_š™
(
_dbÇme
, 
_pgho¡
, 
_pgpÜt
);

104 #ifdeà
LIBMYSQL


105 
rc
 = 
	`_db_š™
(
_mysql_dbÇme
, 
_mysql_ho¡
, 
_mysql_u£r
, 
_mysql_·ss
,

106 
_mysql_pÜt
, 
_mysql_sock‘
);

109 #ifdeà
LIBDRIZZLE


110 
rc
 = 
	`_db_š™
(
_drizzË_dbÇme
, 
_drizzË_ho¡
, 
_drizzË_u£r
, 
_drizzË_·ss
, 
_drizzË_pÜt
, 
_drizzË_sock‘
);

113 #ifdeà
LIBSQLITE


114 
rc
 = 
	`_db_š™
(
_dbÇme
);

117  
OK
;

118 
	}
}

120 
	$discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
) {

121 
rc
;

123 #ifdeà
ODBC


125  
OK
;

127 
rc
 = 
	`_discÚÃù_äom_db
(
dbc
);

128 ià(
rc
 !ğ
OK
) {

129  
ERROR
;

132  
OK
;

133 
	}
}

135 
	$´oûss_Œª§ùiÚ
(
Œª§ùiÚ
, 
db_cÚ‹xt_t
 *
dbc
,

136 
Œª§ùiÚ_d©a_t
 *
td
)

138 
rc
;

139 
i
;

140 
¡©us
;

142 
Œª§ùiÚ
) {

143 
INTEGRITY
:

144 
rc
 = 
	`execu‹_š‹gr™y
(
dbc
, &
td
->
š‹gr™y
);

146 
DELIVERY
:

147 
rc
 = 
	`execu‹_d–iv”y
(
dbc
, &
td
->
d–iv”y
);

149 
NEW_ORDER
:

150 
td
->
Ãw_Üd”
.
o_®l_loÿl
 = 1;

151 
i
 = 0; i < 
td
->
Ãw_Üd”
.
o_Ş_út
; i++) {

152 ià(
td
->
Ãw_Üd”
.
Üd”_lše
[
i
].
Ş_suµly_w_id
 !=

153 
td
->
Ãw_Üd”
.
w_id
) {

154 
td
->
Ãw_Üd”
.
o_®l_loÿl
 = 0;

158 
rc
 = 
	`execu‹_Ãw_Üd”
(
dbc
, &
td
->
Ãw_Üd”
);

159 ià(
rc
 !ğ
ERROR
 && 
td
->
Ãw_Üd”
.
rŞlback
 == 0) {

166 
td
->
Ãw_Üd”
.
tÙ®_amouÁ
 =

167 
td
->
Ãw_Üd”
.
tÙ®_amouÁ
 *

168 (1 - 
td
->
Ãw_Üd”
.
c_discouÁ
) *

169 (1 + 
td
->
Ãw_Üd”
.
w_x
 +d->Ãw_Üd”.
d_x
);

171 
rc
 = 
ERROR
;

174 
ORDER_STATUS
:

175 
rc
 = 
	`execu‹_Üd”_¡©us
(
dbc
, &
td
->
Üd”_¡©us
);

177 
PAYMENT
:

178 
rc
 = 
	`execu‹_·ym’t
(
dbc
, &
td
->
·ym’t
);

180 
STOCK_LEVEL
:

181 
rc
 = 
	`execu‹_¡ock_Ëv–
(
dbc
, &
td
->
¡ock_Ëv–
);

184 
	`LOG_ERROR_MESSAGE
("unknowÀŒª§ùiÚy³ %d", 
Œª§ùiÚ
);

185  
ERROR
;

189 ià(
rc
 =ğ
OK
) {

190 
¡©us
 = 
	`comm™_Œª§ùiÚ
(
dbc
);

192 
¡©us
 = 
	`rŞlback_Œª§ùiÚ
(
dbc
);

195  
¡©us
;

196 
	}
}

	@db_threadpool.c

10 #ifdeà
HAVE_CONFIG_H


11 
	~<cÚfig.h
>

14 
	~<¡dio.h
>

15 
	~<¡dio.h
>

16 
	~<¡ršg.h
>

17 
	~<”ºo.h
>

18 
	~<uni¡d.h
>

19 
	~<sys/time.h
>

21 
	~<¡ršgs.h
>

23 
	~"commÚ.h
"

24 
	~"li¡’”.h
"

25 
	~"loggšg.h
"

26 
	~"ş›Á_š‹rçû.h
"

27 
	~"Œª§ùiÚ_queue.h
"

28 
	~"db_th»adpoŞ.h
"

29 
	~"db.h
"

32 *
db_wÜk”
(*
d©a
);

33 
¡¬tup
();

36 
	gdb_cÚÃùiÚs
 = 0;

37 
	gdb_cÚn_¦“p
 = 1000;

38 *
	gwÜk”_couÁ
;

39 
time_t
 *
	gÏ¡_txn
;

42 
¢ame
[32];

43 
dÇme
[32];

44 
ex™šg
;

45 
£m_t
 
	gdb_wÜk”_couÁ
;

46 #ifdeà
STANDALONE


47 
FILE
 *
log_mix
;

48 
±h»ad_mu‹x_t
 
mu‹x_mix_log
;

51 #ià
defšed
(
LIBMYSQL
è|| defšed(
ODBC
è|| defšed(
LIBDRIZZLE
)

52 
dbt2_u£r
[128];

53 
dbt2_·ss
[128];

56 #ifdeà
LIBPQ


57 
po¡ma¡”_pÜt
[32];

60 #ifdeà
LIBMYSQL


61 
dbt2_mysql_pÜt
[32];

62 
dbt2_mysql_ho¡
[128];

63 
dbt2_mysql_sock‘
[256];

66 #ifdeà
LIBDRIZZLE


67 
dbt2_drizzË_pÜt
[32];

68 
dbt2_drizzË_ho¡
[128];

69 
dbt2_drizzË_sock‘
[256];

72 *
	$db_wÜk”
(*
d©a
)

74 
id
 = *((*è
d©a
);

75 #iâdeà
STANDALONE


76 
Ëngth
;

78 
Œª§ùiÚ_queue_node_t
 *
node
;

79 
db_cÚ‹xt_t
 
dbc
;

80 #ifdeà
STANDALONE


81 
timev®
 
¹0
, 
¹1
;

82 
»¥Ú£_time
;

86 #ifdeà
ODBC


87 
	`´štf
("cÚÃùØODBC s”v” w™h…¬am‘”s: DSN: |%s| u£r: |%s|…ass: |%s|\n", 
¢ame
, 
dbt2_u£r
, 
dbt2_·ss
);

88 
	`db_š™
(
¢ame
, 
dbt2_u£r
, 
dbt2_·ss
);

90 #ifdeà
LIBPQ


91 
	`db_š™
(
dÇme
, 
¢ame
, 
po¡ma¡”_pÜt
);

94 #ifdeà
LIBMYSQL


95 
	`´štf
("cÚÃùØmysqÈ£rv” w™h…¬am‘”s: db_Çme: |%s| ho¡: |%s| u£r: |%s|…ass: |%s|…Üt: |%s| sock‘: |%s|\n", 
¢ame
, 
dbt2_mysql_ho¡
, 
dbt2_u£r
, 
dbt2_·ss
, 
dbt2_mysql_pÜt
, 
dbt2_mysql_sock‘
);

96 
	`db_š™
(
¢ame
, 
dbt2_mysql_ho¡
 , 
dbt2_u£r
, 
dbt2_·ss
, 
dbt2_mysql_pÜt
, 
dbt2_mysql_sock‘
);

99 #ifdeà
LIBDRIZZLE


100 
	`´štf
("cÚÃùØdrizzË s”v” w™h…¬am‘”s: db_Çme: |%s| ho¡: |%s| u£r: |%s|…ass: |%s|…Üt: |%s| sock‘: |%s|\n", 
¢ame
, 
dbt2_drizzË_ho¡
, 
dbt2_u£r
, 
dbt2_·ss
, 
dbt2_drizzË_pÜt
, 
dbt2_drizzË_sock‘
);

101 
	`db_š™
(
¢ame
, 
dbt2_drizzË_ho¡
 , 
dbt2_u£r
, 
dbt2_·ss
, 
dbt2_drizzË_pÜt
, 
dbt2_drizzË_sock‘
);

104 #ifdeà
LIBSQLITE


105 
	`db_š™
(
¢ame
);

108 ià(!
ex™šg
 && 
	`cÚÃù_to_db
(&
dbc
è!ğ
OK
) {

109 
	`LOG_ERROR_MESSAGE
("connect_to_db()ƒrror,erminating…rogram");

110 
	`´štf
("cannot connecto database(see details inƒrror.log file,ƒxiting...\n");

111 
	`ex™
(1);

114 !
ex™šg
) {

119 
node
 = 
	`dequeue_Œª§ùiÚ
();

120 ià(
node
 =ğ
NULL
) {

121 
	`LOG_ERROR_MESSAGE
("dequeue was‚ull");

124 #ifdeà
STANDALONE


125 ià(
	`g‘timeofday
(&
¹0
, 
NULL
) == -1) {

126 
	`³¼Ü
("gettimeofday");

129 
node
->
ş›Á_d©a
.
¡©us
 =

130 
	`´oûss_Œª§ùiÚ
(
node
->
ş›Á_d©a
.
Œª§ùiÚ
,

131 &
dbc
, &
node
->
ş›Á_d©a
.
Œª§ùiÚ_d©a
);

132 ià(
node
->
ş›Á_d©a
.
¡©us
 =ğ
ERROR
) {

133 
	`LOG_ERROR_MESSAGE
("process_transaction()ƒrror on %s",

134 
Œª§ùiÚ_Çme
[

135 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

141 #ifdeà
STANDALONE


142 ià(
	`g‘timeofday
(&
¹1
, 
NULL
) == -1) {

143 
	`³¼Ü
("gettimeofday");

145 
»¥Ú£_time
 = 
	`difáimev®
(
¹1
, 
¹0
);

146 
	`±h»ad_mu‹x_lock
(&
mu‹x_mix_log
);

147 
	`årštf
(
log_mix
, "%d,%c,%f,%d\n", (è
	`time
(
NULL
),

148 
Œª§ùiÚ_shÜt_Çme
[
node
->
ş›Á_d©a
.
Œª§ùiÚ
],

149 
»¥Ú£_time
, (è
	`±h»ad_£lf
());

150 
	`fæush
(
log_mix
);

151 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_mix_log
);

154 #iâdeà
STANDALONE


155 
Ëngth
 = 
	`£nd_Œª§ùiÚ_d©a
(
node
->
s
, &node->
ş›Á_d©a
);

156 ià(
Ëngth
 =ğ
ERROR
) {

157 
	`LOG_ERROR_MESSAGE
("send_transaction_data()ƒrror");

164 
	`±h»ad_mu‹x_lock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_EXECUTING
][

165 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

166 --
Œª§ùiÚ_couÁ”
[
REQ_EXECUTING
][

167 
node
->
ş›Á_d©a
.
Œª§ùiÚ
];

168 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_EXECUTING
][

169 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

170 
	`»cyşe_node
(
node
);

173 ++
wÜk”_couÁ
[
id
];

176 
	`time
(&
Ï¡_txn
[
id
]);

180 
	`discÚÃù_äom_db
(&
dbc
);

182 
	`£m_wa™
(&
db_wÜk”_couÁ
);

184  
NULL
;

185 
	}
}

187 
	$db_th»adpoŞ_š™
()

189 
time¥ec
 
ts
, 
»m
;

190 
i
;

191 
”ºo
;

193 ià(
	`£m_š™
(&
db_wÜk”_couÁ
, 0, 0) != 0) {

194 
	`LOG_ERROR_MESSAGE
("cannot init db_worker_count\n");

195  
ERROR
;

198 
wÜk”_couÁ
 = (*è
	`m®loc
((è* 
db_cÚÃùiÚs
);

199 
	`bz”o
(
wÜk”_couÁ
, (è* 
db_cÚÃùiÚs
);

201 
ts
.
tv_£c
 = (
time_t
è
db_cÚn_¦“p
 / 1000;

202 
ts
.
tv_n£c
 = (è(
db_cÚn_¦“p
 % 1000) * 1000000;

204 
Ï¡_txn
 = (
time_t
 *è
	`m®loc
(Ñime_tè* 
db_cÚÃùiÚs
);

206 
i
 = 0; i < 
db_cÚÃùiÚs
; i++) {

207 
»t
;

208 
±h»ad_t
 
tid
;

209 
±h»ad_©Œ_t
 
©Œ
;

210 
size_t
 
¡acksize
 = 262144;

217 
	`time
(&
Ï¡_txn
[
i
]);

222 ià(
	`±h»ad_©Œ_š™
(&
©Œ
) != 0) {

223 
	`LOG_ERROR_MESSAGE
("could‚ot init…thread‡ttr");

224  
ERROR
;

226 ià(
	`±h»ad_©Œ_£t¡acksize
(&
©Œ
, 
¡acksize
) != 0) {

227 
	`LOG_ERROR_MESSAGE
("could‚ot set…thread stack size");

228  
ERROR
;

230 
»t
 = 
	`±h»ad_ü—‹
(&
tid
, &
©Œ
, &
db_wÜk”
, &
i
);

231 ià(
»t
 != 0) {

232 
	`LOG_ERROR_MESSAGE
("error creating dbhread");

233 ià(
»t
 =ğ
EAGAIN
) {

234 
	`LOG_ERROR_MESSAGE
(

237  
ERROR
;

241 
	`£m_po¡
(&
db_wÜk”_couÁ
);

243  
	`Çno¦“p
(&
ts
, &
»m
) == -1) {

244 ià(
”ºo
 =ğ
EINTR
) {

245 
	`memıy
(&
ts
, &
»m
, (
time¥ec
));

247 
	`LOG_ERROR_MESSAGE
(

249 
ts
.
tv_£c
,s.
tv_n£c
);

253 
	`±h»ad_©Œ_de¡roy
(&
©Œ
);

255  
OK
;

256 
	}
}

	@driver.c

10 #ifdeà
HAVE_CONFIG_H


11 
	~<cÚfig.h
>

14 
	~<¡dio.h
>

15 
	~<¡dlib.h
>

16 
	~<¡ršg.h
>

17 
	~<ùy³.h
>

18 
	~<”ºo.h
>

19 
	~<±h»ad.h
>

20 
	~<time.h
>

21 
	~<uni¡d.h
>

22 
	~<sys/time.h
>

24 
	~"commÚ.h
"

25 
	~"loggšg.h
"

26 
	~"driv”.h
"

27 
	~"ş›Á_š‹rçû.h
"

28 
	~"šput_d©a_g’”©Ü.h
"

29 #ifdeà
STANDALONE


30 
	~"db.h
"

31 
	~"Œª§ùiÚ_queue.h
"

32 
	~"db_th»adpoŞ.h
"

35 
	#MIX_LOG_NAME
 "mix.log"

	)

37 *
‹rmš®_wÜk”
(*
d©a
);

40 
±h»ad_t
** 
	gg_tid
 = 
NULL
;

41 
Œª§ùiÚ_mix_t
 
	gŒª§ùiÚ_mix
;

42 
key_time_t
 
	gkey_time
;

43 
thšk_time_t
 
	gthšk_time
;

44 
	gho¡Çme
[32];

45 
	gş›Á_pÜt
 = 
CLIENT_PORT
;

46 
	gdu¿tiÚ
 = 0;

47 
	g¡İ_time
 = 0;

48 
	gw_id_mš
 = 0, 
	gw_id_max
 = 0;

49 
	g‹rmš®s_³r_w¬ehou£
 = 0;

50 
	gmode_®‹»d
 = 0;

51 
	g£ed
 = -1;

52 
	gş›Á_cÚn_¦“p
 = 1000;

53 
	g¥»ad
 = 1;

54 
	gth»ads_¡¬t_time
= 0;

56 
FILE
 *
	glog_mix
 = 
NULL
;

57 
±h»ad_mu‹x_t
 
	gmu‹x_mix_log
 = 
PTHREAD_MUTEX_INITIALIZER
;

59 
	g‹rmš®_¡©e
[3][
TRANSACTION_MAX
] = {

65 
±h»ad_mu‹x_t
 
	gmu‹x_‹rmš®_¡©e
[3][
TRANSACTION_MAX
] = {

66 { 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

67 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

68 
PTHREAD_MUTEX_INITIALIZER
 },

69 { 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

70 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

71 
PTHREAD_MUTEX_INITIALIZER
 },

72 { 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

73 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

74 
PTHREAD_MUTEX_INITIALIZER
 }

77 
	$ü—‹_pid_fe
()

79 
FILE
 * 
åid
;

80 
pid_f’ame
[1024];

82 
	`¥rštf
(
pid_f’ame
, "%s/%s", 
ouut_·th
, 
DRIVER_PID_FILENAME
);

84 
åid
 = 
	`fİ’
(
pid_f’ame
,"w");

85 ià(!
åid
) {

86 
	`´štf
("ÿÂ'ˆü—‹…id fe: %s\n", 
pid_f’ame
);

87  
ERROR
;

90 
	`årštf
(
åid
,"%d", (è
	`g‘pid
());

91 
	`fşo£
(
åid
);

93  
OK
;

94 
	}
}

96 
	$š™_driv”
()

98 
‹rmš®s_³r_w¬ehou£
 = 
bË_ÿrdš®™y
.
di¡riùs
;

100 
Œª§ùiÚ_mix
.
d–iv”y_aùu®
 = 
MIX_DELIVERY
;

101 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
 = 
MIX_ORDER_STATUS
;

102 
Œª§ùiÚ_mix
.
·ym’t_aùu®
 = 
MIX_PAYMENT
;

103 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
 = 
MIX_STOCK_LEVEL
;

105 
key_time
.
d–iv”y
 = 
KEY_TIME_DELIVERY
;

106 
key_time
.
Ãw_Üd”
 = 
KEY_TIME_NEW_ORDER
;

107 
key_time
.
Üd”_¡©us
 = 
KEY_TIME_ORDER_STATUS
;

108 
key_time
.
·ym’t
 = 
KEY_TIME_PAYMENT
;

109 
key_time
.
¡ock_Ëv–
 = 
KEY_TIME_STOCK_LEVEL
;

111 
thšk_time
.
d–iv”y
 = 
THINK_TIME_DELIVERY
;

112 
thšk_time
.
Ãw_Üd”
 = 
THINK_TIME_NEW_ORDER
;

113 
thšk_time
.
Üd”_¡©us
 = 
THINK_TIME_ORDER_STATUS
;

114 
thšk_time
.
·ym’t
 = 
THINK_TIME_PAYMENT
;

115 
thšk_time
.
¡ock_Ëv–
 = 
THINK_TIME_STOCK_LEVEL
;

117  
OK
;

118 
	}
}

120 
	$š™_driv”_loggšg
()

122 
log_f’ame
[1024];

124 
	`¥rštf
(
log_f’ame
, "%s%s", 
ouut_·th
, 
MIX_LOG_NAME
);

125 
log_mix
 = 
	`fİ’
(
log_f’ame
, "w");

126 ià(
log_mix
 =ğ
NULL
) {

127 
	`årštf
(
¡d”r
, "ÿÂÙ o³À%s\n", 
log_f’ame
);

128  
ERROR
;

131  
OK
;

132 
	}
}

134 
	$š‹gr™y_‹rmš®_wÜk”
()

136 
Ëngth
;

137 
sockfd
;

139 
ş›Á_Œª§ùiÚ_t
 
ş›Á_d©a
;

140 
”ºo
;

143 
sockfd
 = 
	`cÚÃù_to_ş›Á
(
ho¡Çme
, 
ş›Á_pÜt
);

144 ià(
sockfd
 < 1) {

145 
	`LOG_ERROR_MESSAGE
("connect_to_client() failed,hreadƒxiting...");

146 
	`´štf
("connect_to_client() failed,hreadƒxiting...\n");

147 
	`±h»ad_ex™
(
NULL
);

150 
ş›Á_d©a
.
Œª§ùiÚ
 = 
INTEGRITY
;

151 
	`g’”©e_šput_d©a
(
ş›Á_d©a
.
Œª§ùiÚ
,

152 &
ş›Á_d©a
.
Œª§ùiÚ_d©a
, 
bË_ÿrdš®™y
.
w¬ehou£s
);

154 #ifdeà
DEBUG


155 
	`´štf
("executingransaction %c\n"

156 
Œª§ùiÚ_shÜt_Çme
[
ş›Á_d©a
.
Œª§ùiÚ
]);

157 
	`fæush
(
¡dout
);

159 
	`LOG_ERROR_MESSAGE
("executingransaction %c",

160 
Œª§ùiÚ_shÜt_Çme
[
ş›Á_d©a
.
Œª§ùiÚ
]);

163 
Ëngth
 = 
	`£nd_Œª§ùiÚ_d©a
(
sockfd
, &
ş›Á_d©a
);

164 
Ëngth
 = 
	`»ûive_Œª§ùiÚ_d©a
(
sockfd
, &
ş›Á_d©a
);

165 
	`şo£
(
sockfd
);

167  
ş›Á_d©a
.
¡©us
;

168 
	}
}

170 
	$»ÿlcuÏ‹_mix
()

176 
Œª§ùiÚ_mix
.
Ãw_Üd”_aùu®
 = 1.0 -

177 (
Œª§ùiÚ_mix
.
d–iv”y_aùu®
 +

178 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
 +

179 
Œª§ùiÚ_mix
.
·ym’t_aùu®
 +

180 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
);

182 ià(
Œª§ùiÚ_mix
.
Ãw_Üd”_aùu®
 < 0.0) {

183 
	`LOG_ERROR_MESSAGE
(

185 
Œª§ùiÚ_mix
.
d–iv”y_aùu®
,

186 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
,

187 
Œª§ùiÚ_mix
.
·ym’t_aùu®
,

188 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
,

189 
Œª§ùiÚ_mix
.
Ãw_Üd”_aùu®
);

190  
ERROR
;

194 
Œª§ùiÚ_mix
.
Ãw_Üd”_th»shŞd
 =¿n§ùiÚ_mix.
Ãw_Üd”_aùu®
;

195 
Œª§ùiÚ_mix
.
·ym’t_th»shŞd
 =

196 
Œª§ùiÚ_mix
.
Ãw_Üd”_th»shŞd
 +

197 
Œª§ùiÚ_mix
.
·ym’t_aùu®
;

198 
Œª§ùiÚ_mix
.
Üd”_¡©us_th»shŞd
 =

199 
Œª§ùiÚ_mix
.
·ym’t_th»shŞd


200 + 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
;

201 
Œª§ùiÚ_mix
.
d–iv”y_th»shŞd
 =

202 
Œª§ùiÚ_mix
.
Üd”_¡©us_th»shŞd


203 + 
Œª§ùiÚ_mix
.
d–iv”y_aùu®
;

204 
Œª§ùiÚ_mix
.
¡ock_Ëv–_th»shŞd
 =

205 
Œª§ùiÚ_mix
.
d–iv”y_th»shŞd
 +

206 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
;

208  
OK
;

209 
	}
}

211 
	$£t_ş›Á_ho¡Çme
(*
addr
)

213 
	`¡rıy
(
ho¡Çme
, 
addr
);

214 
	`´štf
("cÚÃùšgØş›Á‡ˆ'%s'\n", 
ho¡Çme
);

215 
	`fæush
(
¡dout
);

216  
OK
;

217 
	}
}

219 
	$£t_ş›Á_pÜt
(
pÜt
)

221 
ş›Á_pÜt
 = 
pÜt
;

222 
	`´štf
("cÚÃùšgØş›Á…Üˆ© '%d'\n", 
ş›Á_pÜt
);

223 
	`fæush
(
¡dout
);

224  
OK
;

225 
	}
}

227 
	$£t_du¿tiÚ
(
£cÚds
)

229 
du¿tiÚ
 = 
£cÚds
;

230  
OK
;

231 
	}
}

233 
	$£t_bË_ÿrdš®™y
(
bË
, 
ÿrdš®™y
)

235 
bË
) {

236 
TABLE_WAREHOUSE
:

237 
bË_ÿrdš®™y
.
w¬ehou£s
 = 
ÿrdš®™y
;

239 
TABLE_CUSTOMER
:

240 
bË_ÿrdš®™y
.
cu¡om”s
 = 
ÿrdš®™y
;

242 
TABLE_ITEM
:

243 
bË_ÿrdš®™y
.
™ems
 = 
ÿrdš®™y
;

245 
TABLE_ORDER
:

246 
bË_ÿrdš®™y
.
Üd”s
 = 
ÿrdš®™y
;

248 
TABLE_NEW_ORDER
:

249 
bË_ÿrdš®™y
.
Ãw_Üd”s
 = 
ÿrdš®™y
;

252  
ERROR
;

255  
OK
;

256 
	}
}

258 
	$£t_Œª§ùiÚ_mix
(
Œª§ùiÚ
, 
mix
)

260 
Œª§ùiÚ
) {

261 
DELIVERY
:

262 
Œª§ùiÚ_mix
.
d–iv”y_aùu®
 = 
mix
;

264 
NEW_ORDER
:

265 
Œª§ùiÚ_mix
.
Ãw_Üd”_aùu®
 = 
mix
;

267 
ORDER_STATUS
:

268 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
 = 
mix
;

270 
PAYMENT
:

271 
Œª§ùiÚ_mix
.
·ym’t_aùu®
 = 
mix
;

273 
STOCK_LEVEL
:

274 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
 = 
mix
;

277  
ERROR
;

279  
OK
;

280 
	}
}

282 
	$¡¬t_driv”
()

284 
i
, 
j
;

285 
time¥ec
 
ts
, 
»m
;

288 
couÁ
 = 0;

290 
ts
.
tv_£c
 = (
time_t
è(
ş›Á_cÚn_¦“p
 / 1000);

291 
ts
.
tv_n£c
 = (è(
ş›Á_cÚn_¦“p
 % 1000) * 1000000;

292 #ifdeà
STANDALONE


303 
th»ads_¡¬t_time
 = (è((è
ş›Á_cÚn_¦“p
 / 1000.0 *

304 (è
‹rmš®s_³r_w¬ehou£
 *

305 (è(
w_id_max
 - 
w_id_mš
));

307 
¡İ_time
 = 
	`time
(
NULL
è+ 
du¿tiÚ
 + 
th»ads_¡¬t_time
;

308 
	`´štf
("driv” i ¡¬tšgØ¿m°u°©im%d\n", (è
	`time
(
NULL
));

309 
	`´štf
("driv” wÈ¿m°u°š %d secÚds\n", 
th»ads_¡¬t_time
);

310 
	`´štf
("wÈ¡İe¡‡ˆtim%d\n", 
¡İ_time
);

313 
g_tid
 = (
±h»ad_t
**è
	`m®loc
(Õth»ad_t*è* (
w_id_max
+1)/
¥»ad
);

314 
i
 = 
w_id_mš
; i < 
w_id_max
 + 1; i +ğ
¥»ad
) {

315 
g_tid
[
i
] = (
±h»ad_t
*)

316 
	`m®loc
((
±h»ad_t
è* 
‹rmš®s_³r_w¬ehou£
);

319 
j
 = 0; j < 
‹rmš®s_³r_w¬ehou£
; j++) {

320 
i
 = 
w_id_mš
; i < 
w_id_max
 + 1; i +ğ
¥»ad
) {

321 
»t
;

322 
±h»ad_©Œ_t
 
©Œ
;

323 
size_t
 
¡acksize
 = 131072;

324 
‹rmš®_cÚ‹xt_t
 *
tc
;

326 
tc
 = (
‹rmš®_cÚ‹xt_t
 *)

327 
	`m®loc
((
‹rmš®_cÚ‹xt_t
));

328 
tc
->
w_id
 = 
i
;

329 
tc
->
d_id
 = 
j
 + 1;

330 ià(
	`±h»ad_©Œ_š™
(&
©Œ
) != 0) {

331 
	`LOG_ERROR_MESSAGE
("could‚ot init…thread‡ttr: %d",

332 (
i
 + 
j
 + 1è* 
‹rmš®s_³r_w¬ehou£
);

333  
ERROR
;

335 ià(
	`±h»ad_©Œ_£t¡acksize
(&
©Œ
, 
¡acksize
) != 0) {

336 
	`LOG_ERROR_MESSAGE
("could‚ot set…thread stack size: %d",

337 (
i
 + 
j
 + 1è* 
‹rmš®s_³r_w¬ehou£
);

338  
ERROR
;

340 
»t
 = 
	`±h»ad_ü—‹
(&
g_tid
[
i
][
j
], &
©Œ
, &
‹rmš®_wÜk”
,

341 (*è
tc
);

342 ià(
»t
 != 0) {

343 
	`³¼Ü
("pthread_create");

344 
	`LOG_ERROR_MESSAGE
( "error creatingerminalhread: %d",

345 (
i
 + 
j
 + 1è* 
‹rmš®s_³r_w¬ehou£
);

346 ià(
»t
 =ğ
EAGAIN
) {

347 
	`LOG_ERROR_MESSAGE
( "notƒnough system„esources: %d",

348 (
i
 + 
j
 + 1è* 
‹rmš®s_³r_w¬ehou£
);

350  
ERROR
;

353 ++
couÁ
;

354 ià((
couÁ
 % 100) == 0) {

355 
	`´štf
("%d / %dh»ad ¡¬‹d...\n", 
couÁ
,

356 
‹rmš®s_³r_w¬ehou£
 *

357 (
w_id_max
 - 
w_id_mš
 + 1è/ 
¥»ad
);

358 
	`fæush
(
¡dout
);

362 
	`Çno¦“p
(&
ts
, &
»m
) == -1) {

363 ià(
”ºo
 =ğ
EINTR
) {

364 
	`memıy
(&
ts
, &
»m
, (
time¥ec
));

366 
	`LOG_ERROR_MESSAGE
(

368 
ts
.
tv_£c
,s.
tv_n£c
);

372 
	`±h»ad_©Œ_de¡roy
(&
©Œ
);

375 ià(
mode_®‹»d
 == 1) {

381 
	`´štf
("altered mode detected\n");

385 
	`´štf
("terminals started...\n");

388 
	`±h»ad_mu‹x_lock
(&
mu‹x_mix_log
);

389 
	`årštf
(
log_mix
, "%d,START,,,\n", (è
	`time
(
NULL
));

390 
	`fæush
(
log_mix
);

391 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_mix_log
);

394 
i
 = 
w_id_mš
; i < 
w_id_max
 + 1; i +ğ
¥»ad
) {

395 
j
 = 0; j < 
‹rmš®s_³r_w¬ehou£
; j++) {

396 ià(
	`±h»ad_još
(
g_tid
[
i
][
j
], 
NULL
) != 0) {

397 
	`LOG_ERROR_MESSAGE
("error joinerminalhread");

398  
ERROR
;

402 ià(
mode_®‹»d
 == 1) {

408 
	`´štf
("altered mode detected\n");

412 
	`´štf
("driver isƒxiting‚ormally\n");

413  
OK
;

414 
	}
}

416 *
	$‹rmš®_wÜk”
(*
d©a
)

418 #iâdeà
STANDALONE


419 
Ëngth
;

420 
sockfd
;

423 
‹rmš®_cÚ‹xt_t
 *
tc
;

424 
ş›Á_Œª§ùiÚ_t
 
ş›Á_d©a
;

425 
th»shŞd
;

426 
keyšg_time
;

427 
time¥ec
 
thškšg_time
, 
»m
;

428 
m—n_thšk_time
;

429 
timev®
 
¹0
, 
¹1
;

430 
»¥Ú£_time
;

431 
”ºo
;

432 
rc
;

433 
loÿl_£ed
;

434 
pid_t
 
pid
;

435 
±h»ad_t
 
tid
;

436 
code
;

438 #ifdeà
STANDALONE


439 
db_cÚ‹xt_t
 
dbc
;

440 
Œª§ùiÚ_queue_node_t
 *
node
 =

441 (
Œª§ùiÚ_queue_node_t
 *)

442 
	`m®loc
((
Œª§ùiÚ_queue_node_t
));

443 
¢ame
[32];

444 
ex™šg
;

445 #ifdeà
LIBPQ


446 
po¡ma¡”_pÜt
[32];

449 #ifdeà
LIBMYSQL


450 
dbt2_mysql_pÜt
[32];

453 #ifdeà
LIBDRIZZLE


454 
dbt2_drizzË_pÜt
[32];

459 
tc
 = (
‹rmš®_cÚ‹xt_t
 *è
d©a
;

461 
tid
 = 
	`±h»ad_£lf
();

462 
pid
 = 
	`g‘pid
();

463 ià(
£ed
 == -1) {

464 
timev®
 
tv
;

465 
junk
;

467 
loÿl_£ed
 = 
pid
;

468 
	`g‘timeofday
(&
tv
, 
NULL
);

469 
loÿl_£ed
 ^ğ
tid
 ^ 
tv
.
tv_£c
 ^v.
tv_u£c
 ^ 
junk
;

471 
loÿl_£ed
 = 
£ed
;

473 
	`´štf
("seed for %d:%x : %u\n",

474 (è
pid
, (è
tid
, 
loÿl_£ed
);

475 
	`fæush
(
¡dout
);

476 
	`¤ªd
(
loÿl_£ed
);

478 #ifdeà
STANDALONE


479 #ifdeà
ODBC


480 
	`db_š™
(
¢ame
, 
DB_USER
, 
DB_PASS
);

482 #ifdeà
LIBPQ


483 
	`db_š™
(
DB_NAME
, 
¢ame
, 
po¡ma¡”_pÜt
);

485 #ifdeà
LIBMYSQL


486 
	`´štf
("CONNECTED TO DB |%s| |%s| |%s|\n", 
DB_NAME
, 
¢ame
, 
dbt2_mysql_pÜt
);

487 
	`db_š™
(
¢ame
, "", 
dbt2_mysql_pÜt
);

489 #ifdeà
LIBDRIZZLE


490 
	`´štf
("CONNECTED TO DB |%s| |%s| |%s|\n", 
DB_NAME
, 
¢ame
, 
dbt2_drizzË_pÜt
);

491 
	`db_š™
(
¢ame
, "", 
dbt2_drizzË_pÜt
);

493 #ifdeà
LIBSQLITE


494 
	`db_š™
(
¢ame
);

497 ià(!
ex™šg
 && 
	`cÚÃù_to_db
(&
dbc
è!ğ
OK
) {

498 
	`LOG_ERROR_MESSAGE
("db_connect()ƒrror,erminating…rogram");

499 
	`´štf
("cannot connecto database,ƒxiting...\n");

500 
	`ex™
(1);

504 
sockfd
 = 
	`cÚÃù_to_ş›Á
(
ho¡Çme
, 
ş›Á_pÜt
);

505 ià(
sockfd
 < 1) {

506 
	`LOG_ERROR_MESSAGE
( "connect_to_client() failed,hreadƒxiting...");

507 
	`´štf
("connect_to_client() failed,hreadƒxiting...\n");

508 
	`±h»ad_ex™
(
NULL
);

513 ià(
mode_®‹»d
 == 1) {

518 
tc
->
w_id
 = 
w_id_mš
 + 
	`g‘_¿ndom
(
w_id_max
 - w_id_min + 1);

519 
tc
->
d_id
 = 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
di¡riùs
) + 1;

526 
th»shŞd
 = 
	`g‘_³rûÁage
();

527 ià(
th»shŞd
 < 
Œª§ùiÚ_mix
.
Ãw_Üd”_th»shŞd
) {

528 
ş›Á_d©a
.
Œª§ùiÚ
 = 
NEW_ORDER
;

529 
keyšg_time
 = 
key_time
.
Ãw_Üd”
;

530 
m—n_thšk_time
 = 
thšk_time
.
Ãw_Üd”
;

531 } ià(
Œª§ùiÚ_mix
.
·ym’t_aùu®
 != 0 &&

532 
th»shŞd
 < 
Œª§ùiÚ_mix
.
·ym’t_th»shŞd
) {

533 
ş›Á_d©a
.
Œª§ùiÚ
 = 
PAYMENT
;

534 
keyšg_time
 = 
key_time
.
·ym’t
;

535 
m—n_thšk_time
 = 
thšk_time
.
·ym’t
;

536 } ià(
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
 != 0 &&

537 
th»shŞd
 < 
Œª§ùiÚ_mix
.
Üd”_¡©us_th»shŞd
) {

538 
ş›Á_d©a
.
Œª§ùiÚ
 = 
ORDER_STATUS
;

539 
keyšg_time
 = 
key_time
.
Üd”_¡©us
;

540 
m—n_thšk_time
 = 
thšk_time
.
Üd”_¡©us
;

541 } ià(
Œª§ùiÚ_mix
.
d–iv”y_aùu®
 != 0 &&

542 
th»shŞd
 < 
Œª§ùiÚ_mix
.
d–iv”y_th»shŞd
) {

543 
ş›Á_d©a
.
Œª§ùiÚ
 = 
DELIVERY
;

544 
keyšg_time
 = 
key_time
.
d–iv”y
;

545 
m—n_thšk_time
 = 
thšk_time
.
d–iv”y
;

547 
ş›Á_d©a
.
Œª§ùiÚ
 = 
STOCK_LEVEL
;

548 
keyšg_time
 = 
key_time
.
¡ock_Ëv–
;

549 
m—n_thšk_time
 = 
thšk_time
.
¡ock_Ëv–
;

552 #ifdeà
DEBUG


553 
	`´štf
("executingransaction %c\n",

554 
Œª§ùiÚ_shÜt_Çme
[
ş›Á_d©a
.
Œª§ùiÚ
]);

555 
	`fæush
(
¡dout
);

556 
	`LOG_ERROR_MESSAGE
("executingransaction %c",

557 
Œª§ùiÚ_shÜt_Çme
[
ş›Á_d©a
.
Œª§ùiÚ
]);

561 ià(
ş›Á_d©a
.
Œª§ùiÚ
 !ğ
STOCK_LEVEL
) {

562 
	`g’”©e_šput_d©a
(
ş›Á_d©a
.
Œª§ùiÚ
,

563 &
ş›Á_d©a
.
Œª§ùiÚ_d©a
, 
tc
->
w_id
);

565 
	`g’”©e_šput_d©a2
(
ş›Á_d©a
.
Œª§ùiÚ
,

566 &
ş›Á_d©a
.
Œª§ùiÚ_d©a
, 
tc
->
w_id
,c->
d_id
);

570 
	`±h»ad_mu‹x_lock
(

571 &
mu‹x_‹rmš®_¡©e
[
KEYING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

572 ++
‹rmš®_¡©e
[
KEYING
][
ş›Á_d©a
.
Œª§ùiÚ
];

573 
	`±h»ad_mu‹x_uÆock
(

574 &
mu‹x_‹rmš®_¡©e
[
KEYING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

575 ià(
	`time
(
NULL
è< 
¡İ_time
) {

576 
	`¦“p
(
keyšg_time
);

580 
	`±h»ad_mu‹x_lock
(

581 &
mu‹x_‹rmš®_¡©e
[
KEYING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

582 --
‹rmš®_¡©e
[
KEYING
][
ş›Á_d©a
.
Œª§ùiÚ
];

583 
	`±h»ad_mu‹x_uÆock
(

584 &
mu‹x_‹rmš®_¡©e
[
KEYING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

587 
	`±h»ad_mu‹x_lock
(

588 &
mu‹x_‹rmš®_¡©e
[
EXECUTING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

589 ++
‹rmš®_¡©e
[
EXECUTING
][
ş›Á_d©a
.
Œª§ùiÚ
];

590 
	`±h»ad_mu‹x_uÆock
(

591 &
mu‹x_‹rmš®_¡©e
[
EXECUTING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

593 ià(
	`g‘timeofday
(&
¹0
, 
NULL
) == -1) {

594 
	`³¼Ü
("gettimeofday");

596 #ifdeà
STANDALONE


597 
	`memıy
(&
node
->
ş›Á_d©a
, &client_data, (client_data));

605 
rc
 = 
	`´oûss_Œª§ùiÚ
(
node
->
ş›Á_d©a
.
Œª§ùiÚ
, &
dbc
,

606 &
node
->
ş›Á_d©a
.
Œª§ùiÚ_d©a
);

607 ià(
rc
 =ğ
ERROR
) {

608 
	`LOG_ERROR_MESSAGE
("process_transaction()ƒrror on %s",

609 
Œª§ùiÚ_Çme
[
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

612 
Ëngth
 = 
	`£nd_Œª§ùiÚ_d©a
(
sockfd
, &
ş›Á_d©a
);

613 
Ëngth
 = 
	`»ûive_Œª§ùiÚ_d©a
(
sockfd
, &
ş›Á_d©a
);

614 
rc
 = 
ş›Á_d©a
.
¡©us
;

616 ià(
	`g‘timeofday
(&
¹1
, 
NULL
) == -1) {

617 
	`³¼Ü
("gettimeofday");

619 
»¥Ú£_time
 = 
	`difáimev®
(
¹1
, 
¹0
);

620 
	`±h»ad_mu‹x_lock
(&
mu‹x_mix_log
);

621 ià(
rc
 =ğ
OK
) {

622 
code
 = 'C';

623 } ià(
rc
 =ğ
STATUS_ROLLBACK
) {

624 
code
 = 'R';

625 } ià(
rc
 =ğ
ERROR
) {

626 
code
 = 'E';

628 
	`årštf
(
log_mix
, "%d,%c,%c,%f,%Îd\n", (è
	`time
(
NULL
),

629 
Œª§ùiÚ_shÜt_Çme
[
ş›Á_d©a
.
Œª§ùiÚ
], 
code
,

630 
»¥Ú£_time
, (è
	`±h»ad_£lf
());

631 
	`fæush
(
log_mix
);

632 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_mix_log
);

633 
	`±h»ad_mu‹x_lock
(&
mu‹x_‹rmš®_¡©e
[
EXECUTING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

634 --
‹rmš®_¡©e
[
EXECUTING
][
ş›Á_d©a
.
Œª§ùiÚ
];

635 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_‹rmš®_¡©e
[
EXECUTING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

638 
	`±h»ad_mu‹x_lock
(&
mu‹x_‹rmš®_¡©e
[
THINKING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

639 ++
‹rmš®_¡©e
[
THINKING
][
ş›Á_d©a
.
Œª§ùiÚ
];

640 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_‹rmš®_¡©e
[
THINKING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

641 ià(
	`time
(
NULL
è< 
¡İ_time
) {

642 
thškšg_time
.
tv_n£c
 = (è
	`g‘_thšk_time
(
m—n_thšk_time
);

643 
thškšg_time
.
tv_£c
 = (
time_t
èÑhškšg_time.
tv_n£c
 / 1000);

644 
thškšg_time
.
tv_n£c
 = (thinking_time.tv_nsec % 1000) * 1000000;

645 
	`Çno¦“p
(&
thškšg_time
, &
»m
) == -1) {

646 ià(
”ºo
 =ğ
EINTR
) {

647 
	`memıy
(&
thškšg_time
, &
»m
, (
time¥ec
));

649 
	`LOG_ERROR_MESSAGE
(

651 
thškšg_time
.
tv_£c
,

652 
thškšg_time
.
tv_n£c
);

657 
	`±h»ad_mu‹x_lock
(&
mu‹x_‹rmš®_¡©e
[
THINKING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

658 --
‹rmš®_¡©e
[
THINKING
][
ş›Á_d©a
.
Œª§ùiÚ
];

659 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_‹rmš®_¡©e
[
THINKING
][
ş›Á_d©a
.
Œª§ùiÚ
]);

660 } 
	`time
(
NULL
è< 
¡İ_time
);

662 #ifdeà
STANDALONE


666 
	`±h»ad_mu‹x_lock
(&
mu‹x_mix_log
);

667 
	`årštf
(
log_mix
, "%d,TERMINATED,,,%d\n", (è
	`time
(
NULL
),

668 (è
	`±h»ad_£lf
());

669 
	`fæush
(
log_mix
);

670 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_mix_log
);

671  
NULL
;

672 
	}
}

	@driver_main.c

11 #ifdeà
HAVE_CONFIG_H


12 
	~<cÚfig.h
>

15 
	~<¡dlib.h
>

16 
	~<¡ršg.h
>

17 
	~<m©h.h
>

18 
	~<commÚ.h
>

19 
	~<loggšg.h
>

20 
	~<ş›Á_š‹rçû.h
>

21 
	~<driv”.h
>

22 
	~<uni¡d.h
>

23 #ifdeà
STANDALONE


24 
	~<db_th»adpoŞ.h
>

26 
	g¢ame
[32] = "";

27 
	gex™šg
 = 0;

30 #ifdeà
LIBPQ


31 
	gpo¡ma¡”_pÜt
[32];

34 #ifdeà
LIBMYSQL


35 
	gdbt2_mysql_pÜt
[32];

38 #ifdeà
LIBDRIZZLE


39 
	gdbt2_drizzË_pÜt
[32];

42 
	g³rfÜm_š‹gr™y_check
 = 0;

44 
·r£_¬gum’ts
(
¬gc
, *
¬gv
[]);

46 
	$maš
(
¬gc
, *
¬gv
[])

49 
	`š™_commÚ
();

50 
	`š™_driv”
();

52 ià(
	`·r£_¬gum’ts
(
¬gc
, 
¬gv
è!ğ
OK
) {

53 
	`´štf
("usage: %s -d <address> -wmin # -wmax # -l # [-w #] [-p #] [-c #] [-i #] [-o #] [-n #] [-q %%] [-r %%] [-e %%] [-t %%] [-seed #] [-altered 0] [-spread #] [-z]",

54 
¬gv
[0]);

55 #ifdeà
STANDALONE


56 #ifdeà
LIBPQ


57 
	`´štf
(" -z #");

60 
	`´štf
("\n\n");

61 #ifdeà
STANDALONE


62 
	`´štf
("-dbname <connect_string>\n");

63 
	`´štf
("\tdatabase connect string\n");

64 #ifdeà
LIBPQ


65 
	`´štf
("-z #\n");

66 
	`´štf
("\tpostmaster†istener…ort\n");

68 #ifdeà
LIBMYSQL


69 
	`´štf
("-z #\n");

70 
	`´štf
("\tmysql server†istener…ort\n");

72 #ifdeà
LIBDRIZZLE


73 
	`´štf
("-z #\n");

74 
	`´štf
("\tdrizzle server†istener…ort\n");

77 
	`´štf
("-d <address>\n");

78 
	`´štf
("\tnetwork‡ddress where client…rogram is„unning\n");

79 
	`´štf
("-p #\n");

80 
	`´štf
("\tş›Á…Üt, deçuÉ %d\n", 
CLIENT_PORT
);

82 
	`´štf
("\n");

83 
	`´štf
("-l #\n");

84 
	`´štf
("\tthe duration ofhe„un in seconds\n");

85 
	`´štf
("\n");

86 
	`´štf
("-wmin #\n");

87 
	`´štf
("\tlower warehouse id\n");

88 
	`´štf
("-wmax #\n");

89 
	`´štf
("\tupper warehouse id\n");

90 
	`´štf
("-w #\n");

91 
	`´štf
("\twarehouse cardinality, default 1\n");

92 
	`´štf
("-c #\n");

93 
	`´štf
("\tcu¡om” c¬dš®™y, deçuÉ %d\n", 
CUSTOMER_CARDINALITY
);

94 
	`´štf
("-i #\n");

95 
	`´štf
("\t™em c¬dš®™y, deçuÉ %d\n", 
ITEM_CARDINALITY
);

96 
	`´štf
("-o #\n");

97 
	`´štf
("\tÜd” c¬dš®™y, deçuÉ %d\n", 
ORDER_CARDINALITY
);

98 
	`´štf
("-n #\n");

99 
	`´štf
("\Šew-Üd” c¬dš®™y, deçuÉ %d\n", 
NEW_ORDER_CARDINALITY
);

100 
	`´štf
("\n");

101 
	`´štf
("-q %%\n");

102 
	`´štf
("\tmix…ercentage of Paymentransaction, default %0.2f\n",

103 
MIX_PAYMENT
);

104 
	`´štf
("-r %%\n");

105 
	`´štf
("\tmix…ercentage of Order-Statusransaction, default %0.2f\n",

106 
MIX_ORDER_STATUS
);

107 
	`´štf
("-e %%\n");

108 
	`´štf
("\tmix…ercentage of Deliveryransaction, default %0.2f\n",

109 
MIX_DELIVERY
);

110 
	`´štf
("-t %%\n");

111 
	`´štf
("\tmix…ercentage of Stock-Levelransaction, default %0.2f\n",

112 
MIX_STOCK_LEVEL
);

113 
	`´štf
("\n");

114 
	`´štf
("-ktd #\n");

115 
	`´štf
("\td–iv”y keyšgime, deçuÉ %d s\n", 
KEY_TIME_DELIVERY
);

116 
	`´štf
("-ktn #\n");

117 
	`´štf
("\Šew-Üd” keyšgime, deçuÉ %d s\n", 
KEY_TIME_NEW_ORDER
);

118 
	`´štf
("-kto #\n");

119 
	`´štf
("\torder-status keyingime, default %d s\n",

120 
KEY_TIME_ORDER_STATUS
);

121 
	`´štf
("-ktp #\n");

122 
	`´štf
("\aym’ˆkeyšgime, deçuÉ %d s\n", 
KEY_TIME_PAYMENT
);

123 
	`´štf
("-kts #\n");

124 
	`´štf
("\tstock-level keyingime, default %d s\n",

125 
KEY_TIME_STOCK_LEVEL
);

126 
	`´štf
("-ttd #\n");

127 
	`´štf
("\tdeliveryhinkingime, default %d ms\n",

128 
THINK_TIME_DELIVERY
);

129 
	`´štf
("-ttn #\n");

130 
	`´štf
("\tnew-orderhinkingime, default %d ms\n",

131 
THINK_TIME_NEW_ORDER
);

132 
	`´štf
("-tto #\n");

133 
	`´štf
("\torder-statushinkingime, default %d ms\n",

134 
THINK_TIME_ORDER_STATUS
);

135 
	`´štf
("-ttp #\n");

136 
	`´štf
("\aym’ˆthškšgime, deçuÉ %d ms\n", 
THINK_TIME_PAYMENT
);

137 
	`´štf
("-tts #\n");

138 
	`´štf
("\tstock-levelhinkingime, default %d ms\n",

139 
THINK_TIME_STOCK_LEVEL
);

140 
	`´štf
("\n");

141 
	`´štf
("-tpw #\n");

142 
	`´štf
("\tterminals started…er warehouse, default 10\n");

144 
	`´štf
("\n");

145 
	`´štf
("-seed #\n");

146 
	`´štf
("\trandom‚umber seed\n");

147 
	`´štf
("-altered [0/1]\n");

148 
	`´štf
("\trun with‡hread…er user, -altered 1\n");

149 
	`´štf
("-sleep #\n");

150 
	`´štf
("\tnumber of millisecondso sleep betweenerminal creation\n");

151 
	`´štf
("-spread #\n");

152 
	`´štf
("\tfancy warehouse skippingrick for†ow i/o„uns\n");

154 
	`´štf
("-z #\n");

155 
	`´štf
("\tperform database integrity check\n");

156 #ifdeà
STANDALONE


157 
	`´štf
("\nDriver is in STANDALONE mode.\n");

162 
	`ü—‹_pid_fe
();

164 if(
	`š™_loggšg
(è!ğ
OK
 || 
	`š™_driv”_loggšg
() != OK) {

165 
	`´štf
("cannot init driver\n");

170 ià(
w_id_mš
 > 
w_id_max
) {

171 
	`´štf
("wmin cannot be†argerhan wmax\n");

174 ià(
w_id_max
 > 
bË_ÿrdš®™y
.
w¬ehou£s
) {

175 
	`´štf
("wmax cannot be†argerhan w\n");

179 ià(
	`»ÿlcuÏ‹_mix
(è!ğ
OK
) {

180 
	`´štf
("invalidransaction mix: -e %0.2f. -r %0.2f. -q %0.2f. -t %0.2f. causes‚ew-order mix of %0.2f.\n",

181 
Œª§ùiÚ_mix
.
d–iv”y_aùu®
,

182 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
,

183 
Œª§ùiÚ_mix
.
·ym’t_aùu®
,

184 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
,

185 
Œª§ùiÚ_mix
.
Ãw_Üd”_aùu®
);

190 
	`´štf
("\n");

191 
	`´štf
("databaseable cardinalities:\n");

192 
	`´štf
("w¬ehou£ ğ%d\n", 
bË_ÿrdš®™y
.
w¬ehou£s
);

193 
	`´štf
("di¡riù ğ%d\n", 
bË_ÿrdš®™y
.
di¡riùs
);

194 
	`´štf
("cu¡om” ğ%d\n", 
bË_ÿrdš®™y
.
cu¡om”s
);

195 
	`´štf
("™em ğ%d\n", 
bË_ÿrdš®™y
.
™ems
);

196 
	`´štf
("Üd” ğ%d\n", 
bË_ÿrdš®™y
.
Üd”s
);

197 
	`´štf
("¡ock = %d\n", 
bË_ÿrdš®™y
.
™ems
);

198 
	`´štf
("Ãw-Üd” ğ%d\n", 
bË_ÿrdš®™y
.
Ãw_Üd”s
);

199 
	`´štf
("\n");

202 
	`´štf
("transaction mix:\n");

203 
	`´štf
("Ãw-Üd” mix %0.2f\n", 
Œª§ùiÚ_mix
.
Ãw_Üd”_aùu®
);

204 
	`´štf
("·ym’ˆmix %0.2f\n", 
Œª§ùiÚ_mix
.
·ym’t_aùu®
);

205 
	`´štf
("Üd”-¡©u mix %0.2f\n", 
Œª§ùiÚ_mix
.
Üd”_¡©us_aùu®
);

206 
	`´štf
("d–iv”y mix %0.2f\n", 
Œª§ùiÚ_mix
.
d–iv”y_aùu®
);

207 
	`´štf
("¡ock-Ëv– mix %0.2f\n", 
Œª§ùiÚ_mix
.
¡ock_Ëv–_aùu®
);

208 
	`´štf
("\n");

211 
	`´štf
("transactionhresholds:\n");

212 
	`´štf
("new-orderhreshold %0.2f\n",

213 
Œª§ùiÚ_mix
.
Ãw_Üd”_th»shŞd
);

214 
	`´štf
("·ym’ˆth»shŞd %0.2f\n", 
Œª§ùiÚ_mix
.
·ym’t_th»shŞd
);

215 
	`´štf
("order-statushreshold %0.2f\n",

216 
Œª§ùiÚ_mix
.
Üd”_¡©us_th»shŞd
);

217 
	`´štf
("deliveryhreshold %0.2f\n",

218 
Œª§ùiÚ_mix
.
d–iv”y_th»shŞd
);

219 
	`´štf
("stock-levelhreshold %0.2f\n",

220 
Œª§ùiÚ_mix
.
¡ock_Ëv–_th»shŞd
);

221 
	`´štf
("\n");

224 
	`´štf
("d–iv”y keyšgim%d s\n", 
key_time
.
d–iv”y
);

225 
	`´štf
("Ãw_Üd” keyšgim%d s\n", 
key_time
.
Ãw_Üd”
);

226 
	`´štf
("Üd”-¡©u keyšgim%d s\n", 
key_time
.
Üd”_¡©us
);

227 
	`´štf
("·ym’ˆkeyšgim%d s\n", 
key_time
.
·ym’t
);

228 
	`´štf
("¡ock-Ëv– keyšgim%d s\n", 
key_time
.
¡ock_Ëv–
);

229 
	`´štf
("\n");

233 
	`´štf
("d–iv”yhškšgim%d ms\n", 
thšk_time
.
d–iv”y
);

234 
	`´štf
("Ãw_Üd”hškšgim%d ms\n", 
thšk_time
.
Ãw_Üd”
);

235 
	`´štf
("Üd”-¡©u thškšgim%d ms\n", 
thšk_time
.
Üd”_¡©us
);

236 
	`´štf
("·ym’ˆthškšgim%d ms\n", 
thšk_time
.
·ym’t
);

237 
	`´štf
("¡ock-Ëv–hškšgim%d ms\n", 
thšk_time
.
¡ock_Ëv–
);

238 
	`´štf
("\n");

240 
	`´štf
("w_id„ªg%dØ%d\n", 
w_id_mš
, 
w_id_max
);

241 
	`´štf
("\n");

243 
	`´štf
("%d”mš® ³¸w¬ehou£\n", 
‹rmš®s_³r_w¬ehou£
);

244 
	`´štf
("\n");

246 
	`´štf
("%d secÚd s‹ady s‹ du¿tiÚ\n", 
du¿tiÚ
);

247 
	`´štf
("\n");

249 ià(
³rfÜm_š‹gr™y_check
 && 
	`š‹gr™y_‹rmš®_wÜk”
(è!ğ
OK
) {

250 
	`´štf
("You used wrong…arameters or something wrong with database.\n");

254 
	`¡¬t_driv”
();

257 
	}
}

259 
	$·r£_¬gum’ts
(
¬gc
, *
¬gv
[])

261 
i
;

262 *
æag
;

264 ià(
¬gc
 < 9) {

265  
ERROR
;

268 
i
 = 1; i < 
¬gc
; i += 2) {

269 ià(
	`¡¾’
(
¬gv
[
i
]) < 2) {

270 
	`´štf
("šv®id fÏg: %s\n", 
¬gv
[
i
]);

271 
	`ex™
(1);

273 
æag
 = 
¬gv
[
i
] + 1;

274 ià(
	`¡rcmp
(
æag
, "d") == 0) {

275 
	`£t_ş›Á_ho¡Çme
(
¬gv
[
i
 + 1]);

276 #ifdeà
LIBPQ


277 } ià(
	`¡rcmp
(
æag
, "z") == 0) {

278 
	`¡rıy
(
po¡ma¡”_pÜt
, 
¬gv
[
i
 + 1]);

280 #ifdeà
LIBMYSQL


281 } ià(
	`¡rcmp
(
æag
, "z") == 0) {

282 
	`¡rıy
(
dbt2_mysql_pÜt
, 
¬gv
[
i
 + 1]);

284 #ifdeà
LIBDRIZZLE


285 } ià(
	`¡rcmp
(
æag
, "z") == 0) {

286 
	`¡rıy
(
dbt2_drizzË_pÜt
, 
¬gv
[
i
 + 1]);

288 } ià(
	`¡rcmp
(
æag
, "p") == 0) {

289 
	`£t_ş›Á_pÜt
(
	`©oi
(
¬gv
[
i
 + 1]));

290 } ià(
	`¡rcmp
(
æag
, "l") == 0) {

291 
	`£t_du¿tiÚ
(
	`©oi
(
¬gv
[
i
 + 1]));

292 } ià(
	`¡rcmp
(
æag
, "w") == 0) {

293 
	`£t_bË_ÿrdš®™y
(
TABLE_WAREHOUSE
, 
	`©oi
(
¬gv
[
i
 + 1]));

294 } ià(
	`¡rcmp
(
æag
, "c") == 0) {

295 
	`£t_bË_ÿrdš®™y
(
TABLE_CUSTOMER
, 
	`©oi
(
¬gv
[
i
 + 1]));

296 } ià(
	`¡rcmp
(
æag
, "i") == 0) {

297 
	`£t_bË_ÿrdš®™y
(
TABLE_ITEM
, 
	`©oi
(
¬gv
[
i
 + 1]));

298 } ià(
	`¡rcmp
(
æag
, "o") == 0) {

299 
	`£t_bË_ÿrdš®™y
(
TABLE_ORDER
, 
	`©oi
(
¬gv
[
i
 + 1]));

300 } ià(
	`¡rcmp
(
æag
, "s") == 0) {

301 
	`£t_bË_ÿrdš®™y
(
TABLE_STOCK
, 
	`©oi
(
¬gv
[
i
 + 1]));

302 } ià(
	`¡rcmp
(
æag
, "n") == 0) {

303 
	`£t_bË_ÿrdš®™y
(
TABLE_NEW_ORDER
, 
	`©oi
(
¬gv
[
i
 + 1]));

304 } ià(
	`¡rcmp
(
æag
, "q") == 0) {

305 
	`£t_Œª§ùiÚ_mix
(
PAYMENT
, 
	`©of
(
¬gv
[
i
 + 1]));

306 } ià(
	`¡rcmp
(
æag
, "r") == 0) {

307 
	`£t_Œª§ùiÚ_mix
(
ORDER_STATUS
, 
	`©of
(
¬gv
[
i
 + 1]));

308 } ià(
	`¡rcmp
(
æag
, "e") == 0) {

309 
	`£t_Œª§ùiÚ_mix
(
DELIVERY
, 
	`©of
(
¬gv
[
i
 + 1]));

310 } ià(
	`¡rcmp
(
æag
, "t") == 0) {

311 
	`£t_Œª§ùiÚ_mix
(
STOCK_LEVEL
, 
	`©of
(
¬gv
[
i
 + 1]));

312 } ià(
	`¡rcmp
(
æag
, "z") == 0) {

313 
³rfÜm_š‹gr™y_check
 = 1;

314 } ià(
	`¡rcmp
(
æag
, "wmin") == 0) {

315 
w_id_mš
 = 
	`©oi
(
¬gv
[
i
 + 1]);

316 } ià(
	`¡rcmp
(
æag
, "wmax") == 0) {

317 
w_id_max
 = 
	`©oi
(
¬gv
[
i
 + 1]);

318 } ià(
	`¡rcmp
(
æag
, "ktd") == 0) {

319 
key_time
.
d–iv”y
 = 
	`©oi
(
¬gv
[
i
 + 1]);

320 } ià(
	`¡rcmp
(
æag
, "ktn") == 0) {

321 
key_time
.
Ãw_Üd”
 = 
	`©oi
(
¬gv
[
i
 + 1]);

322 } ià(
	`¡rcmp
(
æag
, "kto") == 0) {

323 
key_time
.
Üd”_¡©us
 = 
	`©oi
(
¬gv
[
i
 + 1]);

324 } ià(
	`¡rcmp
(
æag
, "ktp") == 0) {

325 
key_time
.
·ym’t
 = 
	`©oi
(
¬gv
[
i
 + 1]);

326 } ià(
	`¡rcmp
(
æag
, "kts") == 0) {

327 
key_time
.
¡ock_Ëv–
 = 
	`©oi
(
¬gv
[
i
 + 1]);

328 } ià(
	`¡rcmp
(
æag
, "ttd") == 0) {

329 
thšk_time
.
d–iv”y
 = 
	`©oi
(
¬gv
[
i
 + 1]);

330 } ià(
	`¡rcmp
(
æag
, "ttn") == 0) {

331 
thšk_time
.
Ãw_Üd”
 = 
	`©oi
(
¬gv
[
i
 + 1]);

332 } ià(
	`¡rcmp
(
æag
, "tto") == 0) {

333 
thšk_time
.
Üd”_¡©us
 = 
	`©oi
(
¬gv
[
i
 + 1]);

334 } ià(
	`¡rcmp
(
æag
, "ttp") == 0) {

335 
thšk_time
.
·ym’t
 = 
	`©oi
(
¬gv
[
i
 + 1]);

336 } ià(
	`¡rcmp
(
æag
, "tts") == 0) {

337 
thšk_time
.
¡ock_Ëv–
 = 
	`©oi
(
¬gv
[
i
 + 1]);

338 } ià(
	`¡rcmp
(
æag
, "tpw") == 0) {

339 
‹rmš®s_³r_w¬ehou£
 = 
	`©oi
(
¬gv
[
i
 + 1]);

340 } ià(
	`¡rcmp
(
æag
, "sleep") == 0) {

341 
ş›Á_cÚn_¦“p
 = 
	`©oi
(
¬gv
[
i
 + 1]);

342 } ià(
	`¡rcmp
(
æag
, "spread") == 0) {

343 
¥»ad
 = 
	`©oi
(
¬gv
[
i
 + 1]);

344 } ià(
	`¡rcmp
(
æag
, "seed") == 0) {

345 
couÁ
;

346 
Ëngth
;

348 
£ed
 = 0;

349 
Ëngth
 = 
	`¡¾’
(
¬gv
[
i
 + 1]);

351 
couÁ
 = 0; couÁ < 
Ëngth
; count++) {

352 
£ed
 +ğ(
¬gv
[
i
 + 1][
couÁ
] - '0') *

353 (è
	`pow
(10, 
Ëngth
 - (
couÁ
 + 1));

355 } ià(
	`¡rcmp
(
æag
, "altered") == 0) {

356 
mode_®‹»d
 = 
	`©oi
(
¬gv
[
i
 + 1]);

357 #ifdeà
STANDALONE


358 } ià(
	`¡rcmp
(
æag
, "dbc") == 0) {

359 
db_cÚÃùiÚs
 = 
	`©oi
(
¬gv
[
i
 + 1]);

360 } ià(
	`¡rcmp
(
æag
, "dbname") == 0) {

361 
	`¡rıy
(
¢ame
, 
¬gv
[
i
 + 1]);

363 } ià(
	`¡rcmp
(
æag
, "outdir") == 0) {

364 
	`¡rıy
(
ouut_·th
, 
¬gv
[
i
 + 1]);

366 
	`´štf
("šv®id fÏg: %s\n", 
¬gv
[
i
]);

367 
	`ex™
(1);

371  
OK
;

372 
	}
}

	@drizzle/dbc_common.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"drizzË_commÚ.h
"

13 
	~<¡dio.h
>

15 
	gdrizzË_dbÇme
[32] = "dbt2";

16 
	gdrizzË_ho¡
[32] = "localhost";

17 
	gdrizzË_u£r
[32] = "root";

18 
	gdrizzË_·ss
[32] = "";

19 
	gdrizzË_pÜt
[32] = "4427";

20 
	gdrizzË_sock‘_t
[256] = "/tmp/drizzle.sock";

22 
	$comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

25 ()
	`drizzË_qu”y_¡r
(
dbc
->
drizzË_cÚ
, dbc->
drizzË_»suÉ_£t
, "COMMIT", &
drizzË_»tuº
);

26 ià(
drizzË_»tuº
 !ğ
DRIZZLE_RETURN_OK
)

28 
	`´štf
("drizzË_qu”y COMMIT faed: %s\n", 
	`drizzË_cÚ_”rÜ
(
dbc
->
drizzË_cÚ
));

29  
ERROR
;

31  
OK
;

32 
	}
}

35 
	$_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
)

37 
dbc
->
drizzË
ğ
	`drizzË_ü—‹
(
NULL
);

38 ià(
dbc
->
drizzË
 =ğ
NULL
)

40 
	`´štf
("drizzle_create failed\n");

41  
ERROR
;

44 
dbc
->
drizzË_cÚ
ğ
	`drizzË_cÚ_ü—‹
(dbc->
drizzË
, 
NULL
);

45 ià(
dbc
->
drizzË_cÚ
 =ğ
NULL
)

47 
	`´štf
("drizzle_con_create failed\n");

48  
ERROR
;

51 
	`drizzË_cÚ_£t_tı
(
dbc
->
drizzË_cÚ
, 
drizzË_ho¡
, 
	`©oi
(
drizzË_pÜt
));

52 
	`drizzË_cÚ_£t_db
(
dbc
->
drizzË_cÚ
, 
drizzË_dbÇme
);

53 
	`drizzË_cÚ_£t_İtiÚs
(
dbc
->
drizzË_cÚ
, 
DRIZZLE_CON_MYSQL
);

56 ()
	`drizzË_qu”y_¡r
(
dbc
->
drizzË_cÚ
, dbc->
drizzË_»suÉ_£t
, "SET AUTOCOMMIT=0", &
drizzË_»tuº
);

57 ià(
drizzË_»tuº
 !ğ
DRIZZLE_RETURN_OK
)

59 
	`´štf
("drizzË_qu”y AUTOCOMMIT=0: %s\n", 
	`drizzË_cÚ_”rÜ
(
dbc
->
drizzË_cÚ
));

60  
ERROR
;

64  
OK
;

65 
	}
}

68 
	$_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
)

70 
	`drizzË_cÚ_ä“
(
dbc
->
drizzË_cÚ
);

71 
	`drizzË_ä“
(
dbc
->
drizzË
);

72  
OK
;

73 
	}
}

75 
	$_db_š™
(* 
_drizzË_dbÇme
, *
_drizzË_ho¡
, * 
_drizzË_u£r
,

76 * 
_drizzË_·ss
, * 
_drizzË_pÜt
, * 
_drizzË_sock‘
)

79 ià(
_drizzË_dbÇme
 !ğ
NULL
) {

80 
	`¡rıy
(
drizzË_dbÇme
, 
_drizzË_dbÇme
);

82 ià(
_drizzË_ho¡
 !ğ
NULL
) {

83 
	`¡rıy
(
drizzË_ho¡
, 
_drizzË_ho¡
);

85 ià(
_drizzË_u£r
 !ğ
NULL
) {

86 
	`¡rıy
(
drizzË_u£r
, 
_drizzË_u£r
);

88 ià(
_drizzË_·ss
 !ğ
NULL
) {

89 
	`¡rıy
(
drizzË_·ss
, 
_drizzË_·ss
);

91 ià(
_drizzË_pÜt
 !ğ
NULL
) {

92 
	`¡rıy
(
drizzË_pÜt
, 
_drizzË_pÜt
);

94 ià(
_drizzË_sock‘
 !ğ
NULL
) {

95 
	`¡rıy
(
drizzË_sock‘_t
, 
_drizzË_sock‘
);

97  
OK
;

98 
	}
}

100 
	$rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

102 
	`LOG_ERROR_MESSAGE
("ROLLBACK INITIATED\n");

104 ()
	`drizzË_qu”y_¡r
(
dbc
->
drizzË_cÚ
, dbc->
drizzË_»suÉ_£t
, "ROLLBACK", &
drizzË_»tuº
);

105 ià(
drizzË_»tuº
 !ğ
DRIZZLE_RETURN_OK
)

107 
	`´štf
("drizzË_qu”y ROLLBACK faed: %s\n", 
	`drizzË_cÚ_”rÜ
(
dbc
->
drizzË_cÚ
));

108  
ERROR
;

111  
STATUS_ROLLBACK
;

112 
	}
}

120 
	$dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
, 
sql_»suÉ_t
 * 
sql_»suÉ
, * 
qu”y_Çme
)

123 
sql_»suÉ
->
»suÉ_£t
ğ
NULL
;

124 
sql_»suÉ
->
num_cŞumns
= 0;

125 
sql_»suÉ
->
num_rows
= 0;

126 
sql_»suÉ
->
qu”y
=query;

128 
sql_»suÉ
->
»suÉ_£t
ğ
	`drizzË_qu”y_¡r
(
dbc
->
drizzË_cÚ
, 
NULL
, 
qu”y
, &
drizzË_»tuº
);

129 ià(
drizzË_»tuº
 !ğ
DRIZZLE_RETURN_OK
)

131 
	`LOG_ERROR_MESSAGE
("drizzË_qu”y % çed: %s\n", 
qu”y
, 
	`drizzË_cÚ_”rÜ
(
dbc
->
drizzË_cÚ
));

136 
drizzË_»tuº
 = 
	`drizzË_»suÉ_bufãr
(
sql_»suÉ
->
»suÉ_£t
);

137 ià(
drizzË_»tuº
 !ğ
DRIZZLE_RETURN_OK
)

139 
	`´štf
("drizzË_»suÉ_bufãr:%s\n", 
	`drizzË_cÚ_”rÜ
(
dbc
->
drizzË_cÚ
));

144 ià(
sql_»suÉ
->
»suÉ_£t
->
row_couÁ
)

146 
sql_»suÉ
->
num_cŞumns
ğ
	`drizzË_»suÉ_cŞumn_couÁ
(sql_»suÉ->
»suÉ_£t
);

147 
sql_»suÉ
->
num_rows
ğsql_»suÉ->
»suÉ_£t
->
row_couÁ
;

151 
sql_»suÉ
->
num_rows
 = 
	`drizzË_»suÉ_afãùed_rows
(sql_»suÉ->
»suÉ_£t
);

156 
	}
}

158 
	$dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
)

160 
sql_»suÉ
->
cu¼’t_row
ğ
	`drizzË_row_Ãxt
(sql_»suÉ->
»suÉ_£t
);

161 ià(
sql_»suÉ
->
cu¼’t_row
)

163 
sql_»suÉ
->
Ëngths
ğ
	`drizzË_row_f›ld_sizes
(sql_»suÉ->
»suÉ_£t
);

167 
	}
}

169 
	$dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
)

172 ià(
sql_»suÉ
->
»suÉ_£t
)

174 
	`drizzË_»suÉ_ä“
(
sql_»suÉ
->
»suÉ_£t
);

178 
	}
}

181 * 
	$dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
, 
f›ld
)

183 * 
tmp
;

185 
tmp
ğ
NULL
;

187 ià(
sql_»suÉ
->
cu¼’t_row
 && 
f›ld
 < sql_»suÉ->
num_cŞumns
)

189 ià(
sql_»suÉ
->
cu¼’t_row
[
f›ld
])

191 ià((
tmp
 = 
	`ÿÎoc
((), 
sql_»suÉ
->
Ëngths
[
f›ld
]+1)))

193 
	`memıy
(
tmp
, (
sql_»suÉ
->
cu¼’t_row
)[
f›ld
], sql_»suÉ->
Ëngths
[field]);

197 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: CALLOC FAILED fÜ v®uäom f›ld=%d\n", 
f›ld
);

202 #ifdeà
DEBUG_QUERY


203 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: v¬[%d]=NULL\n", 
f›ld
);

209 #ifdeà
DEBUG_QUERY


210 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: POSSIBLE NULL VALUE o¸ERROR\nQu”y: %s\nF›ld: %d from %d", 
sql_»suÉ
->
qu”y
, 
f›ld
, sql_»suÉ->
num_cŞumns
);

213  
tmp
;

214 
	}
}

	@include/_semaphore.h

10 #iâdeà
__£m­hÜe_h_


11 
	#__£m­hÜe_h_


	)

13 
	~<±h»ad.h
>

15 #ià
defšed
(
HAVE_SEMAPHORE_H
è&& !defšed(
BROKEN_SEMAPHORES
)

16 
	~<£m­hÜe.h
>

19 
±h»ad_mu‹x_t
 
	mmu‹x
;

20 
±h»ad_cÚd_t
 
	mcÚd
;

21 
	mcouÁ
;

22 } 
	t£m_t
;

24 
£m_š™
(
£m_t
 * 
£m
, 
psh¬ed
, 
v®ue
);

25 
£m_de¡roy
(
£m_t
 * 
£m
);

26 
£m_Œywa™
(
£m_t
 * 
£m
);

27 
£m_wa™
(
£m_t
 * 
£m
);

28 
£m_po¡
(
£m_t
 * 
£m
);

29 
£m_po¡_muÉË
(
£m_t
 * 
£m
, 
couÁ
);

30 
£m_g‘v®ue
(
£m_t
 * 
£m
, * 
sv®
);

	@include/_socket.h

13 #iâdeà
__SOCKET_H_


14 
	#__SOCKET_H_


	)

16 
	#ERR_SOCKET_CREATE
 -1

	)

17 
	#ERR_SOCKET_BIND
 -2

	)

18 
	#ERR_SOCKET_LISTEN
 -3

	)

19 
	#ERR_SOCKET_RESOLVPROTO
 -4

	)

21 
	~<Ãtdb.h
>

22 
	~<sys/ty³s.h
>

23 
	~<sys/sock‘.h
>

24 
	~<Ãtš‘/š.h
>

25 
	~<¬·/š‘.h
>

27 
_acû±
(*
s
);

28 
_cÚÃù
(*
add»ss
, 
pÜt
);

29 
_»ûive
(
s
, *
d©a
, 
Ëngth
);

30 
_£nd
(
s
, *
d©a
, 
Ëngth
);

31 
_li¡’
(
pÜt
);

	@include/client_interface.h

12 #iâdeà
_CLIENT_INTERFACE_H_


13 
	#_CLIENT_INTERFACE_H_


	)

15 
	~<Œª§ùiÚ_d©a.h
>

17 
	sş›Á_Œª§ùiÚ_t


19 
	m¡©us
;

20 
	mŒª§ùiÚ
;

21 
Œª§ùiÚ_d©a_t
 
	mŒª§ùiÚ_d©a
;

24 
cÚÃù_to_ş›Á
(*
addr
, 
pÜt
);

25 
»ûive_Œª§ùiÚ_d©a
(
s
, 
ş›Á_Œª§ùiÚ_t
 *
ş›Á_d©a
);

26 
£nd_Œª§ùiÚ_d©a
(
s
, 
ş›Á_Œª§ùiÚ_t
 *
ş›Á_d©a
);

	@include/common.h

10 #iâdeà
_COMMON_H_


11 
	#_COMMON_H_


	)

13 #ifdeà
HAVE_CONFIG_H


14 
	~<cÚfig.h
>

17 
	~<¡dio.h
>

18 
	~<¡dlib.h
>

20 
	~<time.h
>

21 
	~<sys/time.h
>

23 #ià
defšed
(
ODBC
è|| defšed(
LIBMYSQL
è|| defšed(
LIBDRIZZLE
)

24 
	#DB_USER
 "dbt"

	)

25 
	#DB_PASS
 ""

	)

28 #ià
defšed
(
LIBPQ
è|| defšed(
LIBMYSQL
è|| defšed(
LIBDRIZZLE
)

29 
	#DB_NAME
 "dbt2"

	)

32 
	#DELIVERY
 0

	)

33 
	#NEW_ORDER
 1

	)

34 
	#ORDER_STATUS
 2

	)

35 
	#PAYMENT
 3

	)

36 
	#STOCK_LEVEL
 4

	)

37 
	#TRANSACTION_MAX
 5

	)

38 
	#INTEGRITY
 10

	)

40 
	#TABLE_WAREHOUSE
 0

	)

41 
	#TABLE_DISTRICT
 1

	)

42 
	#TABLE_CUSTOMER
 2

	)

43 
	#TABLE_ITEM
 3

	)

44 
	#TABLE_ORDER
 4

	)

45 
	#TABLE_STOCK
 5

	)

46 
	#TABLE_NEW_ORDER
 6

	)

48 
	#ERROR
 0

	)

49 
	#OK
 1

	)

50 
	#EXIT_CODE
 2

	)

51 
	#ERROR_SOCKET_CLOSED
 3

	)

52 
	#STATUS_ROLLBACK
 4

	)

53 
	#ERROR_RECEIVE_TIMEOUT
 5

	)

55 
	#A_STRING_CHAR_LEN
 128

	)

56 
	#L_STRING_CHAR_LEN
 52

	)

57 
	#N_STRING_CHAR_LEN
 10

	)

58 
	#TIMESTAMP_LEN
 28

	)

60 
	#CUSTOMER_CARDINALITY
 3000

	)

61 
	#DISTRICT_CARDINALITY
 10

	)

62 
	#ITEM_CARDINALITY
 100000

	)

63 
	#ORDER_CARDINALITY
 3000

	)

64 
	#STOCK_CARDINALITY
 100000

	)

65 
	#NEW_ORDER_CARDINALITY
 900

	)

67 
	#D_CITY_LEN
 20

	)

68 
	#D_NAME_LEN
 10

	)

69 
	#D_STATE_LEN
 2

	)

70 
	#D_STREET_1_LEN
 20

	)

71 
	#D_STREET_2_LEN
 20

	)

72 
	#D_ZIP_LEN
 9

	)

74 
	#C_CREDIT_LEN
 2

	)

75 
	#C_DATA_LEN
 500

	)

76 
	#C_FIRST_LEN
 16

	)

77 
	#C_LAST_LEN
 16

	)

78 
	#C_MIDDLE_LEN
 2

	)

79 
	#C_STREET_1_LEN
 20

	)

80 
	#C_STREET_2_LEN
 20

	)

81 
	#C_CITY_LEN
 20

	)

82 
	#C_PHONE_LEN
 16

	)

83 
	#C_SINCE_LEN
 
TIMESTAMP_LEN


	)

84 
	#C_STATE_LEN
 2

	)

85 
	#C_ZIP_LEN
 9

	)

87 
	#I_NAME_LEN
 24

	)

89 
	#O_ENTRY_D_LEN
 
TIMESTAMP_LEN


	)

91 
	#OL_DELIVERY_D_LEN
 
TIMESTAMP_LEN


	)

93 
	#W_CITY_LEN
 20

	)

94 
	#W_NAME_LEN
 10

	)

95 
	#W_STATE_LEN
 2

	)

96 
	#W_STREET_1_LEN
 20

	)

97 
	#W_STREET_2_LEN
 20

	)

98 
	#W_ZIP_LEN
 9

	)

100 
	#C_ID_UNKNOWN
 0

	)

101 
	#C_LAST_SYL_MAX
 10

	)

102 
	#D_ID_MAX
 10

	)

103 
	#O_OL_CNT_MAX
 15

	)

104 
	#O_CARRIER_ID_MAX
 10

	)

106 
	#CLIENT_PORT
 30000

	)

108 
	#CLIENT_PID_FILENAME
 "dbt2_ş›Á.pid"

	)

109 
	#DRIVER_PID_FILENAME
 "dbt2_driv”.pid"

	)

112 
	sbË_ÿrdš®™y_t
 {

113 
	mw¬ehou£s
;

114 
	mdi¡riùs
;

115 
	mcu¡om”s
;

116 
	m™ems
;

117 
	mÜd”s
;

118 
	mÃw_Üd”s
;

122 
difáimev®
(
timev®
 
¹1
, timev® 
¹0
);

123 
edump
(
ty³
, *
d©a
);

124 
g‘_a_¡ršg
(*
a_¡ršg
, 
x
, 
y
);

125 
g‘_c_Ï¡
(*
c_Ï¡
, 
i
);

126 
g‘_l_¡ršg
(*
l_¡ršg
, 
x
, 
y
);

127 
g‘_n_¡ršg
(*
n_¡ršg
, 
x
, 
y
);

128 
g‘_nu¿nd
(
a
, 
x
, 
y
);

129 
g‘_³rûÁage
();

130 
g‘_¿ndom
(
max
);

131 
g‘_thšk_time
(
m—n_thšk_time
);

132 
š™_commÚ
();

133 
ü—‹_pid_fe
();

135 
ouut_·th
[256];

136 cÚ¡ *
c_Ï¡_syl
[
C_LAST_SYL_MAX
];

137 
bË_ÿrdš®™y_t
 
bË_ÿrdš®™y
;

138 cÚ¡ 
Œª§ùiÚ_shÜt_Çme
[
TRANSACTION_MAX
];

139 *
Œª§ùiÚ_Çme
[
TRANSACTION_MAX
];

	@include/db.h

10 #iâdeà
_DB_H_


11 
	#_DB_H_


	)

13 #ifdeà
HAVE_CONFIG_H


14 
	~<cÚfig.h
>

17 
	~"Œª§ùiÚ_d©a.h
"

19 #ifdeà
ODBC


20 
	~"odbc_commÚ.h
"

23 #ifdeà
LIBPQ


24 
	~"libpq_commÚ.h
"

27 #ifdeà
LIBMYSQL


28 
	~"mysql_commÚ.h
"

31 #ifdeà
LIBDRIZZLE


32 
	~"drizzË_commÚ.h
"

35 #ifdeà
LIBSQLITE


36 
	~"sql™e_commÚ.h
"

39 
cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
);

40 #ifdeà
ODBC


41 
db_š™
(*
¢ame
, *
uÇme
, *
auth
);

43 #ifdeà
LIBPQ


44 
db_š™
(*
_dbÇme
, *
_pgho¡
, *
_pgpÜt
);

47 #ifdeà
LIBMYSQL


48 
db_š™
(* 
_mysql_dbÇme
, *
_mysql_ho¡
, * 
_mysql_u£r
,

49 * 
_mysql_·ss
, * 
_mysql_pÜt
, * 
_mysql_sock‘
);

52 #ifdeà
LIBDRIZZLE


53 
db_š™
(* 
_drizzË_dbÇme
, *
_drizzË_ho¡
, * 
_drizzË_u£r
,

54 * 
_drizzË_·ss
, * 
_drizzË_pÜt
, * 
_drizzË_sock‘
);

57 
discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
);

58 
´oûss_Œª§ùiÚ
(
Œª§ùiÚ
, 
db_cÚ‹xt_t
 *
dbc
,

59 
Œª§ùiÚ_d©a_t
 *
odbù
);

	@include/db_threadpool.h

12 
	~<_£m­hÜe.h
>

14 
£m_t
 
db_wÜk”_couÁ
;

15 
db_cÚÃùiÚs
;

16 
db_cÚn_¦“p
;

17 *
wÜk”_couÁ
;

18 
time_t
 *
Ï¡_txn
;

20 
db_th»adpoŞ_š™
();

	@include/driver.h

12 #iâdeà
_DRIVER_H_


13 
	#_DRIVER_H_


	)

15 
	#MIX_DELIVERY
 0.04

	)

16 
	#MIX_ORDER_STATUS
 0.04

	)

17 
	#MIX_PAYMENT
 0.43

	)

18 
	#MIX_STOCK_LEVEL
 0.04

	)

20 
	#KEY_TIME_DELIVERY
 2

	)

21 
	#KEY_TIME_NEW_ORDER
 18

	)

22 
	#KEY_TIME_ORDER_STATUS
 2

	)

23 
	#KEY_TIME_PAYMENT
 3

	)

24 
	#KEY_TIME_STOCK_LEVEL
 2

	)

26 
	#THINK_TIME_DELIVERY
 5000

	)

27 
	#THINK_TIME_NEW_ORDER
 12000

	)

28 
	#THINK_TIME_ORDER_STATUS
 10000

	)

29 
	#THINK_TIME_PAYMENT
 12000

	)

30 
	#THINK_TIME_STOCK_LEVEL
 5000

	)

32 
	#EXECUTING
 0

	)

33 
	#KEYING
 1

	)

34 
	#THINKING
 2

	)

36 
	skey_time_t


38 
	md–iv”y
;

39 
	mÃw_Üd”
;

40 
	mÜd”_¡©us
;

41 
	m·ym’t
;

42 
	m¡ock_Ëv–
;

45 
	s‹rmš®_cÚ‹xt_t


47 
	mw_id
;

48 
	md_id
;

51 
	sŒª§ùiÚ_mix_t


57 
	md–iv”y_aùu®
;

58 
	mÃw_Üd”_aùu®
;

59 
	m·ym’t_aùu®
;

60 
	mÜd”_¡©us_aùu®
;

61 
	m¡ock_Ëv–_aùu®
;

67 
	md–iv”y_th»shŞd
;

68 
	mÃw_Üd”_th»shŞd
;

69 
	m·ym’t_th»shŞd
;

70 
	mÜd”_¡©us_th»shŞd
;

71 
	m¡ock_Ëv–_th»shŞd
;

74 
	sthšk_time_t


76 
	md–iv”y
;

77 
	mÃw_Üd”
;

78 
	mÜd”_¡©us
;

79 
	m·ym’t
;

80 
	m¡ock_Ëv–
;

83 
š™_driv”
();

84 
š™_driv”_loggšg
();

85 
š‹gr™y_‹rmš®_wÜk”
();

86 
»ÿlcuÏ‹_mix
();

87 
£t_ş›Á_ho¡Çme
(*
addr
);

88 
£t_ş›Á_pÜt
(
pÜt
);

89 
£t_du¿tiÚ
(
£cÚds
);

90 
£t_bË_ÿrdš®™y
(
bË
, 
ÿrdš®™y
);

91 
£t_Œª§ùiÚ_mix
(
Œª§ùiÚ
, 
mix
);

92 
¡¬t_driv”
();

94 
Œª§ùiÚ_mix_t
 
Œª§ùiÚ_mix
;

95 
key_time_t
 
key_time
;

96 
thšk_time_t
 
thšk_time
;

97 
ho¡Çme
[32];

98 
pÜt
;

99 
du¿tiÚ
;

100 
w_id_mš
, 
w_id_max
;

101 
‹rmš®s_³r_w¬ehou£
;

102 
mode_®‹»d
;

103 
£ed
;

104 
ş›Á_cÚn_¦“p
;

105 
¥»ad
;

	@include/drizzle_common.h

10 #iâdeà
_DRIZZLE_COMMON_H_


11 
	#_DRIZZLE_COMMON_H_


	)

13 
	~<libdrizzË/drizzË_ş›Á.h
>

14 
	~<¡ršg.h
>

15 
	~"Œª§ùiÚ_d©a.h
"

17 
drizzË_»tuº_t
 
	gdrizzË_»tuº
;

19 
	sdb_cÚ‹xt_t
 {

20 
drizzË_¡
 * 
	mdrizzË
;

21 
drizzË_cÚ_¡
 * 
	mdrizzË_cÚ
;

22 
drizzË_»suÉ_¡
 * 
	mdrizzË_»suÉ_£t
;

25 
	ssql_»suÉ_t


27 
drizzË_»suÉ_¡
 * 
	m»suÉ_£t
;

28 
drizzË_row_t
 
	mcu¼’t_row
;

30 
	mnum_cŞumns
;

31 
	mnum_rows
;

32 
size_t
 * 
	mËngths
;

33 * 
	mqu”y
;

36 
drizzË_dbÇme
[32];

37 
drizzË_ho¡
[32];

38 
drizzË_pÜt
[32];

39 
drizzË_u£r
[32];

40 
drizzË_·ss
[32];

41 
drizzË_sock‘_t
[256];

43 
comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

44 
_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
);

45 
_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
);

46 
_db_š™
(*
_drizzË_dbÇme
, *
_drizzË_ho¡
, * 
_drizzË_u£r
, * 
_drizzË_·ss
,

47 *
_drizzË_pÜt
, * 
_drizzË_sock‘
);

48 
rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

50 
dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
,

51 
sql_»suÉ_t
 * 
sql_»suÉ
, * 
qu”y_Çme
);

52 
dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

53 
dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

54 * 
dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
,

55 
f›ld
);

	@include/drizzle_delivery.h

10 #iâdeà
_DRIZZLE_DELIVERY_H_


11 
	#_DRIZZLE_DELIVERY_H_


	)

13 
	~"drizzË_commÚ.h
"

15 
execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
);

	@include/drizzle_integrity.h

10 #iâdeà
_DRIZZLE_INTEGRITY_H_


11 
	#_DRIZZLE_INTEGRITY_H_


	)

13 
	~"drizzË_commÚ.h
"

15 
execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
);

	@include/drizzle_new_order.h

10 #iâdeà
_DRIZZLE_NEW_ORDER_H_


11 
	#_DRIZZLE_NEW_ORDER_H_


	)

13 
	~"drizzË_commÚ.h
"

15 
execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
);

	@include/drizzle_order_status.h

10 #iâdeà
_DRIZZLE_ORDER_STATUS_H


11 
	#_DRIZZLE_ORDER_STATUS_H_


	)

13 
	~"drizzË_commÚ.h
"

15 
execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
);

	@include/drizzle_payment.h

10 #iâdeà
_DRIZZLE_PAYMENT_H_


11 
	#_DRIZZLE_PAYMENT_H_


	)

13 
	~"drizzË_commÚ.h
"

15 
execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
);

	@include/drizzle_stock_level.h

10 #iâdeà
_DRIZZLE_STOCK_LEVEL_H_


11 
	#_DRIZZLE_STOCK_LEVEL_H_


	)

13 
	~"drizzË_commÚ.h
"

15 
execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
);

	@include/input_data_generator.h

12 #iâdeà
_INPUT_DATA_GENERATOR_H_


13 
	#_INPUT_DATA_GENERATOR_H_


	)

15 
g’”©e_šput_d©a
(
ty³
, *
d©a
, 
w_id
);

16 
g’”©e_šput_d©a2
(
ty³
, *
d©a
, 
w_id
, 
d_id
);

	@include/libpq_common.h

10 #iâdeà
_LIBPQ_COMMON_H_


11 
	#_LIBPQ_COMMON_H_


	)

13 
	~<libpq-ã.h
>

15 
	~"Œª§ùiÚ_d©a.h
"

17 
	sdb_cÚ‹xt_t
 {

18 
PGcÚn
 *
	mcÚn
;

21 
comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

22 
_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
);

23 
_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
);

24 
_db_š™
(*
_dbÇme
, *
_pgho¡
, *
_pgpÜt
);

25 
rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

27 
dbÇme
[32];

28 
pgho¡
[32];

29 
pgpÜt
[32];

	@include/libpq_delivery.h

10 #iâdeà
_LIBPQ_DELIVERY_H_


11 
	#_LIBPQ_DELIVERY_H_


	)

13 
	~"libpq_commÚ.h
"

15 
execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
);

	@include/libpq_integrity.h

13 #iâdeà
_LIBPQ_INTEGRITY_H_


14 
	#_LIBPQ_INTEGRITY_H_


	)

16 
	~<libpq_commÚ.h
>

17 
	~<Œª§ùiÚ_d©a.h
>

19 
execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
);

	@include/libpq_new_order.h

10 #iâdeà
_LIBPQ_NEW_ORDER_H_


11 
	#_LIBPQ_NEW_ORDER_H_


	)

13 
	~"libpq_commÚ.h
"

15 
execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
);

	@include/libpq_order_status.h

10 #iâdeà
_LIBPQ_ORDER_STATUS_H_


11 
	#_LIBPQ_ORDER_STATUS_H_


	)

13 
	~"libpq_commÚ.h
"

15 
execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
);

	@include/libpq_payment.h

10 #iâdeà
_LIBPQ_PAYMENT_H_


11 
	#_LIBPQ_PAYMENT_H_


	)

13 
	~"libpq_commÚ.h
"

15 
execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
);

	@include/libpq_stock_level.h

10 #iâdeà
_LIBPQ_STOCK_LEVEL_H_


11 
	#_LIBPQ_STOCK_LEVEL_H_


	)

13 
	~"libpq_commÚ.h
"

15 
execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
);

	@include/listener.h

12 #iâdeà
_LISTENER_H_


13 
	#_LISTERNE_H_


	)

15 
	~<_£m­hÜe.h
>

17 
	~<Œª§ùiÚ_queue.h
>

19 *
š™_li¡’”
(*
d©a
);

21 
£m_t
 
li¡’”_wÜk”_couÁ
;

23 
»cyşe_node
(
Œª§ùiÚ_queue_node_t
 *
node
);

	@include/logging.h

12 #iâdeà
_LOGGING_H_


13 
	#_LOGGING_H_


	)

15 
	#ERROR_LOG_NAME
 "”rÜ.log"

	)

16 
	#LOG_ERROR_MESSAGE
(
¬g
...è
	`log_”rÜ_mes§ge
(
__FILE__
, 
__LINE__
, ##‡rg)

	)

18 
edump
(
ty³
, *
d©a
);

19 
š™_loggšg
();

20 
log_”rÜ_mes§ge
(*
f’ame
, 
lše
, cÚ¡ *
fmt
, ...);

	@include/mysql_common.h

10 #iâdeà
_MYSQL_COMMON_H_


11 
	#_MYSQL_COMMON_H_


	)

13 
	~<mysql.h
>

14 
	~<¡ršg.h
>

15 
	~"Œª§ùiÚ_d©a.h
"

17 
	sdb_cÚ‹xt_t
 {

18 
MYSQL
 * 
	mmysql
;

21 
	ssql_»suÉ_t


23 
MYSQL_RES
 * 
	m»suÉ_£t
;

24 
MYSQL_ROW
 
	mcu¼’t_row
;

25 
	mnum_f›lds
;

26 
	#HAVE_SQL_RESULT_NUM_ROWS


	)

27 
	mnum_rows
;

28 * 
	mËngths
;

29 * 
	mqu”y
;

32 
mysql_dbÇme
[32];

33 
mysql_ho¡
[32];

34 
mysql_pÜt_t
[32];

35 
mysql_u£r
[32];

36 
mysql_·ss
[32];

37 
mysql_sock‘_t
[256];

39 
comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

40 
_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
);

41 
_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
);

42 
_db_š™
(*
_mysql_dbÇme
, *
_mysql_ho¡
, * 
_mysql_u£r
, * 
_mysql_·ss
,

43 *
_mysql_pÜt
, * 
_mysql_sock‘
);

44 
rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

46 
dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
,

47 
sql_»suÉ_t
 * 
sql_»suÉ
, * 
qu”y_Çme
);

48 
dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

49 
dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

50 * 
dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
,

51 
f›ld
);

	@include/mysql_delivery.h

10 #iâdeà
_MYSQL_DELIVERY_H_


11 
	#_MYSQL_DELIVERY_H_


	)

13 
	~"mysql_commÚ.h
"

15 
execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
);

	@include/mysql_integrity.h

10 #iâdeà
_MYSQL_INTEGRITY_H_


11 
	#_MYSQL_INTEGRITY_H_


	)

13 
	~"mysql_commÚ.h
"

15 
execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
);

	@include/mysql_new_order.h

10 #iâdeà
_MYSQL_NEW_ORDER_H_


11 
	#_MYSQL_NEW_ORDER_H_


	)

13 
	~"mysql_commÚ.h
"

15 
execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
);

	@include/mysql_order_status.h

10 #iâdeà
_MYSQL_ORDER_STATUS_H_


11 
	#_MYSQL_ORDER_STATUS_H_


	)

13 
	~"mysql_commÚ.h
"

15 
execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
);

	@include/mysql_payment.h

10 #iâdeà
_MYSQL_PAYMENT_H_


11 
	#_MYSQL_PAYMENT_H_


	)

13 
	~"mysql_commÚ.h
"

15 
execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
);

	@include/mysql_stock_level.h

10 #iâdeà
_MYSQL_STOCK_LEVEL_H_


11 
	#_MYSQL_STOCK_LEVEL_H_


	)

13 
	~"mysql_commÚ.h
"

15 
execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
);

	@include/nonsp_common.h

10 #iâdeà
_NONSP_COMMON_H_


11 
	#_NONSP_COMMON_H_


	)

13 
	~"commÚ.h
"

14 
	~"loggšg.h
"

15 
	~"Œª§ùiÚ_d©a.h
"

18 #ifdeà
ODBC


19 
	~"odbc_commÚ.h
"

22 #ifdeà
LIBMYSQL


23 
	~"mysql_commÚ.h
"

26 #ifdeà
LIBDRIZZLE


27 
	~"drizzË_commÚ.h
"

30 #ifdeà
LIBSQLITE


31 
	~"sql™e_commÚ.h
"

34 
dbt2_esÿ³_¡r
(*
Üig_¡r
, *
esc_¡r
);

35 
dbt2_š™_v®ues
(** 
v®ues
, 
max_v®ues
);

36 
dbt2_ä“_v®ues
(** 
v®ues
, 
max_v®ues
);

38 
	#DELIVERY_1
 \

42 " AND‚o_d_id = %d"

	)

44 
	#DELIVERY_2
 \

48 " AND‚o_d_id = %d"

	)

50 
	#DELIVERY_3
 \

55 " AND o_d_id = %d"

	)

57 
	#DELIVERY_4
 \

62 " AND o_d_id = %d"

	)

64 
	#DELIVERY_5
 \

69 " AND ol_d_id = %d"

	)

71 
	#DELIVERY_6
 \

76 " AND ol_d_id = %d"

	)

78 
	#DELIVERY_7
 \

84 " AND c_d_id = %d"

	)

86 
	#NEW_ORDER_1
 \

89 "WHERE w_id = %d"

	)

91 #iâdeà
LIBSQLITE


92 
	#NEW_ORDER_2
 \

97 "FOR UPDATE"

	)

99 
	#NEW_ORDER_2
 \

103 " AND d_id = %d\n"

	)

106 
	#NEW_ORDER_3
 \

110 " AND d_id = %d"

	)

112 
	#NEW_ORDER_4
 \

117 " AND c_id = %d"

	)

119 
	#NEW_ORDER_5
 \

121 "VALUES (%s, %d, %d)"

	)

123 
	#NEW_ORDER_6
 \

126 "VALUES (%s, %d, %d, %d, cu¼’t_time¡amp, NULL, %d, %d)"

	)

128 
	#NEW_ORDER_7
 \

131 "WHERE i_id = %d"

	)

133 
	#NEW_ORDER_8
 \

137 " AND s_w_id = %d"

	)

139 
	#NEW_ORDER_9
 \

143 " AND s_w_id = %d"

	)

145 #ifdeà
LIBSQLITE


146 
	#NEW_ORDER_10
 \

150 "VALUES (%s, %d, %d, %d, %d, %d, cu¼’t_time¡amp, %d, %f, '%s')"

	)

152 
	#NEW_ORDER_10
 \

156 "VALUES (%s, %d, %d, %d, %d, %d, NULL, %d, %f, '%s')"

	)

159 
	#ORDER_STATUS_1
 \

165 "ORDER BY c_fœ¡ ASC"

	)

167 
	#ORDER_STATUS_2
 \

172 " AND c_id = %d"

	)

174 
	#ORDER_STATUS_3
 \

180 "ORDER BY o_id DESC"

	)

182 
	#ORDER_STATUS_4
 \

188 " AND ol_o_id = %s"

	)

190 
	#PAYMENT_1
 \

193 "WHERE w_id = %d"

	)

195 
	#PAYMENT_2
 \

198 "WHERE w_id = %d"

	)

200 
	#PAYMENT_3
 \

204 " AND d_w_id = %d"

	)

206 
	#PAYMENT_4
 \

210 " AND d_w_id = %d"

	)

212 
	#PAYMENT_5
 \

218 "ORDER BY c_fœ¡ ASC"

	)

220 
	#PAYMENT_6
 \

227 " AND c_id = %d"

	)

229 
	#PAYMENT_7_GC
 \

235 " AND c_d_id = %d"

	)

237 
	#PAYMENT_7_BC
 \

244 " AND c_d_id = %d"

	)

246 
	#PAYMENT_8
 \

249 "VALUES (%d, %d, %d, %d, %d, cu¼’t_time¡amp, %f, '%  %s')"

	)

251 
	#STOCK_LEVEL_1
 \

255 "AND d_id = %d"

	)

257 
	#STOCK_LEVEL_2
 \

268 " AND (%d)"

	)

270 
	#INTEGRITY_1
 \

272 "FROM w¬ehou£\n"

	)

	@include/nonsp_delivery.h

13 #iâdeà
_NONSP_DELIVERY_H_


14 
	#_NONSP_DELIVERY_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<nÚ¥_commÚ.h
>

19 
execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
);

20 
d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
, ** 
v®s
, 
nv®s
);

	@include/nonsp_integrity.h

13 #iâdeà
_NONSP_INTEGRITY_H_


14 
	#_NONSP_INTEGRITY_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<nÚ¥_commÚ.h
>

19 
execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
);

20 
š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
, ** 
v®s
, 
nv®s
);

	@include/nonsp_new_order.h

13 #iâdeà
_NONSP_NEW_ORDER_H_


14 
	#_NONSP_NEW_ORDER_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<nÚ¥_commÚ.h
>

19 
execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
);

20 
Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
, ** 
v®s
, 
nv®s
);

	@include/nonsp_order_status.h

13 #iâdeà
_NONSP_ORDER_STATUS_H_


14 
	#_NONSP_ORDER_STATUS_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<nÚ¥_commÚ.h
>

19 
execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
);

20 
Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
, ** 
v®s
, 
nv®s
);

	@include/nonsp_payment.h

13 #iâdeà
_NONSP_PAYMENT_H_


14 
	#_NONSP_PAYMENT_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<nÚ¥_commÚ.h
>

19 
execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
);

20 
·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
, ** 
v®s
, 
nv®s
);

	@include/nonsp_stock_level.h

13 #iâdeà
_NONSP_STOCK_LEVEL_H_


14 
	#_NONSP_STOCK_LEVEL_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<nÚ¥_commÚ.h
>

19 
execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
);

20 
¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
, ** 
v®s
, 
nv®s
);

	@include/odbc_common.h

10 #iâdeà
_ODBC_COMMON_H_


11 
	#_ODBC_COMMON_H_


	)

13 
	~"commÚ.h
"

14 
	~"loggšg.h
"

15 
	~"Œª§ùiÚ_d©a.h
"

17 #ifdeà
IODBC


18 
	~<isql.h
>

19 
	~<isqËxt.h
>

20 
	~<isqÉy³s.h
>

22 
	~<sql.h
>

23 
	~<sqËxt.h
>

24 
	~<sqÉy³s.h
>

27 #iâdeà
SQLLEN


28 
	#SQLLEN
 
SQLINTEGER


	)

32 
	#LOG_ODBC_ERROR
(
ty³
, 
hªdË
è
	`log_odbc_”rÜ
(
__FILE__
, 
__LINE__
,y³, hªdË)

	)

34 
	#COMMIT
 "COMMIT"

	)

35 
	#ROLLBACK
 "ROLLBACK"

	)

37 
	sdb_cÚ‹xt_t
 {

38 
SQLHDBC
 
	mhdbc
;

39 
SQLHSTMT
 
	mh¡mt
;

42 
	ssql_»suÉ_t


44 
	mcu¼’t_row
;

45 
	m»suÉ_£t
;

46 
SQLSMALLINT
 
	mnum_f›lds
;

47 
SQLLEN
 
	mnum_rows
;

48 
SQLUINTEGER
 * 
	mËngths
;

49 * 
	mqu”y
;

53 
check_odbc_rc
(
SQLSMALLINT
 
hªdË_ty³
, 
SQLHANDLE
 
hªdË
, 
SQLRETURN
 
rc
);

54 
log_odbc_”rÜ
(*
f’ame
, 
lše
, 
SQLSMALLINT
 
hªdË_ty³
,

55 
SQLHANDLE
 
hªdË
);

56 
comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

57 
_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
odbcc
);

58 
_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
odbcc
);

59 
_db_š™
(*
¢ame
, *
uÇme
, *
auth
);

60 
rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

63 
dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
,

64 
sql_»suÉ_t
 * 
sql_»suÉ
, * 
qu”y_Çme
);

65 
dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

66 
dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

67 * 
dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
,

68 
f›ld
);

	@include/odbc_delivery.h

13 #iâdeà
_ODBC_DELIVERY_H_


14 
	#_ODBC_DELIVERY_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<odbc_commÚ.h
>

19 
	#STMT_DELIVERY
 \

20 "CALL d–iv”y (?, ?)"

	)

22 
execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
odbcc
, 
d–iv”y_t
 *
d©a
);

	@include/odbc_integrity.h

11 #iâdeà
_ODBC_INTEGRITY_H_


12 
	#_ODBC_INTEGRITY_H_


	)

14 
	~<odbc_commÚ.h
>

16 
execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
);

	@include/odbc_new_order.h

13 #iâdeà
_ODBC_NEW_ORDER_H_


14 
	#_ODBC_NEW_ORDER_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<odbc_commÚ.h
>

19 
	#STMT_NEW_ORDER
 \

38 "?, ?, ?, ?)"

	)

40 
execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
odbcc
, 
Ãw_Üd”_t
 *
d©a
);

	@include/odbc_order_status.h

13 #iâdeà
_ODBC_ORDER_STATUS_H_


14 
	#_ODBC_ORDER_STATUS_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<odbc_commÚ.h
>

19 
	#STMT_ORDER_STATUS
 \

38 "?, ?, ?, ?, ?)"

	)

40 
execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
odbcc
,

41 
Üd”_¡©us_t
 *
d©a
);

	@include/odbc_payment.h

13 #iâdeà
_ODBC_PAYMENT_H_


14 
	#_ODBC_PAYMENT_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<odbc_commÚ.h
>

19 
	#STMT_PAYMENT
 \

23 "?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"

	)

25 
execu‹_·ym’t
(
db_cÚ‹xt_t
 *
odbcc
, 
·ym’t_t
 *
d©a
);

	@include/odbc_stock_level.h

13 #iâdeà
_ODBC_STOCK_LEVEL_H_


14 
	#_ODBC_STOCK_LEVEL_H_


	)

16 
	~<Œª§ùiÚ_d©a.h
>

17 
	~<odbc_commÚ.h
>

19 
	#STMT_STOCK_LEVEL
 \

20 "CALL stock_Ëv– (?, ?, ?, ?)"

	)

22 
execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
odbcc
,

23 
¡ock_Ëv–_t
 *
d©a
);

	@include/sqlite_common.h

10 #iâdeà
_SQLITE_COMMON_H_


11 
	#_SQLITE_COMMON_H_


	)

13 
	~<sql™e3.h
>

14 
	~<¡ršg.h
>

15 
	~"Œª§ùiÚ_d©a.h
"

17 
	sdb_cÚ‹xt_t
 {

18 
	mšT¿n§ùiÚ
;

19 
sql™e3
 * 
	mdb
;

22 
	ssql_»suÉ_t


24 
	#»suÉ_£t
 
qu”y_ruÂšg


	)

25 
	mqu”y_ruÂšg
;

26 
	m”rÜ
;

27 
	m´eãtched
;

28 
	mnum_f›lds
;

29 
sql™e3_¡mt
 * 
	mpStmt
;

32 
sql™e_dbÇme
[256];

34 
comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

35 
_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
);

36 
_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
);

37 
_db_š™
(*
_dbÇme
);

38 
rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
);

40 
dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
,

41 
sql_»suÉ_t
 * 
sql_»suÉ
, * 
qu”y_Çme
);

42 
dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

43 
dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
);

44 * 
dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
,

45 
f›ld
);

	@include/transaction_data.h

13 #iâdeà
_TRANSACTION_DATA_H_


14 
	#_TRANSACTION_DATA_H_


	)

16 
	~<commÚ.h
>

18 
	sd–iv”y_t


21 
	mw_id
;

22 
	mo_ÿ¼›r_id
;

25 
	sno_Üd”_lše_t


27 
	mŞ_i_id
;

28 
	mŞ_suµly_w_id
;

29 
	mŞ_quªt™y
;

30 
	mŞ_amouÁ
;

31 
	ms_quªt™y
;

32 
	mb¿nd_g’”ic
;

33 
	mi_Çme
[
I_NAME_LEN
 + 1];

34 
	mi_´iû
;

37 
	sÃw_Üd”_t


40 
	mw_id
;

41 
	md_id
;

42 
	mc_id
;

43 
	mo_Ş_út
;

44 
	mo_®l_loÿl
;

45 
no_Üd”_lše_t
 
	mÜd”_lše
[
O_OL_CNT_MAX
];

48 
	mo_id
;

49 
	mtÙ®_amouÁ
;

50 
	mw_x
;

51 
	md_x
;

52 
	mc_Ï¡
[
C_LAST_LEN
 + 1];

53 
	mc_üed™
[
C_CREDIT_LEN
 + 1];

54 
	mc_discouÁ
;

55 
	mrŞlback
;

58 
	s·ym’t_t


61 
	mc_d_id
;

62 
	mc_w_id
;

63 
	md_id
;

64 
	mh_amouÁ
;

65 
	mw_id
;

68 
	mc_id
;

69 
	mc_Ï¡
[
C_LAST_LEN
 + 1];

72 
	md_Çme
[
D_NAME_LEN
 + 1];

73 
	md_¡»‘_1
[
D_STREET_1_LEN
 + 1];

74 
	md_¡»‘_2
[
D_STREET_2_LEN
 + 1];

75 
	md_c™y
[
D_CITY_LEN
 + 1];

76 
	md_¡©e
[
D_STATE_LEN
 + 1];

77 
	md_z
[
D_ZIP_LEN
 + 1];

78 
	mc_b®ªû
;

79 
	mc_üed™_lim
;

80 
	mc_discouÁ
;

81 
	mc_d©a
[
C_DATA_LEN
 + 1];

82 
	mc_fœ¡
[
C_FIRST_LEN
 + 1];

83 
	mc_middË
[
C_MIDDLE_LEN
 + 1];

84 
	mc_¡»‘_1
[
C_STREET_1_LEN
 + 1];

85 
	mc_¡»‘_2
[
C_STREET_2_LEN
 + 1];

86 
	mc_c™y
[
C_CITY_LEN
 + 1];

87 
	mc_¡©e
[
C_STATE_LEN
 + 1];

88 
	mc_z
[
C_ZIP_LEN
 + 1];

89 
	mc_phÚe
[
C_PHONE_LEN
 + 1];

90 
	mc_sšû
[
C_SINCE_LEN
 + 1];

91 
	mc_üed™
[
C_CREDIT_LEN
 + 1];

92 
	mw_Çme
[
W_NAME_LEN
 + 1];

93 
	mw_¡»‘_1
[
W_STREET_1_LEN
 + 1];

94 
	mw_¡»‘_2
[
W_STREET_2_LEN
 + 1];

95 
	mw_c™y
[
W_CITY_LEN
 + 1];

96 
	mw_¡©e
[
W_STATE_LEN
 + 1];

97 
	mw_z
[
W_ZIP_LEN
 + 1];

100 
	sos_Üd”_lše_t


102 
	mŞ_i_id
;

103 
	mŞ_suµly_w_id
;

104 
	mŞ_quªt™y
;

105 
	mŞ_amouÁ
;

106 
	mŞ_d–iv”y_d
[
OL_DELIVERY_D_LEN
 + 1];

109 
	sÜd”_¡©us_t


112 
	mc_d_id
;

113 
	mc_w_id
;

116 
	mc_id
;

117 
	mc_Ï¡
[
C_LAST_LEN
 + 1];

120 
	mc_b®ªû
;

121 
	mc_fœ¡
[
C_FIRST_LEN
 + 1];

122 
	mc_middË
[
C_MIDDLE_LEN
 + 1];

123 
	mo_id
;

124 
	mo_ÿ¼›r_id
;

125 
	mo_’Œy_d
[
O_ENTRY_D_LEN
 + 1];

126 
	mo_Ş_út
;

127 
os_Üd”_lše_t
 
	mÜd”_lše
[
O_OL_CNT_MAX
];

130 
	s¡ock_Ëv–_t


133 
	mw_id
;

134 
	md_id
;

135 
	mth»shŞd
;

138 
	mlow_¡ock
;

141 
	sš‹gr™y_t


144 
	mw_id
;

147 
	uŒª§ùiÚ_d©a_t


149 
d–iv”y_t
 
	md–iv”y
;

150 
Ãw_Üd”_t
 
	mÃw_Üd”
;

151 
Üd”_¡©us_t
 
	mÜd”_¡©us
;

152 
·ym’t_t
 
	m·ym’t
;

153 
¡ock_Ëv–_t
 
	m¡ock_Ëv–
;

154 
š‹gr™y_t
 
	mš‹gr™y
;

157 
dump
(
FILE
 *
å
, 
ty³
, *
d©a
);

	@include/transaction_queue.h

12 #iâdeà
_TRANSACTION_QUEUE_H_


13 
	#_TRANSACTION_QUEUE_H_


	)

15 
	~<_£m­hÜe.h
>

17 
	~<ş›Á_š‹rçû.h
>

19 
	#REQ_QUEUED
 0

	)

20 
	#REQ_EXECUTING
 1

	)

22 
	sŒª§ùiÚ_queue_node_t


24 
	ms
;

25 
	mid
;

26 
ş›Á_Œª§ùiÚ_t
 
	mş›Á_d©a
;

27 
Œª§ùiÚ_queue_node_t
 *
	mÃxt
;

30 
Œª§ùiÚ_queue_node_t
 *
dequeue_Œª§ùiÚ
();

31 
’queue_Œª§ùiÚ
(
Œª§ùiÚ_queue_node_t
 *
node
);

32 
š™_Œª§ùiÚ_queue
();

34 
£m_t
 
queue_Ëngth
;

35 
Œª§ùiÚ_couÁ”
[2][
TRANSACTION_MAX
];

36 
±h»ad_mu‹x_t
 
mu‹x_Œª§ùiÚ_couÁ”
[2][
TRANSACTION_MAX
];

	@input_data_generator.c

11 
	~<¡ršg.h
>

12 
	~<¡ršgs.h
>

14 
	~"commÚ.h
"

15 
	~"Œª§ùiÚ_d©a.h
"

17 
g’”©e_d–iv”y_d©a
(
w_id
, 
d–iv”y_t
 *
d©a
);

18 
g’”©e_Ãw_Üd”_d©a
(
w_id
, 
Ãw_Üd”_t
 *
d©a
);

19 
g’”©e_Üd”_¡©us_d©a
(
w_id
, 
Üd”_¡©us_t
 *
d©a
);

20 
g’”©e_·ym’t_d©a
(
w_id
, 
·ym’t_t
 *
d©a
);

21 
g’”©e_¡ock_Ëv–_d©a
(
w_id
, 
d_id
, 
¡ock_Ëv–_t
 *
d©a
);

22 
g’”©e_š‹gr™y_d©a
(
w_id
, 
š‹gr™y_t
 *
d©a
);

25 
mode_®‹»d
;

28 
	$g’”©e_šput_d©a
(
ty³
, *
d©a
, 
w_id
)

30 
ty³
) {

31 
DELIVERY
:

32 
	`g’”©e_d–iv”y_d©a
(
w_id
, (
d–iv”y_t
 *è
d©a
);

34 
NEW_ORDER
:

35 
	`g’”©e_Ãw_Üd”_d©a
(
w_id
, (
Ãw_Üd”_t
 *è
d©a
);

37 
ORDER_STATUS
:

38 
	`g’”©e_Üd”_¡©us_d©a
(
w_id
,

39 (
Üd”_¡©us_t
 *è
d©a
);

41 
PAYMENT
:

42 
	`g’”©e_·ym’t_d©a
(
w_id
, (
·ym’t_t
 *è
d©a
);

44 
INTEGRITY
:

45 
	`g’”©e_š‹gr™y_d©a
(
w_id
, (
š‹gr™y_t
 *è
d©a
);

47  
ERROR
;

49  
OK
;

50 
	}
}

53 
	$g’”©e_šput_d©a2
(
ty³
, *
d©a
, 
w_id
, 
d_id
)

55 
	`g’”©e_¡ock_Ëv–_d©a
(
w_id
, 
d_id
, (
¡ock_Ëv–_t
 *è
d©a
);

56  
OK
;

57 
	}
}

60 
	$g’”©e_d–iv”y_d©a
(
w_id
, 
d–iv”y_t
 *
d©a
)

62 
	`bz”o
(
d©a
, (
d–iv”y_t
));

63 
d©a
->
w_id
 = w_id;

64 
d©a
->
o_ÿ¼›r_id
 = 
	`g‘_¿ndom
(
O_CARRIER_ID_MAX
) + 1;

66  
OK
;

67 
	}
}

70 
	$g’”©e_Ãw_Üd”_d©a
(
w_id
, 
Ãw_Üd”_t
 *
d©a
)

72 
i
;

74 
	`bz”o
(
d©a
, (
Ãw_Üd”_t
));

75 
d©a
->
w_id
 = w_id;

76 
d©a
->
d_id
 = 
	`g‘_¿ndom
(
D_ID_MAX
) + 1;

77 
d©a
->
c_id
 = 
	`g‘_nu¿nd
(1023, 1, 3000);

78 
d©a
->
o_Ş_út
 = 
	`g‘_¿ndom
(10) + 6;

79 
i
 = 0; i < 
d©a
->
o_Ş_út
; i++) {

80 
d©a
->
Üd”_lše
[
i
].
Ş_i_id
 = 
	`g‘_nu¿nd
(8191, 1, 100000);

81 ià(
bË_ÿrdš®™y
.
w¬ehou£s
 > 1) {

82 ià(
mode_®‹»d
 =ğ1 || 
	`g‘_¿ndom
(100) > 0) {

83 
d©a
->
Üd”_lše
[
i
].
Ş_suµly_w_id
 = 
w_id
;

85 
d©a
->
Üd”_lše
[
i
].
Ş_suµly_w_id
 =

86 
	`g‘_¿ndom
(

87 
bË_ÿrdš®™y
.
w¬ehou£s
) + 1;

88 ià(
d©a
->
Üd”_lše
[
i
].
Ş_suµly_w_id
 >=

89 
w_id
) {

90 ++
d©a
->
Üd”_lše
[
i
].
Ş_suµly_w_id
;

94 
d©a
->
Üd”_lše
[
i
].
Ş_suµly_w_id
 = 1;

96 
d©a
->
Üd”_lše
[
i
].
Ş_quªt™y
 = 
	`g‘_¿ndom
(10) + 1;

100 ià(
	`g‘_¿ndom
(100) == 0) {

101 
d©a
->
Üd”_lše
[d©a->
o_Ş_út
 - 1].
Ş_i_id
 = 0;

104  
OK
;

105 
	}
}

108 
	$g’”©e_Üd”_¡©us_d©a
(
w_id
, 
Üd”_¡©us_t
 *
d©a
)

110 
	`bz”o
(
d©a
, (
Üd”_¡©us_t
));

111 
d©a
->
c_w_id
 = 
w_id
;

112 
d©a
->
c_d_id
 = 
	`g‘_¿ndom
(
D_ID_MAX
) + 1;

115 ià(
	`g‘_¿ndom
(100) < 60) {

116 
d©a
->
c_id
 = 
C_ID_UNKNOWN
;

117 
	`g‘_c_Ï¡
(
d©a
->
c_Ï¡
, 
	`g‘_nu¿nd
(255, 0, 999));

119 
d©a
->
c_id
 = 
	`g‘_nu¿nd
(1023, 1, 3000);

122  
OK
;

123 
	}
}

126 
	$g’”©e_·ym’t_d©a
(
w_id
, 
·ym’t_t
 *
d©a
)

128 
	`bz”o
(
d©a
, (
·ym’t_t
));

129 
d©a
->
w_id
 = w_id;

130 
d©a
->
d_id
 = 
	`g‘_¿ndom
(
D_ID_MAX
) + 1;

133 ià(
	`g‘_¿ndom
(100) < 60) {

134 
d©a
->
c_id
 = 
C_ID_UNKNOWN
;

135 
	`g‘_c_Ï¡
(
d©a
->
c_Ï¡
, 
	`g‘_nu¿nd
(255, 0, 999));

137 
d©a
->
c_id
 = 
	`g‘_nu¿nd
(1023, 1, 3000);

140 ià(
mode_®‹»d
 =ğ1 || 
	`g‘_¿ndom
(100) < 85) {

141 
d©a
->
c_w_id
 = 
w_id
;

142 
d©a
->
c_d_id
 = d©a->
d_id
;

144 
d©a
->
c_d_id
 = 
	`g‘_¿ndom
(
D_ID_MAX
) + 1;

145 ià(
bË_ÿrdš®™y
.
w¬ehou£s
 > 1) {

151 
d©a
->
c_w_id
 =

152 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
w¬ehou£s
 - 1)

154 ià(
d©a
->
c_w_id
 >ğ
w_id
) {

155 
d©a
->
c_w_id
 = (data->c_w_id + 1) %

156 
bË_ÿrdš®™y
.
w¬ehou£s
;

158 ià(!
d©a
->
c_w_id
)

160 
d©a
->
c_w_id
 = 1;

163 
d©a
->
c_w_id
 = 1;

166 
d©a
->
h_amouÁ
 = (è(
	`g‘_¿ndom
(500000) + 100) / 100.0;

168  
OK
;

169 
	}
}

172 
	$g’”©e_¡ock_Ëv–_d©a
(
w_id
, 
d_id
, 
¡ock_Ëv–_t
 *
d©a
)

174 
	`bz”o
(
d©a
, (
¡ock_Ëv–_t
));

175 
d©a
->
w_id
 = w_id;

176 
d©a
->
d_id
 = d_id;

177 
d©a
->
th»shŞd
 = 
	`g‘_¿ndom
(11) + 10;

179  
OK
;

180 
	}
}

182 
	$g’”©e_š‹gr™y_d©a
(
w_id
, 
š‹gr™y_t
 *
d©a
)

184 
	`bz”o
(
d©a
, (
š‹gr™y_t
));

185 
d©a
->
w_id
 = w_id;

187  
OK
;

188 
	}
}

	@libpq/dbc_common.c

10 
	~<¡dio.h
>

11 
	~<¡ršg.h
>

13 
	~"commÚ.h
"

14 
	~"loggšg.h
"

15 
	~"libpq_commÚ.h
"

17 
	gdbÇme
[32] = "dbt2";

18 
	gpgho¡
[32] = "localhost";

19 
	gpgpÜt
[32] = "5432";

21 
	$comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

23 
PG»suÉ
 *
»s
;

25 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "COMMIT");

26 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

27 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

29 
	`PQş—r
(
»s
);

31  
OK
;

32 
	}
}

35 
	$_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
)

37 
buf
[1024];

38 if(
	`¡rcmp
(
pgho¡
, "localhost") == 0 &&

39 
	`¡rcmp
(
pgpÜt
, "5432") == 0) {

40 
	`¥rštf
(
buf
, "­¶iÿtiÚ_Çme=dbt2-ş›Á dbÇme=%s", 
dbÇme
);

42 
	`¥rštf
(
buf
, "­¶iÿtiÚ_Çme=dbt2-ş›Á ho¡=% pÜt=% dbÇme=%s", 
pgho¡
, 
pgpÜt
, 
dbÇme
);

44 
dbc
->
cÚn
 = 
	`PQcÚÃùdb
(
buf
);

45 ià(
	`PQ¡©us
(
dbc
->
cÚn
è!ğ
CONNECTION_OK
) {

46 
	`LOG_ERROR_MESSAGE
("Connectiono database '%s' failed.",

47 
dbÇme
);

48 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

49 
	`PQfšish
(
dbc
->
cÚn
);

50  
ERROR
;

52  
OK
;

53 
	}
}

56 
	$_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
)

58 
	`PQfšish
(
dbc
->
cÚn
);

59  
OK
;

60 
	}
}

62 
	$_db_š™
(*
_dbÇme
, *
_pgho¡
, *
_pgpÜt
)

65 ià(
_dbÇme
 !ğ
NULL
) {

66 
	`¡rıy
(
dbÇme
, 
_dbÇme
);

68 ià(
_pgho¡
 !ğ
NULL
) {

69 
	`¡rıy
(
pgho¡
, 
_pgho¡
);

71 ià(
_pgpÜt
 !ğ
NULL
) {

72 
	`¡rıy
(
pgpÜt
, 
_pgpÜt
);

74  
OK
;

75 
	}
}

77 
	$rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

79 
PG»suÉ
 *
»s
;

81 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "ROLLBACK");

82 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

83 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

85 
	`PQş—r
(
»s
);

87  
STATUS_ROLLBACK
;

88 
	}
}

	@libpq/dbc_delivery.c

10 
	~<¡dio.h
>

12 
	~"commÚ.h
"

13 
	~"loggšg.h
"

14 
	~"libpq_d–iv”y.h
"

16 
	$execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
)

18 
PG»suÉ
 *
»s
;

19 
¡mt
[128];

22 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "BEGIN");

23 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

24 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

25 
	`PQş—r
(
»s
);

26  
ERROR
;

28 
	`PQş—r
(
»s
);

31 
	`¥rštf
(
¡mt
, "SELECT delivery(%d, %d)",

32 
d©a
->
w_id
, d©a->
o_ÿ¼›r_id
);

33 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, 
¡mt
);

34 ià(!
»s
 || (
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
 &&

35 
	`PQ»suÉStus
(
»s
è!ğ
PGRES_TUPLES_OK
)) {

36 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

37 
	`PQş—r
(
»s
);

38  
ERROR
;

40 
	`PQş—r
(
»s
);

42  
OK
;

43 
	}
}

	@libpq/dbc_integrity.c

10 
	~"libpq_š‹gr™y.h
"

12 
	$execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
)

17  
OK
;

18 
	}
}

	@libpq/dbc_new_order.c

10 
	~<¡dio.h
>

11 
	~<¡ršg.h
>

13 
	~"commÚ.h
"

14 
	~"loggšg.h
"

15 
	~"libpq_Ãw_Üd”.h
"

17 
	$execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
)

19 
PG»suÉ
 *
»s
;

20 
¡mt
[1024];

23 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "BEGIN");

24 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

25 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

26 
	`PQş—r
(
»s
);

27  
ERROR
;

29 
	`PQş—r
(
»s
);

34 
	`¥rštf
(
¡mt
,

52 
d©a
->
w_id
, d©a->
d_id
, d©a->
c_id
, d©a->
o_®l_loÿl
,

53 
d©a
->
o_Ş_út
,

54 
d©a
->
Üd”_lše
[0].
Ş_i_id
,

55 
d©a
->
Üd”_lše
[0].
Ş_suµly_w_id
,

56 
d©a
->
Üd”_lše
[0].
Ş_quªt™y
,

57 
d©a
->
Üd”_lše
[1].
Ş_i_id
,

58 
d©a
->
Üd”_lše
[1].
Ş_suµly_w_id
,

59 
d©a
->
Üd”_lše
[1].
Ş_quªt™y
,

60 
d©a
->
Üd”_lše
[2].
Ş_i_id
,

61 
d©a
->
Üd”_lše
[2].
Ş_suµly_w_id
,

62 
d©a
->
Üd”_lše
[2].
Ş_quªt™y
,

63 
d©a
->
Üd”_lše
[3].
Ş_i_id
,

64 
d©a
->
Üd”_lše
[3].
Ş_suµly_w_id
,

65 
d©a
->
Üd”_lše
[3].
Ş_quªt™y
,

66 
d©a
->
Üd”_lše
[4].
Ş_i_id
,

67 
d©a
->
Üd”_lše
[4].
Ş_suµly_w_id
,

68 
d©a
->
Üd”_lše
[4].
Ş_quªt™y
,

69 
d©a
->
Üd”_lše
[5].
Ş_i_id
,

70 
d©a
->
Üd”_lše
[5].
Ş_suµly_w_id
,

71 
d©a
->
Üd”_lše
[5].
Ş_quªt™y
,

72 
d©a
->
Üd”_lše
[6].
Ş_i_id
,

73 
d©a
->
Üd”_lše
[6].
Ş_suµly_w_id
,

74 
d©a
->
Üd”_lše
[6].
Ş_quªt™y
,

75 
d©a
->
Üd”_lše
[7].
Ş_i_id
,

76 
d©a
->
Üd”_lše
[7].
Ş_suµly_w_id
,

77 
d©a
->
Üd”_lše
[7].
Ş_quªt™y
,

78 
d©a
->
Üd”_lše
[8].
Ş_i_id
,

79 
d©a
->
Üd”_lše
[8].
Ş_suµly_w_id
,

80 
d©a
->
Üd”_lše
[8].
Ş_quªt™y
,

81 
d©a
->
Üd”_lše
[9].
Ş_i_id
,

82 
d©a
->
Üd”_lše
[9].
Ş_suµly_w_id
,

83 
d©a
->
Üd”_lše
[9].
Ş_quªt™y
,

84 
d©a
->
Üd”_lše
[10].
Ş_i_id
,

85 
d©a
->
Üd”_lše
[10].
Ş_suµly_w_id
,

86 
d©a
->
Üd”_lše
[10].
Ş_quªt™y
,

87 
d©a
->
Üd”_lše
[11].
Ş_i_id
,

88 
d©a
->
Üd”_lše
[11].
Ş_suµly_w_id
,

89 
d©a
->
Üd”_lše
[11].
Ş_quªt™y
,

90 
d©a
->
Üd”_lše
[12].
Ş_i_id
,

91 
d©a
->
Üd”_lše
[12].
Ş_suµly_w_id
,

92 
d©a
->
Üd”_lše
[12].
Ş_quªt™y
,

93 
d©a
->
Üd”_lše
[13].
Ş_i_id
,

94 
d©a
->
Üd”_lše
[13].
Ş_suµly_w_id
,

95 
d©a
->
Üd”_lše
[13].
Ş_quªt™y
,

96 
d©a
->
Üd”_lše
[14].
Ş_i_id
,

97 
d©a
->
Üd”_lše
[14].
Ş_suµly_w_id
,

98 
d©a
->
Üd”_lše
[14].
Ş_quªt™y
);

99 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, 
¡mt
);

100 ià(!
»s
 || (
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
 &&

101 
	`PQ»suÉStus
(
»s
è!ğ
PGRES_TUPLES_OK
)) {

102 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

103 
	`PQş—r
(
»s
);

104  
ERROR
;

106 
	`PQş—r
(
»s
);

108 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "FETCH ALL IN mycursor");

109 ià(
	`PQ»suÉStus
(
»s
è!ğ
PGRES_TUPLES_OK
) {

110 
d©a
->
rŞlback
 = 0;

111 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

112 
	`PQş—r
(
»s
);

113  
ERROR
;

115 
d©a
->
rŞlback
 = 
	`©oi
(
	`PQg‘v®ue
(
»s
, 0, 0));

116 
	`PQş—r
(
»s
);

117 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "CLOSE mycursor");

118 
	`PQş—r
(
»s
);

120  
OK
;

121 
	}
}

	@libpq/dbc_order_status.c

10 
	~<¡dio.h
>

12 
	~"commÚ.h
"

13 
	~"loggšg.h
"

14 
	~"libpq_Üd”_¡©us.h
"

16 cÚ¡ 
	gg_debug
 = 0;

18 
	$execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
)

20 
PG»suÉ
 *
»s
;

21 
¡mt
[512];

23 
nF›lds
;

24 
i
, 
j
;

27 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "BEGIN");

28 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

29 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

30 
	`PQş—r
(
»s
);

31  
ERROR
;

33 
	`PQş—r
(
»s
);

36 
	`¥rštf
(
¡mt
, "SELECT * FROM order_status(%d, %d, %d, '%s')",

37 
d©a
->
c_id
, d©a->
c_w_id
, d©a->
c_d_id
, d©a->
c_Ï¡
);

38 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, 
¡mt
);

39 ià(!
»s
 || (
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
 &&

40 
	`PQ»suÉStus
(
»s
è!ğ
PGRES_TUPLES_OK
)) {

41 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

42 
	`PQş—r
(
»s
);

43  
ERROR
;

46 
nF›lds
 = 
	`PQnf›lds
(
»s
);

47 
i
 = 0; i < 
nF›lds
; i++) {

48 * 
tmp
 = 
	`PQâame
(
»s
, 
i
);

49 if(
g_debug
è
	`´štf
("%-15s", 
tmp
);

51 if(
g_debug
è
	`´štf
("\n\n");

54 
i
 = 0; i < 
	`PQÁu¶es
(
»s
); i++) {

55 
j
 = 0; j < 
nF›lds
; j++) {

56 * 
tmp
 = 
	`PQg‘v®ue
(
»s
, 
i
, 
j
);

57 if(
g_debug
è
	`´štf
("%-15s", 
tmp
);

59 if(
g_debug
è
	`´štf
("\n");

61 
	`PQş—r
(
»s
);

63  
OK
;

64 
	}
}

	@libpq/dbc_payment.c

10 
	~<¡dio.h
>

12 
	~"commÚ.h
"

13 
	~"loggšg.h
"

14 
	~"libpq_·ym’t.h
"

16 
	$execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
)

18 
PG»suÉ
 *
»s
;

19 
¡mt
[128];

22 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "BEGIN");

23 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

24 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

25 
	`PQş—r
(
»s
);

26  
ERROR
;

28 
	`PQş—r
(
»s
);

31 
	`¥rštf
(
¡mt
, "SELECT…ayment(%d, %d, %d, %d, %d, '%s', %f)",

32 
d©a
->
w_id
, d©a->
d_id
, d©a->
c_id
, d©a->
c_w_id
, d©a->
c_d_id
,

33 
d©a
->
c_Ï¡
, d©a->
h_amouÁ
);

34 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, 
¡mt
);

35 ià(!
»s
 || (
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
 &&

36 
	`PQ»suÉStus
(
»s
è!ğ
PGRES_TUPLES_OK
)) {

37 
	`LOG_ERROR_MESSAGE
("%s\n%s", 
¡mt
, 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

38 
	`PQş—r
(
»s
);

39  
ERROR
;

41 
	`PQş—r
(
»s
);

43  
OK
;

44 
	}
}

	@libpq/dbc_stock_level.c

10 
	~<¡dio.h
>

12 
	~"commÚ.h
"

13 
	~"loggšg.h
"

14 
	~"libpq_¡ock_Ëv–.h
"

16 
	$execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
)

18 
PG»suÉ
 *
»s
;

19 
¡mt
[128];

22 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, "BEGIN");

23 ià(!
»s
 || 
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
) {

24 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

25 
	`PQş—r
(
»s
);

26  
ERROR
;

28 
	`PQş—r
(
»s
);

31 
	`¥rštf
(
¡mt
, "SELECT stock_level(%d, %d, %d)",

32 
d©a
->
w_id
, d©a->
d_id
, d©a->
th»shŞd
);

33 
»s
 = 
	`PQexec
(
dbc
->
cÚn
, 
¡mt
);

34 ià(!
»s
 || (
	`PQ»suÉStus
Ôesè!ğ
PGRES_COMMAND_OK
 &&

35 
	`PQ»suÉStus
(
»s
è!ğ
PGRES_TUPLES_OK
)) {

36 
	`LOG_ERROR_MESSAGE
("%s", 
	`PQ”rÜMes§ge
(
dbc
->
cÚn
));

37 
	`PQş—r
(
»s
);

38  
ERROR
;

40 
	`PQş—r
(
»s
);

42  
OK
;

43 
	}
}

	@listener.c

10 
	~<commÚ.h
>

11 
	~<±h»ad.h
>

12 
	~<uni¡d.h
>

13 
	~<”ºo.h
>

15 
	~"loggšg.h
"

16 
	~"li¡’”.h
"

17 
	~"ş›Á_š‹rçû.h
"

18 
	~"_sock‘.h
"

20 *
li¡’”_wÜk”
(*
d©a
);

22 
£m_t
 
	gli¡’”_wÜk”_couÁ
;

23 
£m_t
 
	gä“_couÁ
;

24 
Œª§ùiÚ_queue_node_t
 *
	gnode_h—d
, *
	gnode_
;

25 
±h»ad_mu‹x_t
 
	gmu‹x_node
 = 
PTHREAD_MUTEX_INITIALIZER
;

28 
ex™šg
;

30 
Œª§ùiÚ_queue_node_t
 *
	$g‘_node
()

32 
Œª§ùiÚ_queue_node_t
 *
node
;

34 
	`£m_wa™
(&
ä“_couÁ
);

35 
	`±h»ad_mu‹x_lock
(&
mu‹x_node
);

36 
node
 = 
node_h—d
;

37 ià(
node_h—d
 =ğ
NULL
) {

39  
NULL
;

40 } ià(
node_h—d
->
Ãxt
 =ğ
NULL
) {

41 
node_h—d
 = 
node_
 = 
NULL
;

43 
node_h—d
 =‚ode_h—d->
Ãxt
;

45 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_node
);

47  
node
;

48 
	}
}

50 *
	$š™_li¡’”
(*
d©a
)

52 *
s
 = (*è
d©a
;

53 
node_h—d
 = 
node_
 = 
NULL
;

55 
size_t
 
¡acksize
 = 131072;

57 ià(
	`£m_š™
(&
li¡’”_wÜk”_couÁ
, 0, 0) != 0) {

58 
	`LOG_ERROR_MESSAGE
("cannot init†istener_worker_count");

59 
	`´štf
("cannot init†istener_worker_count,ƒxiting...\n");

60 
	`ex™
(11);

62 ià(
	`£m_š™
(&
ä“_couÁ
, 0, 0) != 0) {

63 
	`LOG_ERROR_MESSAGE
("cannot init free_count");

64 
	`ex™
(12);

67 !
ex™šg
) {

68 
»t
;

69 
±h»ad_t
 
tid
;

70 
Œª§ùiÚ_queue_node_t
 *
node
;

72 
±h»ad_©Œ_t
 
©Œ
;

75 
node
 = (
Œª§ùiÚ_queue_node_t
 *)

76 
	`m®loc
((
Œª§ùiÚ_queue_node_t
));

78 ià(!
node
) {

79 
	`LOG_ERROR_MESSAGE
(

83 
node
->
s
 = 
	`_acû±
(s);

84 ià(
node
->
s
 == -1) {

85 
	`LOG_ERROR_MESSAGE
(

90 ià(
	`±h»ad_©Œ_š™
(&
©Œ
) != 0) {

91 
	`LOG_ERROR_MESSAGE
("could‚ot init…thread‡ttr");

92  
ERROR
;

94 ià(
	`±h»ad_©Œ_£t¡acksize
(&
©Œ
, 
¡acksize
) != 0) {

95 
	`LOG_ERROR_MESSAGE
("could‚ot set…thread stack size");

96  
ERROR
;

99 
»t
 = 
	`±h»ad_ü—‹
(&
tid
, &
©Œ
, &
li¡’”_wÜk”
,

100 (*è
node
);

101 ià(
»t
 != 0) {

102 
	`şo£
(
node
->
s
);

103 
	`LOG_ERROR_MESSAGE
("pthread_create() failed, closing socket‡nd waiting for‡‚ew„equest");

104 ià(
»t
 =ğ
EAGAIN
) {

105 
	`LOG_ERROR_MESSAGE
(

109 
	`±h»ad_©Œ_de¡roy
(&
©Œ
);

112 
	`£m_po¡
(&
li¡’”_wÜk”_couÁ
);

113 
	`±h»ad_©Œ_de¡roy
(&
©Œ
);

116  
NULL
;

117 
	}
}

119 *
	$li¡’”_wÜk”
(*
d©a
)

121 
rc
;

122 
Œª§ùiÚ_queue_node_t
 *
node
 =

123 (
Œª§ùiÚ_queue_node_t
 *è
d©a
;

125 !
ex™šg
) {

126 
rc
 = 
	`»ûive_Œª§ùiÚ_d©a
(
node
->
s
, &node->
ş›Á_d©a
);

127 ià(
rc
 =ğ
ERROR_SOCKET_CLOSED
) {

132 
	`£m_wa™
(&
li¡’”_wÜk”_couÁ
);

133 
	`ä“
(
node
);

134 
	`±h»ad_ex™
(0);

135 } ià(
rc
 =ğ
ERROR
) {

136 
	`LOG_ERROR_MESSAGE
("receive_transaction_data()ƒrror");

141 
	`’queue_Œª§ùiÚ
(
node
);

142 
node
 = 
	`g‘_node
();

143 ià(
node
 =ğ
NULL
) {

148 
	`´štf
("stupid get_node() failed you\n");

149 
	`LOG_ERROR_MESSAGE
("Cannot get‡ransaction‚ode.\n");

150 
	`ex™
(1);

154  
NULL
;

155 
	}
}

157 
	$»cyşe_node
(
Œª§ùiÚ_queue_node_t
 *
node
)

159 
	`±h»ad_mu‹x_lock
(&
mu‹x_node
);

160 
node
->
Ãxt
 = 
NULL
;

161 ià(
node_
 !ğ
NULL
) {

162 
node_
->
Ãxt
 = 
node
;

163 
node_
 = 
node
;

165 
node_h—d
 = 
node_
 = 
node
;

167 
	`£m_po¡
(&
ä“_couÁ
);

168 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_node
);

170  
OK
;

171 
	}
}

	@logging.c

10 
	~<commÚ.h
>

11 
	~<±h»ad.h
>

12 
	~<¡dio.h
>

13 
	~<¡d¬g.h
>

14 
	~<¡ršg.h
>

15 
	~<time.h
>

16 
	~<loggšg.h
>

17 
	~<Œª§ùiÚ_d©a.h
>

19 
FILE
 *
	glog_”rÜ
;

20 
±h»ad_mu‹x_t
 
	gmu‹x_”rÜ_log
 = 
PTHREAD_MUTEX_INITIALIZER
;

22 
	$edump
(
ty³
, *
d©a
)

24 
	`±h»ad_mu‹x_lock
(&
mu‹x_”rÜ_log
);

25 
	`årštf
(
log_”rÜ
, "[%d]\n", (è
	`±h»ad_£lf
());

26 
	`dump
(
log_”rÜ
, 
ty³
, 
d©a
);

27 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_”rÜ_log
);

29  
OK
;

30 
	}
}

32 
	$š™_loggšg
()

34 
log_f’ame
[1024];

36 ià(
ouut_·th
[0] != '\0') {

37 
	`¡rÿt
(
ouut_·th
, "/");

39 
	`¥rštf
(
log_f’ame
, "%s%s", 
ouut_·th
, 
ERROR_LOG_NAME
);

40 
log_”rÜ
 = 
	`fİ’
(
log_f’ame
, "w");

41 ià(
log_”rÜ
 =ğ
NULL
) {

42 
	`årštf
(
¡d”r
, "ÿÂÙ o³À%s\n", 
log_f’ame
);

43  
ERROR
;

46  
OK
;

47 
	}
}

49 
	$log_”rÜ_mes§ge
(*
f’ame
, 
lše
, cÚ¡ *
fmt
, ...)

51 
va_li¡
 
fmrgs
;

52 
time_t
 
t
;

53 
FILE
 *
of
 = (
log_”rÜ
è?†og_”rÜ: 
¡d”r
;

56 
t
 = 
	`time
(
NULL
);

57 
	`va_¡¬t
(
fmrgs
, 
fmt
);

59 
	`±h»ad_mu‹x_lock
(&
mu‹x_”rÜ_log
);

60 
	`årštf
(
of
, "%¡id:%d %s:%d\n", 
	`ùime
(&
t
), (è
	`±h»ad_£lf
(),

61 
f’ame
, 
lše
);

62 
	`va_¡¬t
(
fmrgs
, 
fmt
);

63 
	`vårštf
(
of
, 
fmt
, 
fmrgs
);

64 
	`va_’d
(
fmrgs
);

65 
	`årštf
(
of
, "\n");

66 
	`fæush
(
log_”rÜ
);

67 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_”rÜ_log
);

69  
OK
;

70 
	}
}

	@mysql/dbc_common.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"mysql_commÚ.h
"

13 
	~<¡dio.h
>

15 
	gmysql_dbÇme
[32] = "dbt2";

16 
	gmysql_ho¡
[32] = "localhost";

17 
	gmysql_u£r
[32] = "root";

18 
	gmysql_·ss
[32] = "";

19 
	gmysql_pÜt_t
[32] = "0";

20 
	gmysql_sock‘_t
[256] = "/tmp/mysql.sock";

23 
	$comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

26 ià(
	`mysql_»®_qu”y
(
dbc
->
mysql
, "COMMIT", 6))

28 
	`LOG_ERROR_MESSAGE
("COMMIT failed. mysql„eports: %d %s",

29 
	`mysql_”ºo
(
dbc
->
mysql
), 
	`mysql_”rÜ
(dbc->mysql));

30  
ERROR
;

32  
OK
;

33 
	}
}

36 
	$_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
)

38 
dbc
->
mysql
=
	`mysql_š™
(
NULL
);

41 ià(!
	`mysql_»®_cÚÃù
(
dbc
->
mysql
, 
mysql_ho¡
, 
mysql_u£r
, 
mysql_·ss
, 
mysql_dbÇme
, 
	`©oi
(
mysql_pÜt_t
), 
mysql_sock‘_t
, 0))

43 ià(
	`mysql_”ºo
(
dbc
->
mysql
))

45 
	`LOG_ERROR_MESSAGE
("CÚÃùiÚØd©aba£ '%s' faed.", 
mysql_dbÇme
);

46 
	`LOG_ERROR_MESSAGE
("mysql„eports: %d %s",

47 
	`mysql_”ºo
(
dbc
->
mysql
), 
	`mysql_”rÜ
(dbc->mysql));

49  
ERROR
;

53 ià(
	`mysql_»®_qu”y
(
dbc
->
mysql
, "SET AUTOCOMMIT=0", 16))

55 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: %d %s", 
	`mysql_”ºo
(
dbc
->
mysql
) ,

56 
	`mysql_”rÜ
(
dbc
->
mysql
));

57  
ERROR
;

60  
OK
;

61 
	}
}

64 
	$_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
)

66 
	`mysql_şo£
(
dbc
->
mysql
);

67  
OK
;

68 
	}
}

70 
	$_db_š™
(* 
_mysql_dbÇme
, *
_mysql_ho¡
, * 
_mysql_u£r
,

71 * 
_mysql_·ss
, * 
_mysql_pÜt
, * 
_mysql_sock‘
)

74 ià(
_mysql_dbÇme
 !ğ
NULL
) {

75 
	`¡rıy
(
mysql_dbÇme
, 
_mysql_dbÇme
);

77 ià(
_mysql_ho¡
 !ğ
NULL
) {

78 
	`¡rıy
(
mysql_ho¡
, 
_mysql_ho¡
);

80 ià(
_mysql_u£r
 !ğ
NULL
) {

81 
	`¡rıy
(
mysql_u£r
, 
_mysql_u£r
);

83 ià(
_mysql_·ss
 !ğ
NULL
) {

84 
	`¡rıy
(
mysql_·ss
, 
_mysql_·ss
);

86 ià(
_mysql_pÜt
 !ğ
NULL
) {

87 
	`¡rıy
(
mysql_pÜt_t
, 
_mysql_pÜt
);

89 ià(
_mysql_sock‘
 !ğ
NULL
) {

90 
	`¡rıy
(
mysql_sock‘_t
, 
_mysql_sock‘
);

92  
OK
;

93 
	}
}

95 
	$rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

97 
	`LOG_ERROR_MESSAGE
("ROLLBACK INITIATED\n");

99 ià(
	`mysql_»®_qu”y
(
dbc
->
mysql
, "ROLLBACK", 8))

101 
	`LOG_ERROR_MESSAGE
("ROLLBACK failed. mysql„eports: %d %s",

102 
	`mysql_”ºo
(
dbc
->
mysql
), 
	`mysql_”rÜ
(dbc->mysql));

103  
ERROR
;

105  
STATUS_ROLLBACK
;

106 
	}
}

108 
	$dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
, 
sql_»suÉ_t
 * 
sql_»suÉ
,

109 * 
qu”y_Çme
)

112 
sql_»suÉ
->
»suÉ_£t
ğ
NULL
;

113 
sql_»suÉ
->
num_f›lds
= 0;

114 
sql_»suÉ
->
num_rows
= 0;

115 
sql_»suÉ
->
qu”y
=query;

117 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
qu”y
))

119 
	`LOG_ERROR_MESSAGE
("%s: %s\nmysqÈ»pÜts: %d %s",
qu”y_Çme
, 
qu”y
,

120 
	`mysql_”ºo
(
dbc
->
mysql
), 
	`mysql_”rÜ
(dbc->mysql));

125 
sql_»suÉ
->
»suÉ_£t
 = 
	`mysql_¡Üe_»suÉ
(
dbc
->
mysql
);

127 ià(
sql_»suÉ
->
»suÉ_£t
)

129 
sql_»suÉ
->
num_f›lds
ğ
	`mysql_num_f›lds
(sql_»suÉ->
»suÉ_£t
);

130 
sql_»suÉ
->
num_rows
ğ
	`mysql_num_rows
(sql_»suÉ->
»suÉ_£t
);

134 ià(
	`mysql_f›ld_couÁ
(
dbc
->
mysql
) == 0)

136 
sql_»suÉ
->
num_rows
 = 
	`mysql_afãùed_rows
(
dbc
->
mysql
);

140 
	`LOG_ERROR_MESSAGE
("%s: %s\nmysqÈ»pÜts: %d %s",
qu”y_Çme
, 
qu”y
,

141 
	`mysql_”ºo
(
dbc
->
mysql
), 
	`mysql_”rÜ
(dbc->mysql));

148 
	}
}

150 
	$dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
)

152 
sql_»suÉ
->
cu¼’t_row
ğ
	`mysql_ãtch_row
(sql_»suÉ->
»suÉ_£t
);

153 ià(
sql_»suÉ
->
cu¼’t_row
)

155 
sql_»suÉ
->
Ëngths
ğ
	`mysql_ãtch_Ëngths
(sql_»suÉ->
»suÉ_£t
);

159 
	}
}

161 
	$dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
)

164 ià(
sql_»suÉ
->
»suÉ_£t
)

166 
	`mysql_ä“_»suÉ
(
sql_»suÉ
->
»suÉ_£t
);

170 
	}
}

173 * 
	$dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
, 
f›ld
)

175 * 
tmp
;

177 
tmp
ğ
NULL
;

179 ià(
sql_»suÉ
->
cu¼’t_row
 && 
f›ld
 < sql_»suÉ->
num_f›lds
)

181 ià(
sql_»suÉ
->
cu¼’t_row
[
f›ld
])

183 ià((
tmp
 = 
	`ÿÎoc
((), 
sql_»suÉ
->
Ëngths
[
f›ld
]+1)))

185 
	`memıy
(
tmp
, (
sql_»suÉ
->
cu¼’t_row
)[
f›ld
], sql_»suÉ->
Ëngths
[field]);

189 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: CALLOC FAILED fÜ v®uäom f›ld=%d\n", 
f›ld
);

194 #ifdeà
DEBUG_QUERY


195 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: v¬[%d]=NULL\n", 
f›ld
);

201 #ifdeà
DEBUG_QUERY


202 
	`LOG_ERROR_MESSAGE
("dbt2_sql_getvalue: POSSIBLE NULL VALUE or ERROR\n\Query: %s\nField: %d from %d",

203 
sql_»suÉ
->
qu”y
, 
f›ld
, sql_»suÉ->
num_f›lds
);

206  
tmp
;

207 
	}
}

	@mysql/dbc_delivery.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"¡ršg.h
"

13 
	~"mysql_d–iv”y.h
"

15 
	~<¡dio.h
>

17 
	$execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
)

19 
¡mt
[512];

22 
	`¥rštf
(
¡mt
, "call delivery(%d, %d)",

23 
d©a
->
w_id
, d©a->
o_ÿ¼›r_id
);

25 #ifdeà
DEBUG_QUERY


26 
	`LOG_ERROR_MESSAGE
("execu‹_d–iv”y stmt: %s\n", 
¡mt
);

28 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
¡mt
))

30 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: %d %s", 
	`mysql_”ºo
(
dbc
->
mysql
) ,

31 
	`mysql_”rÜ
(
dbc
->
mysql
));

32  
ERROR
;

34  
OK
;

35 
	}
}

	@mysql/dbc_integrity.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"¡ršg.h
"

13 
	~"mysql_š‹gr™y.h
"

15 
	~<¡dio.h
>

17 
	$execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
)

19 
¡mt
[512];

20 
rc
;

22 
MYSQL_RES
 * 
»suÉ
;

23 
MYSQL_ROW
 
row
;

26 
	`¥rštf
(
¡mt
, "select count(w_id)‡s w from warehouse");

28 #ifdeà
DEBUG_QUERY


29 
	`LOG_ERROR_MESSAGE
("execu‹_d–iv”y stmt: %s\n", 
¡mt
);

32 
rc
ğ
OK
;

34 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
¡mt
))

36 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: %d %s", 
	`mysql_”ºo
(
dbc
->
mysql
) ,

37 
	`mysql_”rÜ
(
dbc
->
mysql
));

38 
rc
ğ
ERROR
;

42 ià((
»suÉ
 = 
	`mysql_¡Üe_»suÉ
(
dbc
->
mysql
)))

44 ià((
row
 = 
	`mysql_ãtch_row
(
»suÉ
)) && (row[0]))

46 ià(
	`©oi
(
row
[0]è!ğ
d©a
->
w_id
)

48 
	`LOG_ERROR_MESSAGE
("WrÚg‚umb” oàw¬ehou£s. Should b%d D©aba£„•Üt %d", 
d©a
->
w_id
, 
	`©oi
(
row
[0]));

49 
rc
ğ
ERROR
;

54 
	`årštf
(
¡d”r
, "E¼Ü: %s\n", 
	`mysql_”rÜ
(
dbc
->
mysql
));

55 
rc
ğ
ERROR
;

57 
	`mysql_ä“_»suÉ
(
»suÉ
);

61 
rc
ğ
ERROR
;

65  
rc
;

66 
	}
}

	@mysql/dbc_new_order.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"mysql_Ãw_Üd”.h
"

14 
	~<¡dio.h
>

15 
	~<¡ršg.h
>

17 
	$execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
)

19 
¡mt
[512];

20 
rc
;

22 
MYSQL_RES
 * 
»suÉ
;

23 
MYSQL_ROW
 
row
;

26 
	`¥rštf
(
¡mt
,

31 
d©a
->
w_id
, d©a->
d_id
, d©a->
c_id
, d©a->
o_®l_loÿl
,

32 
d©a
->
o_Ş_út
,

33 
d©a
->
Üd”_lše
[0].
Ş_i_id
,

34 
d©a
->
Üd”_lše
[0].
Ş_suµly_w_id
,

35 
d©a
->
Üd”_lše
[0].
Ş_quªt™y
,

36 
d©a
->
Üd”_lše
[1].
Ş_i_id
,

37 
d©a
->
Üd”_lše
[1].
Ş_suµly_w_id
,

38 
d©a
->
Üd”_lše
[1].
Ş_quªt™y
,

39 
d©a
->
Üd”_lše
[2].
Ş_i_id
,

40 
d©a
->
Üd”_lše
[2].
Ş_suµly_w_id
,

41 
d©a
->
Üd”_lše
[2].
Ş_quªt™y
,

42 
d©a
->
Üd”_lše
[3].
Ş_i_id
,

43 
d©a
->
Üd”_lše
[3].
Ş_suµly_w_id
,

44 
d©a
->
Üd”_lše
[3].
Ş_quªt™y
,

45 
d©a
->
Üd”_lše
[4].
Ş_i_id
,

46 
d©a
->
Üd”_lše
[4].
Ş_suµly_w_id
,

47 
d©a
->
Üd”_lše
[4].
Ş_quªt™y
,

48 
d©a
->
Üd”_lše
[5].
Ş_i_id
,

49 
d©a
->
Üd”_lše
[5].
Ş_suµly_w_id
,

50 
d©a
->
Üd”_lše
[5].
Ş_quªt™y
,

51 
d©a
->
Üd”_lše
[6].
Ş_i_id
,

52 
d©a
->
Üd”_lše
[6].
Ş_suµly_w_id
,

53 
d©a
->
Üd”_lše
[6].
Ş_quªt™y
,

54 
d©a
->
Üd”_lše
[7].
Ş_i_id
,

55 
d©a
->
Üd”_lše
[7].
Ş_suµly_w_id
,

56 
d©a
->
Üd”_lše
[7].
Ş_quªt™y
,

57 
d©a
->
Üd”_lše
[8].
Ş_i_id
,

58 
d©a
->
Üd”_lše
[8].
Ş_suµly_w_id
,

59 
d©a
->
Üd”_lše
[8].
Ş_quªt™y
,

60 
d©a
->
Üd”_lše
[9].
Ş_i_id
,

61 
d©a
->
Üd”_lše
[9].
Ş_suµly_w_id
,

62 
d©a
->
Üd”_lše
[9].
Ş_quªt™y
,

63 
d©a
->
Üd”_lše
[10].
Ş_i_id
,

64 
d©a
->
Üd”_lše
[10].
Ş_suµly_w_id
,

65 
d©a
->
Üd”_lše
[10].
Ş_quªt™y
,

66 
d©a
->
Üd”_lše
[11].
Ş_i_id
,

67 
d©a
->
Üd”_lše
[11].
Ş_suµly_w_id
,

68 
d©a
->
Üd”_lše
[11].
Ş_quªt™y
,

69 
d©a
->
Üd”_lše
[12].
Ş_i_id
,

70 
d©a
->
Üd”_lše
[12].
Ş_suµly_w_id
,

71 
d©a
->
Üd”_lše
[12].
Ş_quªt™y
,

72 
d©a
->
Üd”_lše
[13].
Ş_i_id
,

73 
d©a
->
Üd”_lše
[13].
Ş_suµly_w_id
,

74 
d©a
->
Üd”_lše
[13].
Ş_quªt™y
,

75 
d©a
->
Üd”_lše
[14].
Ş_i_id
,

76 
d©a
->
Üd”_lše
[14].
Ş_suµly_w_id
,

77 
d©a
->
Üd”_lše
[14].
Ş_quªt™y
);

80 #ifdeà
DEBUG_QUERY


81 
	`LOG_ERROR_MESSAGE
("execu‹_Ãw_Üd” stmt: %s\n", 
¡mt
);

84 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
¡mt
))

87 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: SQL: %s, ERROR: %d %s", 
¡mt
, 
	`mysql_”ºo
(
dbc
->
mysql
) ,

88 
	`mysql_”rÜ
(
dbc
->
mysql
));

89  
ERROR
;

92 
rc
ğ
ERROR
;

94 ià(
	`mysql_qu”y
(
dbc
->
mysql
, "select @rc"))

96 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: %d %s", 
	`mysql_”ºo
(
dbc
->
mysql
) ,

97 
	`mysql_”rÜ
(
dbc
->
mysql
));

101 ià((
»suÉ
 = 
	`mysql_¡Üe_»suÉ
(
dbc
->
mysql
)))

103 ià((
row
 = 
	`mysql_ãtch_row
(
»suÉ
)) && (row[0]))

105 
d©a
->
rŞlback
=
	`©oi
(
row
[0]);

106 ià(
d©a
->
rŞlback
)

108 
	`LOG_ERROR_MESSAGE
("NEW_ORDER ROLLBACK RC %d\n",
d©a
->
rŞlback
);

110 
rc
ğ
OK
;

114 
	`årštf
(
¡d”r
, "E¼Ü: %s\n", 
	`mysql_”rÜ
(
dbc
->
mysql
));

116 
	`mysql_ä“_»suÉ
(
»suÉ
);

120  
rc
;

121 
	}
}

	@mysql/dbc_order_status.c

11 
	~"commÚ.h
"

12 
	~"loggšg.h
"

13 
	~"mysql_Üd”_¡©us.h
"

15 
	~<¡dio.h
>

17 
	$execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
)

19 
¡mt
[128];

22 
	`¥rštf
(
¡mt
, "call order_status(%d, %d, %d, '%s')",

23 
d©a
->
c_id
, d©a->
c_w_id
, d©a->
c_d_id
, d©a->
c_Ï¡
);

25 #ifdeà
DEBUG_QUERY


26 
	`LOG_ERROR_MESSAGE
("execu‹_Üd”_¡©u ¡mt: %s\n", 
¡mt
);

28 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
¡mt
))

30 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: SQL STMT % ERROR: %d %s", 
¡mt
, 
	`mysql_”ºo
(
dbc
->
mysql
) ,

31 
	`mysql_”rÜ
(
dbc
->
mysql
));

32  
ERROR
;

34  
OK
;

35 
	}
}

	@mysql/dbc_payment.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"mysql_·ym’t.h
"

14 
	~<¡dio.h
>

16 
	$execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
)

18 
¡mt
[512];

21 
	`¥rštf
(
¡mt
, "call…ayment(%d, %d, %d, %d, %d, '%s', %f)",

22 
d©a
->
w_id
, d©a->
d_id
, d©a->
c_id
, d©a->
c_w_id
, d©a->
c_d_id
,

23 
d©a
->
c_Ï¡
, d©a->
h_amouÁ
);

25 #ifdeà
DEBUG_QUERY


26 
	`LOG_ERROR_MESSAGE
("execu‹_·ym’ˆ¡mt: %s\n", 
¡mt
);

29 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
¡mt
))

31 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜt SQL STMT: stmˆERROR: %d %s", 
	`mysql_”ºo
(
dbc
->
mysql
) ,

32 
	`mysql_”rÜ
(
dbc
->
mysql
));

33  
ERROR
;

35  
OK
;

36 
	}
}

	@mysql/dbc_stock_level.c

10 
	~"commÚ.h
"

11 
	~"loggšg.h
"

12 
	~"mysql_¡ock_Ëv–.h
"

14 
	~<¡dio.h
>

16 
	$execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
)

18 
¡mt
[512];

21 
	`¥rštf
(
¡mt
, "ÿÎ stock_Ëv–(%d, %d, %d, @low_¡ock)", 
d©a
->
w_id
, d©a->
d_id
, d©a->
th»shŞd
);

23 #ifdeà
DEBUG_QUERY


24 
	`LOG_ERROR_MESSAGE
("execu‹_¡ock_Ëv– stmt: %s\n", 
¡mt
);

27 ià(
	`mysql_qu”y
(
dbc
->
mysql
, 
¡mt
))

29 
	`LOG_ERROR_MESSAGE
("mysqÈ»pÜts: %d %s", 
	`mysql_”ºo
(
dbc
->
mysql
) ,

30 
	`mysql_”rÜ
(
dbc
->
mysql
));

31  
ERROR
;

33  
OK
;

34 
	}
}

	@nonsp/dbc_delivery.c

11 
	~<nÚ¥_d–iv”y.h
>

13 
	$execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
)

15 
rc
;

16 
nv®s
=3;

17 * 
v®s
[3];

19 
	`dbt2_š™_v®ues
(
v®s
, 
nv®s
);

21 
rc
=
	`d–iv”y
(
dbc
, 
d©a
, 
v®s
, 
nv®s
);

23 ià(
rc
 == -1 )

25 
	`LOG_ERROR_MESSAGE
("DELIVERY FINISHED WITH ERRORS \n");

28 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

30  
ERROR
;

32  
OK
;

33 
	}
}

35 
	$d–iv”y
(
db_cÚ‹xt_t
 *
dbc
, 
d–iv”y_t
 *
d©a
, ** 
v®s
, 
nv®s
)

38 
w_id
 = 
d©a
->w_id;

39 
o_ÿ¼›r_id
 = 
d©a
->o_carrier_id;

41 
sql_»suÉ_t
 
»suÉ
;

43 
qu”y
[256];

44 
d_id
;

46 
NO_O_ID
=0;

47 
O_C_ID
=1;

48 
OL_AMOUNT
=2;

50 
d_id
 = 1; d_id <= 10; d_id++)

52 
	`¥rštf
(
qu”y
, 
DELIVERY_1
, 
w_id
, 
d_id
);

54 #ifdeà
DEBUG_QUERY


55 
	`LOG_ERROR_MESSAGE
("DELIVERY_1: %s\n",
qu”y
);

57 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_1"è&&„esuÉ.
»suÉ_£t
)

59 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

60 
v®s
[
NO_O_ID
]ğ(*)
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

61 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

63 ià(!
v®s
[
NO_O_ID
])

65 
	`LOG_ERROR_MESSAGE
("ERROR: NO_O_ID=NULL fÜ qu”y DELIVERY_1:\n%s\n", 
qu”y
);

75 ià(
v®s
[
NO_O_ID
] && 
	`©oi
(vals[NO_O_ID])>0)

77 
	`¥rštf
(
qu”y
, 
DELIVERY_2
, 
v®s
[
NO_O_ID
], 
w_id
, 
d_id
);

79 #ifdeà
DEBUG_QUERY


80 
	`LOG_ERROR_MESSAGE
("DELIVERY_2: %s\n",
qu”y
);

82 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_2"))

86 
	`¥rštf
(
qu”y
, 
DELIVERY_3
, 
v®s
[
NO_O_ID
], 
w_id
, 
d_id
);

88 #ifdeà
DEBUG_QUERY


89 
	`LOG_ERROR_MESSAGE
("DELIVERY_3: %s\n",
qu”y
);

91 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_3"è&&„esuÉ.
»suÉ_£t
)

93 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

94 
v®s
[
O_C_ID
]ğ(*)
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

95 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

97 ià(!
v®s
[
O_C_ID
])

99 
	`LOG_ERROR_MESSAGE
("DELIVERY_3:qu”y %s\nO_C_IDğNULL", 
qu”y
);

108 
	`¥rštf
(
qu”y
, 
DELIVERY_4
, 
o_ÿ¼›r_id
, 
v®s
[
NO_O_ID
], 
w_id
, 
d_id
);

110 #ifdeà
DEBUG_QUERY


111 
	`LOG_ERROR_MESSAGE
("DELIVERY_4: qu”y %s\n", 
qu”y
);

114 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_4"))

119 
	`¥rštf
(
qu”y
, 
DELIVERY_5
, 
v®s
[
NO_O_ID
], 
w_id
, 
d_id
);

121 #ifdeà
DEBUG_QUERY


122 
	`LOG_ERROR_MESSAGE
("DELIVERY_5: qu”y %s\n", 
qu”y
);

125 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_5"))

130 
	`¥rštf
(
qu”y
, 
DELIVERY_6
, 
v®s
[
NO_O_ID
], 
w_id
, 
d_id
);

132 #ifdeà
DEBUG_QUERY


133 
	`LOG_ERROR_MESSAGE
("DELIVERY_6: qu”y %s\n", 
qu”y
);

135 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_6"è&&„esuÉ.
»suÉ_£t
)

137 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

138 
v®s
[
OL_AMOUNT
]ğ(*)
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

139 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

141 ià(!
v®s
[
OL_AMOUNT
])

151 
	`¢´štf
(
qu”y
, 250, 
DELIVERY_7
, 
v®s
[
OL_AMOUNT
], v®s[
O_C_ID
], 
w_id
, 
d_id
);

153 #ifdeà
DEBUG_QUERY


154 
	`LOG_ERROR_MESSAGE
("DELIVERY_7: qu”y % LEN %d\n", 
qu”y
, 
	`¡¾’
(query));

156 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "DELIVERY_7"))

158 
	`LOG_ERROR_MESSAGE
("DELIVERY_7: OL_AMOUNT: |%s| O_C_ID: |%s| qu”y %s", 
v®s
[
OL_AMOUNT
],

159 
v®s
[
O_C_ID
], 
qu”y
);

163 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

166 
	}
}

	@nonsp/dbc_integrity.c

10 
	~"nÚ¥_š‹gr™y.h
"

12 
	$execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
)

14 
rc
;

15 * 
v®s
[1];

16 
nv®s
=1;

18 
rc
=
	`š‹gr™y
(
dbc
, 
d©a
, 
v®s
, 
nv®s
);

20 ià(
rc
 == -1 )

22 
	`LOG_ERROR_MESSAGE
("TEST FINISHED WITH ERRORS \n");

25 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

27  
ERROR
;

29  
OK
;

30 
	}
}

32 
	$š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
, ** 
v®s
, 
nv®s
)

35 
w_id
 = 
d©a
->w_id;

37 
sql_»suÉ_t
 
»suÉ
;

38 
qu”y
[256];

39 
W_ID
=0;

41 
	`dbt2_š™_v®ues
(
v®s
, 
nv®s
);

43 
	`¥rštf
(
qu”y
, 
INTEGRITY_1
);

45 #ifdeà
DEBUG_QUERY


46 
	`LOG_ERROR_MESSAGE
("INTEGRITY_1 qu”y: %s\n",
qu”y
);

48 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "INTEGRITY_1"è&&„esuÉ.
»suÉ_£t
)

50 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

51 
v®s
[
W_ID
] = 
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

52 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

54 ià(!
v®s
[
W_ID
])

56 
	`LOG_ERROR_MESSAGE
("ERROR: W_ID i NULL fÜ qu”y INTEGRITY_1:\n%s\n", 
qu”y
);

60 ià(
	`©oi
(
v®s
[
W_ID
]è!ğ
w_id
)

62 
	`LOG_ERROR_MESSAGE
("ERROR: Ex³ù W_ID = %d GÙ W_ID = %d", 
w_id
, 
	`©oi
(
v®s
[
W_ID
]));

71 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

74 
	}
}

	@nonsp/dbc_new_order.c

11 
	~<nÚ¥_Ãw_Üd”.h
>

13 cÚ¡ 
	gs_di¡
[10][11] = {

18 
	$execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
)

20 
rc
;

22 * 
v®s
[6];

23 
nv®s
=6;

25 
rc
ğ
	`Ãw_Üd”
(
dbc
, 
d©a
, 
v®s
, 
nv®s
);

27 ià(
rc
)

29 
	`LOG_ERROR_MESSAGE
("NEW_ORDER FINISHED WITH RC %d\n", 
rc
);

32 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

34  
ERROR
;

37  
OK
;

38 
	}
}

40 
	$Ãw_Üd”
(
db_cÚ‹xt_t
 *
dbc
, 
Ãw_Üd”_t
 *
d©a
, ** 
v®s
, 
nv®s
)

43 
w_id
 = 
d©a
->w_id;

44 
d_id
 = 
d©a
->d_id;

45 
c_id
 = 
d©a
->c_id;

46 
o_®l_loÿl
 = 
d©a
->o_all_local;

47 
o_Ş_út
 = 
d©a
->o_ol_cnt;

49 
Ş_i_id
[15];

50 
Ş_suµly_w_id
[15];

51 
Ş_quªt™y
[15];

53 
i
;

54 
rc
;

56 
qu”y
[1024];

58 
Ş_amouÁ
[15];

59 
Üd”_amouÁ
 = 0.0;

61 
sql_»suÉ_t
 
»suÉ
;

63 * 
i_´iû
[15];

64 * 
i_Çme
[15];

65 * 
i_d©a
[15];

66 * 
s_quªt™y
[15];

67 * 
my_s_di¡
[15];

68 * 
s_d©a
[15];

70 
W_TAX
=0;

71 
D_TAX
=1;

72 
D_NEXT_O_ID
=2;

73 
C_DISCOUNT
=3;

74 
C_LAST
=4;

75 
C_CREDIT
=5;

77 
	`dbt2_š™_v®ues
(
v®s
, 
nv®s
);

78 
	`dbt2_š™_v®ues
(
i_´iû
, 15);

79 
	`dbt2_š™_v®ues
(
i_Çme
, 15);

80 
	`dbt2_š™_v®ues
(
i_d©a
, 15);

81 
	`dbt2_š™_v®ues
(
s_quªt™y
, 15);

82 
	`dbt2_š™_v®ues
(
my_s_di¡
, 15);

83 
	`dbt2_š™_v®ues
(
s_d©a
, 15);

86 
i
 = 0; i < 15; i++) {

87 
Ş_i_id
[
i
] = 
d©a
->
Üd”_lše
[i].ol_i_id;

88 
Ş_suµly_w_id
[
i
] = 
d©a
->
Üd”_lše
[i].ol_supply_w_id;

89 
Ş_quªt™y
[
i
] = 
d©a
->
Üd”_lše
[i].ol_quantity;

92 
	`¥rštf
(
qu”y
, 
NEW_ORDER_1
, 
w_id
);

94 #ifdeà
DEBUG_QUERY


95 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_1: %s\n",
qu”y
);

97 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_1"è&&„esuÉ.
»suÉ_£t
)

99 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

101 
v®s
[
W_TAX
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

102 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

109 
	`¥rštf
(
qu”y
, 
NEW_ORDER_2
, 
w_id
, 
d_id
);

111 #ifdeà
DEBUG_QUERY


112 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_2 qu”y: %s\n", 
qu”y
);

115 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_2"è&&„esuÉ.
»suÉ_£t
)

117 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

119 
v®s
[
D_TAX
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

120 
v®s
[
D_NEXT_O_ID
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

121 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

128 
	`¥rštf
(
qu”y
, 
NEW_ORDER_3
, 
w_id
, 
d_id
);

130 #ifdeà
DEBUG_QUERY


131 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_3 qu”y: %s\n", 
qu”y
);

134 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_3"))

139 
	`¥rštf
(
qu”y
, 
NEW_ORDER_4
, 
w_id
, 
d_id
, 
c_id
);

141 #ifdeà
DEBUG_QUERY


142 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_4: %s\n", 
qu”y
);

144 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_4"è&&„esuÉ.
»suÉ_£t
)

146 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

148 
v®s
[
C_DISCOUNT
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

149 
v®s
[
C_LAST
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

150 
v®s
[
C_CREDIT
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

152 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

159 
	`¥rštf
(
qu”y
, 
NEW_ORDER_5
, 
v®s
[
D_NEXT_O_ID
] , 
w_id
, 
d_id
);

161 #ifdeà
DEBUG_QUERY


162 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_5 qu”y: %s\n", 
qu”y
);

164 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_5"))

169 
	`¥rštf
(
qu”y
, 
NEW_ORDER_6
, 
v®s
[
D_NEXT_O_ID
] , 
d_id
, 
w_id
, 
c_id
, 
o_Ş_út
, 
o_®l_loÿl
);

171 #ifdeà
DEBUG_QUERY


172 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_6 qu”y: %s\n", 
qu”y
);

174 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_6"))

179 
rc
=0;

181 
i
 = 0; i < 
o_Ş_út
; i++)

183 
	`¥rštf
(
qu”y
, 
NEW_ORDER_7
, 
Ş_i_id
[
i
]);

185 #ifdeà
DEBUG_QUERY


186 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_7 qu”y: %s\n", 
qu”y
);

188 ià(
Ş_i_id
[
i
] != 0)

190 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_7"è&&„esuÉ.
»suÉ_£t
)

192 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

194 
i_´iû
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

195 
i_Çme
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

196 
i_d©a
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

198 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

202 
rc
=-1;

209 #ifdeà
DEBUG_QUERY


210 
	`LOG_ERROR_MESSAGE
("ROLLBACK BECAUSE OL_I_ID[%d]ğ0 fÜ qu”y:\nNEW_ORDER_7: %s", 
i
, 
qu”y
);

212 
rc
=2;

216 
Ş_amouÁ
[
i
] = 
	`©of
(
i_´iû
[i] ) * (è
Ş_quªt™y
[i];

218 
	`¥rštf
(
qu”y
, 
NEW_ORDER_8
, 
s_di¡
[
d_id
 - 1], 
Ş_i_id
[
i
], 
w_id
);

220 #ifdeà
DEBUG_QUERY


221 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_8 qu”y: %s\n", 
qu”y
);

223 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_8"è&&„esuÉ.
»suÉ_£t
)

225 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

227 
s_quªt™y
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

228 
my_s_di¡
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

229 
s_d©a
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

231 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

235 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_8 qu”y: %s", 
qu”y
);

236 
rc
=16;

240 
Üd”_amouÁ
 +ğ
Ş_amouÁ
[
i
];

242 ià(
	`©oi
(
s_quªt™y
[
i
] ) > 
Ş_quªt™y
[i] + 10)

244 
	`¥rštf
(
qu”y
, 
NEW_ORDER_9
, 
Ş_quªt™y
[
i
], 
Ş_i_id
[i], 
w_id
);

248 
	`¥rštf
(
qu”y
, 
NEW_ORDER_9
, 
Ş_quªt™y
[
i
] - 91, 
Ş_i_id
[i], 
w_id
);

251 #ifdeà
DEBUG_QUERY


252 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_9 qu”y: %s\n", 
qu”y
);

254 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_9"))

256 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_9 qu”y: %s", 
qu”y
);

257 
rc
=17;

261 
	`¥rštf
(
qu”y
, 
NEW_ORDER_10
, 
v®s
[
D_NEXT_O_ID
] , 
d_id
, 
w_id
, 
i
 + 1, 
Ş_i_id
[i],

262 
Ş_suµly_w_id
[
i
], 
Ş_quªt™y
[i], 
Ş_amouÁ
[i], 
my_s_di¡
[i] );

264 #ifdeà
DEBUG_QUERY


265 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_10 qu”y: %s\n", 
qu”y
);

267 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "NEW_ORDER_10"))

269 
	`LOG_ERROR_MESSAGE
("NEW_ORDER_10 qu”y: %s", 
qu”y
);

270 
rc
=18;

275 
	`dbt2_ä“_v®ues
(
i_´iû
, 15);

276 
	`dbt2_ä“_v®ues
(
i_Çme
, 15);

277 
	`dbt2_ä“_v®ues
(
i_d©a
, 15);

278 
	`dbt2_ä“_v®ues
(
s_quªt™y
, 15);

279 
	`dbt2_ä“_v®ues
(
my_s_di¡
, 15);

280 
	`dbt2_ä“_v®ues
(
s_d©a
, 15);

282 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

284  
rc
;

285 
	}
}

	@nonsp/dbc_nonsp.c

10 
	~<¡ršg.h
>

12 
	~<nÚ¥_commÚ.h
>

14 
	$dbt2_esÿ³_¡r
(*
Üig_¡r
, *
esc_¡r
)

16 
i
, 
j
;

18 ià(
Üig_¡r
 && 
esc_¡r
) {

19 
Ën
ğ
	`¡¾’
(
Üig_¡r
);

20 
i
 = 0, 
j
 = 0; i < 
Ën
; i++) {

21 ià(
Üig_¡r
[
i
] == '\'') {

22 
esc_¡r
[
j
++] = '\'';

23 #iâdeà
LIBSQLITE


24 } ià(
Üig_¡r
[
i
] == '\\') {

25 
esc_¡r
[
j
++] = '\\';

26 } ià(
Üig_¡r
[
i
] == ')') {

27 
esc_¡r
[
j
++] = '\\';

30 
esc_¡r
[
j
++] = 
Üig_¡r
[
i
];

32 
esc_¡r
[
j
] = '\0';

34 
	}
}

36 
	$dbt2_š™_v®ues
(** 
v®ues
, 
max_v®ues
)

38 
i
;

40 
i
=0; i<
max_v®ues
; i++) {

41 
v®ues
[
i
]ğ
NULL
;

44 
	}
}

46 
	$dbt2_ä“_v®ues
(** 
v®ues
, 
max_v®ues
)

48 
i
;

50 
i
=0; i<
max_v®ues
; i++) {

51 ià(
v®ues
[
i
]) {

52 
	`ä“
(
v®ues
[
i
]);

53 
v®ues
[
i
]ğ
NULL
;

57 
	}
}

	@nonsp/dbc_order_status.c

11 
	~<nÚ¥_Üd”_¡©us.h
>

13 
	$execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
)

15 
rc
;

17 
nv®s
=9;

18 * 
v®s
[9];

20 
rc
ğ
	`Üd”_¡©us
(
dbc
, 
d©a
, 
v®s
, 
nv®s
);

22 ià(
rc
 == -1 )

24 
	`LOG_ERROR_MESSAGE
("ORDER_STATUS FINISHED WITH ERRORS %d\n", 
rc
);

27 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

29  
ERROR
;

32  
OK
;

33 
	}
}

36 
	$Üd”_¡©us
(
db_cÚ‹xt_t
 *
dbc
, 
Üd”_¡©us_t
 *
d©a
, ** 
v®s
, 
nv®s
)

39 
c_id
 = 
d©a
->c_id;

40 
c_w_id
 = 
d©a
->c_w_id;

41 
c_d_id
 = 
d©a
->c_d_id;

43 
c_Ï¡
[
C_LAST_LEN
+1];

44 
qu”y
[512];

46 
sql_»suÉ_t
 
»suÉ
;

48 
i
;

49 
my_c_id
 = 0;

51 
TMP_C_ID
=0;

52 
C_FIRST
 = 1;

53 
C_MIDDLE
 = 2;

54 
MY_C_BALANCE
 = 3;

55 
C_BALANCE
 = 4;

56 
O_ID
 = 5;

57 
O_CARRIER_ID
 = 6;

58 
O_ENTRY_D
 = 7;

59 
O_OL_CNT
 = 8;

61 * 
Ş_i_id
[15];

62 * 
Ş_suµly_w_id
[15];

63 * 
Ş_quªt™y
[15];

64 * 
Ş_amouÁ
[15];

65 * 
Ş_d–iv”y_d
[15];

67 
	`dbt2_š™_v®ues
(
v®s
, 
nv®s
);

68 
	`dbt2_š™_v®ues
(
Ş_i_id
, 15);

69 
	`dbt2_š™_v®ues
(
Ş_suµly_w_id
, 15);

70 
	`dbt2_š™_v®ues
(
Ş_quªt™y
, 15);

71 
	`dbt2_š™_v®ues
(
Ş_amouÁ
, 15);

72 
	`dbt2_š™_v®ues
(
Ş_d–iv”y_d
, 15);

74 
	`¢´štf
(
c_Ï¡
, 
C_LAST_LEN
+1, "%s", 
d©a
->c_last);

76 ià(
c_id
 == 0)

78 
	`¥rštf
(
qu”y
, 
ORDER_STATUS_1
, 
c_w_id
, 
c_d_id
, 
c_Ï¡
);

80 #ifdeà
DEBUG_QUERY


81 
	`LOG_ERROR_MESSAGE
("ORDER_STATUS_1 %s\n", 
qu”y
);

84 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "ORDER_STATUS_1"è&&„esuÉ.
»suÉ_£t
)

87 #ifdeà
HAVE_SQL_RESULT_NUM_ROWS


88 
sk_rows
;

89 
sk_rows
=(
»suÉ
.
num_rows
+1)/2;

91 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

92 
sk_rows
--;

93 } 
sk_rows
 > 0);

94 
v®s
[
TMP_C_ID
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

96 ià(!
v®s
[
TMP_C_ID
])

98 
	`LOG_ERROR_MESSAGE
("ERROR: TMP_C_ID=NULL fÜ qu”y ORDER_STATUS_1:\n%s\n", 
qu”y
);

102 
my_c_id
 = 
	`©oi
(
v®s
[
TMP_C_ID
]);

105 
c_ids_¡©ic_¬¿y
[16];

106 * 
c_ids_¬¿y
 = 
c_ids_¡©ic_¬¿y
;

107 
c_ids_®loc_couÁ
 = 0;

108 
c_ids_»suÉ_couÁ
 = 0;

109 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
))

111 ià(
c_ids_»suÉ_couÁ
 >= 16

112 && 
c_ids_»suÉ_couÁ
 >ğ
c_ids_®loc_couÁ
)

114 ià(
c_ids_®loc_couÁ
 == 0)

116 
c_ids_®loc_couÁ
 = 32;

117 ià(!(
c_ids_¬¿y
 = 
	`»®loc
(
NULL
, 
c_ids_®loc_couÁ
*())))

119 
	`LOG_ERROR_MESSAGE
("order_status: REALLOC FAILEDryingoƒxpando 32ƒntries for middle„esult\n");

122 
	`memıy
(
c_ids_¬¿y
, 
c_ids_¡©ic_¬¿y
, (c_ids_static_array));

126 
c_ids_®loc_couÁ
 *= 2;

127 ià(!(
c_ids_¬¿y
 = 
	`»®loc
(c_ids_¬¿y, 
c_ids_®loc_couÁ
*())))

129 
	`LOG_ERROR_MESSAGE
("Üd”_¡©us: REALLOC FAILEDryšgØex·ndØ%dƒÁr› fÜ middË„esuÉ\n", 
c_ids_®loc_couÁ
);

134 
v®s
[
TMP_C_ID
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

136 ià(
v®s
[
TMP_C_ID
])

138 
c_ids_¬¿y
[
c_ids_»suÉ_couÁ
] = 
	`©oi
(
v®s
[
TMP_C_ID
]);

139 
	`ä“
(
v®s
[
TMP_C_ID
]);

143 
c_ids_¬¿y
[
c_ids_»suÉ_couÁ
] = -1;

145 
c_ids_»suÉ_couÁ
++;

146 
v®s
[
TMP_C_ID
] = 
NULL
;

148 
my_c_id
 = 
c_ids_¬¿y
[(
c_ids_»suÉ_couÁ
-1)/2];

149 ià(
c_ids_®loc_couÁ
)

151 
	`ä“
(
c_ids_¬¿y
);

153 ià(
my_c_id
 =ğ-1 || 
c_ids_»suÉ_couÁ
 == 0)

155 
	`LOG_ERROR_MESSAGE
("ERROR: TMP_C_ID=NULL fÜ qu”y ORDER_STATUS_1:\n%s\n", 
qu”y
);

159 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

169 
my_c_id
 = 
c_id
;

170 
v®s
[
TMP_C_ID
]=
NULL
;

173 
	`¥rštf
(
qu”y
, 
ORDER_STATUS_2
, 
c_w_id
, 
c_d_id
, 
my_c_id
);

175 #ifdeà
DEBUG_QUERY


176 
	`LOG_ERROR_MESSAGE
("ORDER_STATUS_2 %s\n", 
qu”y
);

178 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "ORDER_STATUS_2"è&&„esuÉ.
»suÉ_£t
)

180 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

182 
v®s
[
C_FIRST
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

183 
v®s
[
C_MIDDLE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

184 
v®s
[
MY_C_BALANCE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

185 
v®s
[
C_BALANCE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 3);

188 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

195 
	`¥rštf
(
qu”y
, 
ORDER_STATUS_3
, 
c_w_id
, 
c_d_id
, 
my_c_id
);

197 #ifdeà
DEBUG_QUERY


198 
	`LOG_ERROR_MESSAGE
("ORDER_STATUS_3 %s\n", 
qu”y
);

200 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "ORDER_STATUS_3"è&&„esuÉ.
»suÉ_£t
)

202 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

204 
v®s
[
O_ID
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

205 
v®s
[
O_CARRIER_ID
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

206 
v®s
[
O_ENTRY_D
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

207 
v®s
[
O_OL_CNT
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 3);

209 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

216 
	`¥rštf
(
qu”y
, 
ORDER_STATUS_4
, 
c_w_id
, 
c_d_id
, 
v®s
[
O_ID
]);

218 #ifdeà
DEBUG_QUERY


219 
	`LOG_ERROR_MESSAGE
("ORDER_STATUS_4 %s\n", 
qu”y
);

222 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "ORDER_STATUS_4"è&&„esuÉ.
»suÉ_£t
)

224 
i
= 0;

225 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
))

227 
Ş_i_id
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

228 
Ş_suµly_w_id
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

229 
Ş_quªt™y
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

230 
Ş_amouÁ
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 3);

231 
Ş_d–iv”y_d
[
i
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 4);

232 
i
++;

234 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

241 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

242 
	`dbt2_ä“_v®ues
(
Ş_i_id
, 15);

243 
	`dbt2_ä“_v®ues
(
Ş_suµly_w_id
, 15);

244 
	`dbt2_ä“_v®ues
(
Ş_quªt™y
, 15);

245 
	`dbt2_ä“_v®ues
(
Ş_amouÁ
, 15);

246 
	`dbt2_ä“_v®ues
(
Ş_d–iv”y_d
, 15);

249 
	}
}

	@nonsp/dbc_payment.c

11 
	~<nÚ¥_·ym’t.h
>

13 
	$execu‹_·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
)

15 
rc
;

17 * 
v®s
[29];

18 
nv®s
=29;

20 
rc
=
	`·ym’t
(
dbc
, 
d©a
, 
v®s
, 
nv®s
);

22 ià(
rc
 == -1 )

24 
	`LOG_ERROR_MESSAGE
("PAYMENT FINISHED WITH ERRORS \n");

27 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

29  
ERROR
;

32  
OK
;

33 
	}
}

35 
	$·ym’t
(
db_cÚ‹xt_t
 *
dbc
, 
·ym’t_t
 *
d©a
, ** 
v®s
, 
nv®s
)

38 
w_id
 = 
d©a
->w_id;

39 
d_id
 = 
d©a
->d_id;

40 
c_id
 = 
d©a
->c_id;

41 
c_w_id
 = 
d©a
->c_w_id;

42 
c_d_id
 = 
d©a
->c_d_id;

43 
c_Ï¡
[
C_LAST_LEN
+1];

44 
h_amouÁ
 = 
d©a
->h_amount;

46 
sql_»suÉ_t
 
»suÉ
;

48 
W_NAME
=0;

49 
W_STREET_1
=1;

50 
W_STREET_2
=2;

51 
W_CITY
=3;

52 
W_STATE
=4;

53 
W_ZIP
=5;

54 
D_NAME
=6;

55 
D_STREET_1
=7;

56 
D_STREET_2
=8;

57 
D_CITY
=9;

58 
D_STATE
=10;

59 
D_ZIP
=11;

60 
TMP_C_ID
=12;

61 
C_FIRST
=13;

62 
C_MIDDLE
=14;

63 
MY_C_LAST
=15;

64 
C_STREET_1
=16;

65 
C_STREET_2
=17;

66 
C_CITY
=18;

67 
C_STATE
=19;

68 
C_ZIP
=20;

69 
C_PHONE
=21;

70 
C_SINCE
=22;

71 
C_CREDIT
=23;

72 
C_CREDIT_LIM
=24;

73 
C_DISCOUNT
=25;

74 
C_BALANCE
=26;

75 
C_DATA
=27;

76 
C_YTD_PAYMENT
=28;

78 
qu”y
[4096];

80 
my_c_id
 = 0;

81 
my_w_Çme
[20];

82 
my_d_Çme
[20];

84 
	`dbt2_š™_v®ues
(
v®s
, 
nv®s
);

86 
	`¢´štf
(
c_Ï¡
, 
C_LAST_LEN
+1, "%s", 
d©a
->c_last);

88 #ifdeà
DEBUG_INPUT_DATA


89 
	`LOG_ERROR_MESSAGE
("PAYMENT_INPUT: w_id: %d\À d_id: %d\À c_id: %d\À c_w_id: %d\À c_d_id: %d\n",
w_id
,
d_id
,
c_id
,
c_w_id
,
c_d_id
);

91 
	`¥rštf
(
qu”y
, 
PAYMENT_1
, 
w_id
);

93 #ifdeà
DEBUG_QUERY


94 
	`LOG_ERROR_MESSAGE
("PAYMENT_1 qu”y: %s\n",
qu”y
);

96 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_1"è&&„esuÉ.
»suÉ_£t
)

98 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

100 
v®s
[
W_NAME
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

101 
v®s
[
W_STREET_1
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

102 
v®s
[
W_STREET_2
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

103 
v®s
[
W_CITY
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 3);

104 
v®s
[
W_STATE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 4);

105 
v®s
[
W_ZIP
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 5);

109 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

116 
	`¥rštf
(
qu”y
, 
PAYMENT_2
, 
h_amouÁ
, 
w_id
);

118 #ifdeà
DEBUG_QUERY


119 
	`LOG_ERROR_MESSAGE
("PAYMENT_2 qu”y: %s\n",
qu”y
);

122 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_2"))

127 
	`¥rštf
(
qu”y
, 
PAYMENT_3
, 
d_id
, 
w_id
);

129 #ifdeà
DEBUG_QUERY


130 
	`LOG_ERROR_MESSAGE
("PAYMENT_3 qu”y: %s\n",
qu”y
);

133 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_3"è&&„esuÉ.
»suÉ_£t
)

135 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

137 
v®s
[
D_NAME
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

138 
v®s
[
D_STREET_1
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

139 
v®s
[
D_STREET_2
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

140 
v®s
[
D_CITY
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 3);

141 
v®s
[
D_STATE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 4);

142 
v®s
[
D_ZIP
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 5);

146 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

153 
	`¥rštf
(
qu”y
, 
PAYMENT_4
, 
h_amouÁ
, 
d_id
, 
w_id
);

155 #ifdeà
DEBUG_QUERY


156 
	`LOG_ERROR_MESSAGE
("PAYMENT_4 qu”y: %s\n", 
qu”y
);

159 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_4"))

161 
	`LOG_ERROR_MESSAGE
("PAYMENT_4 qu”y: %s", 
qu”y
);

165 ià(
c_id
 == 0)

167 
	`¥rštf
(
qu”y
, 
PAYMENT_5
, 
w_id
, 
d_id
, 
c_Ï¡
);

169 #ifdeà
DEBUG_QUERY


170 
	`LOG_ERROR_MESSAGE
("PAYMENT_5 qu”y: %s\n", 
qu”y
);

173 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_5"è&&„esuÉ.
»suÉ_£t
)

175 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

176 
v®s
[
TMP_C_ID
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

177 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

179 ià(!
v®s
[
TMP_C_ID
])

181 
	`LOG_ERROR_MESSAGE
("ERROR: TMP_C_ID=NULL fÜ qu”y PAYMENT_5:\n%s\n", 
qu”y
);

184 
my_c_id
 = 
	`©oi
(
v®s
[
TMP_C_ID
]);

193 
my_c_id
 = 
c_id
;

194 
v®s
[
TMP_C_ID
]=
NULL
;

197 
	`¥rštf
(
qu”y
, 
PAYMENT_6
, 
c_w_id
, 
c_d_id
, 
my_c_id
);

199 #ifdeà
DEBUG_QUERY


200 
	`LOG_ERROR_MESSAGE
("PAYMENT_6 qu”y: %s\n",
qu”y
);

202 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_6"è&&„esuÉ.
»suÉ_£t
)

204 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

211 
v®s
[
C_FIRST
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

212 
v®s
[
C_MIDDLE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 1);

213 
v®s
[
MY_C_LAST
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 2);

214 
v®s
[
C_STREET_1
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 3);

215 
v®s
[
C_STREET_2
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 4);

216 
v®s
[
C_CITY
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 5);

217 
v®s
[
C_STATE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 6);

218 
v®s
[
C_ZIP
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 7);

219 
v®s
[
C_PHONE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 8);

220 
v®s
[
C_SINCE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 9);

221 
v®s
[
C_CREDIT
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 10);

222 
v®s
[
C_CREDIT_LIM
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 11);

223 
v®s
[
C_DISCOUNT
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 12);

224 
v®s
[
C_BALANCE
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 13);

225 
v®s
[
C_DATA
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 14);

226 
v®s
[
C_YTD_PAYMENT
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 15);

228 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

230 ià(!
v®s
[
C_CREDIT
])

232 
	`LOG_ERROR_MESSAGE
("ERROR: C_CREDIT=NULL fÜ qu”y PAYMENT_6:\n%s\n", 
qu”y
);

242 ià(
v®s
[
C_CREDIT
][0] == 'G')

244 
	`¥rštf
(
qu”y
, 
PAYMENT_7_GC
, 
h_amouÁ
, 
my_c_id
, 
c_w_id
, 
c_d_id
);

246 #ifdeà
DEBUG_QUERY


247 
	`LOG_ERROR_MESSAGE
("PAYMENT_7_GC qu”y: %s\n",
qu”y
);

249 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_7_GC"))

256 
my_c_d©a
[1000];

257 
	`¥rštf
(
my_c_d©a
, "%d %d %d %d %d %à", 
my_c_id
, 
c_d_id
,

258 
c_w_id
, 
d_id
, 
w_id
, 
h_amouÁ
);

260 
	`dbt2_esÿ³_¡r
(
v®s
[
C_DATA
], 
my_c_d©a
);

261 
	`¥rštf
(
qu”y
, 
PAYMENT_7_BC
, 
h_amouÁ
, 
my_c_d©a
, 
my_c_id
, 
c_w_id
, 
c_d_id
);

263 #ifdeà
DEBUG_QUERY


264 
	`LOG_ERROR_MESSAGE
("PAYMENT_7_BC qu”y: %s\n",
qu”y
);

267 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_7_BC"))

274 
	`dbt2_esÿ³_¡r
(
v®s
[
W_NAME
], 
my_w_Çme
);

275 
	`dbt2_esÿ³_¡r
(
v®s
[
D_NAME
], 
my_d_Çme
);

277 
	`¥rštf
(
qu”y
, 
PAYMENT_8
, 
my_c_id
, 
c_d_id
, 
c_w_id
, 
d_id
, 
w_id
,

278 
h_amouÁ
, 
my_w_Çme
, 
my_d_Çme
);

280 #ifdeà
DEBUG_QUERY


281 
	`LOG_ERROR_MESSAGE
("PAYMENT_8 qu”y: %s\n",
qu”y
);

284 ià(!
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "PAYMENT_8"))

289 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

292 
	}
}

	@nonsp/dbc_stock_level.c

11 
	~"nÚ¥_¡ock_Ëv–.h
"

13 
	$execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
)

15 
rc
;

16 * 
v®s
[2];

17 
nv®s
=2;

19 
rc
=
	`¡ock_Ëv–
(
dbc
, 
d©a
, 
v®s
, 
nv®s
);

21 ià(
rc
 == -1 )

23 
	`LOG_ERROR_MESSAGE
("STOCK LEVEL FINISHED WITH ERRORS \n");

26 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

28  
ERROR
;

31  
OK
;

32 
	}
}

35 
	$¡ock_Ëv–
(
db_cÚ‹xt_t
 *
dbc
, 
¡ock_Ëv–_t
 *
d©a
, ** 
v®s
, 
nv®s
)

38 
w_id
 = 
d©a
->w_id;

39 
d_id
 = 
d©a
->d_id;

40 
th»shŞd
 = 
d©a
->threshold;

42 
sql_»suÉ_t
 
»suÉ
;

44 
d_Ãxt_o_id
 = 0;

45 
low_¡ock
 = 0;

46 
qu”y
[256];

48 
D_NEXT_O_ID
=0;

49 
LOW_STOCK
=1;

51 
	`dbt2_š™_v®ues
(
v®s
, 
nv®s
);

53 
	`¥rštf
(
qu”y
, 
STOCK_LEVEL_1
, 
w_id
, 
d_id
);

55 #ifdeà
DEBUG_QUERY


56 
	`LOG_ERROR_MESSAGE
("STOCK_LEVEL_1 qu”y: %s\n",
qu”y
);

58 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "STOCK_LEVEL_1"è&&„esuÉ.
»suÉ_£t
)

60 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

61 
v®s
[
D_NEXT_O_ID
] = 
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

62 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

64 ià(!
v®s
[
D_NEXT_O_ID
])

66 
	`LOG_ERROR_MESSAGE
("ERROR: D_NEXT_O_ID=NULL fÜ qu”y STOCK_LEVEL_1:\n%s\n", 
qu”y
);

69 
d_Ãxt_o_id
 = 
	`©oi
(
v®s
[
D_NEXT_O_ID
]);

76 
	`¥rštf
(
qu”y
, 
STOCK_LEVEL_2
, 
d_id
, 
w_id
, 
th»shŞd
, 
d_Ãxt_o_id
 - 20,

77 
d_Ãxt_o_id
 - 1);

79 #ifdeà
DEBUG_QUERY


80 
	`LOG_ERROR_MESSAGE
("STOCK_LEVEL_2 qu”y: %s\n",
qu”y
);

82 ià(
	`dbt2_sql_execu‹
(
dbc
, 
qu”y
, &
»suÉ
, "STOCK_LEVEL_2"è&&„esuÉ.
»suÉ_£t
)

84 
	`dbt2_sql_ãtchrow
(
dbc
, &
»suÉ
);

86 
v®s
[
LOW_STOCK
]ğ
	`dbt2_sql_g‘v®ue
(
dbc
, &
»suÉ
, 0);

87 
	`dbt2_sql_şo£_cursÜ
(
dbc
, &
»suÉ
);

89 ià(!
v®s
[
LOW_STOCK
])

91 
	`LOG_ERROR_MESSAGE
("ERROR: LOW_STOCK=NULL fÜ qu”y STOCK_LEVEL_2:\n%s\n", 
qu”y
);

94 
low_¡ock
 = 
	`©oi
(
v®s
[
LOW_STOCK
]);

101 
	`dbt2_ä“_v®ues
(
v®s
, 
nv®s
);

104 
	}
}

	@odbc/dbc_common.c

11 
	~<±h»ad.h
>

12 
	~<¡dio.h
>

13 
	~<¡ršg.h
>

15 
	~<odbc_commÚ.h
>

17 
SQLHENV
 
	gh’v
 = 
SQL_NULL_HENV
;

18 
±h»ad_mu‹x_t
 
	gdb_sourû_mu‹x
 = 
PTHREAD_MUTEX_INITIALIZER
;

20 
SQLCHAR
 
	g£rv”Çme
[32];

21 
SQLCHAR
 
	gu£ºame
[32];

22 
SQLCHAR
 
	gauth’tiÿtiÚ
[32];

24 
	$check_odbc_rc
(
SQLSMALLINT
 
hªdË_ty³
, 
SQLHANDLE
 
hªdË
, 
SQLRETURN
 
rc
)

27 ià(
rc
 =ğ
SQL_SUCCESS
) {

28  
OK
;

29 } ià(
rc
 =ğ
SQL_SUCCESS_WITH_INFO
) {

30 
	`LOG_ERROR_MESSAGE
("SQL_SUCCESS_WITH_INFO");

31 } ià(
rc
 =ğ
SQL_NEED_DATA
) {

32 
	`LOG_ERROR_MESSAGE
("SQL_NEED_DATA");

33 } ià(
rc
 =ğ
SQL_STILL_EXECUTING
) {

34 
	`LOG_ERROR_MESSAGE
("SQL_STILL_EXECUTING");

35 } ià(
rc
 =ğ
SQL_ERROR
) {

36  
ERROR
;

37 } ià(
rc
 =ğ
SQL_NO_DATA
) {

38 
	`LOG_ERROR_MESSAGE
("SQL_NO_DATA");

39 } ià(
rc
 =ğ
SQL_INVALID_HANDLE
) {

40 
	`LOG_ERROR_MESSAGE
("SQL_INVALID_HANDLE");

43  
OK
;

44 
	}
}

47 
	$log_odbc_”rÜ
(*
f’ame
, 
lše
, 
SQLSMALLINT
 
hªdË_ty³
,

48 
SQLHANDLE
 
hªdË
)

50 
SQLCHAR
 
sql¡©e
[5];

51 
SQLCHAR
 
mes§ge
[256];

52 
SQLSMALLINT
 
i
;

53 
msg
[1024];

55 
i
 = 1;

56 
	`SQLG‘DŸgRec
(
hªdË_ty³
, 
hªdË
, 
i
, 
sql¡©e
,

57 
NULL
, 
mes§ge
, (mes§ge), NULLè=ğ
SQL_SUCCESS
) {

58 
	`¥rštf
(
msg
, "[%d] sql¡©% : %s", 
i
, 
sql¡©e
, 
mes§ge
);

59 
	`log_”rÜ_mes§ge
(
f’ame
, 
lše
, 
msg
);

60 ++
i
;

62  
OK
;

63 
	}
}

65 
	$comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

67 
i
;

69 
i
 = 
	`SQLEndT¿n
(
SQL_HANDLE_DBC
, 
dbc
->
hdbc
, 
SQL_COMMIT
);

70 ià(
i
 !ğ
SQL_SUCCESS
 && i !ğ
SQL_SUCCESS_WITH_INFO
) {

71 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

72  
ERROR
;

74  
OK
;

75 
	}
}

78 
	$_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
odbcc
)

80 
SQLRETURN
 
rc
;

83 
	`±h»ad_mu‹x_lock
(&
db_sourû_mu‹x
);

84 
rc
 = 
	`SQLAÎocHªdË
(
SQL_HANDLE_DBC
, 
h’v
, &
odbcc
->
hdbc
);

85 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

86 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

87 
	`SQLF»eHªdË
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

88  
ERROR
;

92 
rc
 = 
	`SQLCÚÃù
(
odbcc
->
hdbc
, 
£rv”Çme
, 
SQL_NTS
,

93 
u£ºame
, 
SQL_NTS
, 
auth’tiÿtiÚ
, SQL_NTS);

94 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

95 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

96 
	`SQLF»eHªdË
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

97  
ERROR
;

100 
rc
 = 
	`SQLS‘CÚÃùA‰r
(
odbcc
->
hdbc
, 
SQL_ATTR_AUTOCOMMIT
,

101 
SQL_AUTOCOMMIT_OFF
, 0);

102 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

103 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

104  
ERROR
;

107 
rc
 = 
	`SQLS‘CÚÃùA‰r
(
odbcc
->
hdbc
, 
SQL_ATTR_TXN_ISOLATION
,

108 (
SQLPOINTER
 *è
SQL_TXN_REPEATABLE_READ
, 0);

109 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

110 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

111  
ERROR
;

115 
rc
 = 
	`SQLAÎocHªdË
(
SQL_HANDLE_STMT
, 
odbcc
->
hdbc
, &odbcc->
h¡mt
);

116 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

117 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

118  
ERROR
;

120 
	`±h»ad_mu‹x_uÆock
(&
db_sourû_mu‹x
);

122  
OK
;

123 
	}
}

130 
	$odbc_discÚÃù
(
db_cÚ‹xt_t
 *
odbcc
)

132 
SQLRETURN
 
rc
;

134 
	`±h»ad_mu‹x_lock
(&
db_sourû_mu‹x
);

135 
rc
 = 
	`SQLDiscÚÃù
(
odbcc
->
hdbc
);

136 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

137 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

138  
ERROR
;

140 
rc
 = 
	`SQLF»eHªdË
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

141 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

142 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_DBC
, 
odbcc
->
hdbc
);

143  
ERROR
;

145 
rc
 = 
	`SQLF»eHªdË
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

146 ià(
rc
 !ğ
SQL_SUCCESS
) {

147 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

148  
ERROR
;

150 
	`±h»ad_mu‹x_uÆock
(&
db_sourû_mu‹x
);

151  
OK
;

152 
	}
}

155 
	$_db_š™
(*
¢ame
, *
uÇme
, *
auth
)

157 
SQLRETURN
 
rc
;

160 
rc
 = 
	`SQLAÎocHªdË
(
SQL_HANDLE_ENV
, 
SQL_NULL_HANDLE
, &
h’v
);

161 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

162 
	`LOG_ERROR_MESSAGE
("allocƒnv handle failed");

163  
ERROR
;

165 
rc
 = 
	`SQLS‘EnvA‰r
(
h’v
, 
SQL_ATTR_ODBC_VERSION
, (*è
SQL_OV_ODBC3
, 0);

166 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

167 
	`SQLF»eHªdË
(
SQL_HANDLE_ENV
, 
h’v
);

168  
ERROR
;

172 
	`¡rıy
(
£rv”Çme
, 
¢ame
);

173 
	`¡rıy
(
u£ºame
, 
uÇme
);

174 
	`¡rıy
(
auth’tiÿtiÚ
, 
auth
);

175  
OK
;

176 
	}
}

178 
	$rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

180 
i
;

182 
i
 = 
	`SQLEndT¿n
(
SQL_HANDLE_DBC
, 
dbc
->
hdbc
, 
SQL_ROLLBACK
);

183 ià(
i
 !ğ
SQL_SUCCESS
 && i !ğ
SQL_SUCCESS_WITH_INFO
) {

184 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

185  
ERROR
;

187  
STATUS_ROLLBACK
;

188 
	}
}

191 
	$dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
,

192 
sql_»suÉ_t
 * 
sql_»suÉ
, * 
qu”y_Çme
)

194 
i
;

195 
SQLCHAR
 
cŞÇme
[32];

196 
SQLSMALLINT
 
cŞty³
;

197 
SQLSMALLINT
 
cŞÇm–’
;

198 
SQLSMALLINT
 
sÿË
;

199 
SQLRETURN
 
rc
;

201 
sql_»suÉ
->
num_f›lds
= 0;

202 
sql_»suÉ
->
num_rows
= 0;

203 
sql_»suÉ
->
qu”y
= query;

205 
rc
 = 
	`SQLExecDœeù
(
dbc
->
h¡mt
, 
qu”y
, 
SQL_NTS
);

206 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

207 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

210 
rc
 = 
	`SQLNumResuÉCŞs
(
dbc
->
h¡mt
,&
sql_»suÉ
->
num_f›lds
);

211 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

212 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

216 
rc
 = 
	`SQLRowCouÁ
(
dbc
->
h¡mt
, &
sql_»suÉ
->
num_rows
);

217 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

218 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

222 ià(
sql_»suÉ
->
num_f›lds
) {

223 
sql_»suÉ
->
Ëngths
ğ
	`m®loc
((è* sql_»suÉ->
num_f›lds
);

225 
i
=0; i < 
sql_»suÉ
->
num_f›lds
; i++) {

226 
	`SQLDesüibeCŞ
(
dbc
->
h¡mt
,

227 (
SQLSMALLINT
)(
i
 + 1),

228 
cŞÇme
,

229 (
cŞÇme
),

230 &
cŞÇm–’
,

231 &
cŞty³
,

232 &
sql_»suÉ
->
Ëngths
[
i
],

233 &
sÿË
,

234 
NULL


237 
sql_»suÉ
->
cu¼’t_row
 = 1;

238 
sql_»suÉ
->
»suÉ_£t
 = 1;

242 
	}
}

244 
	$dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
,

245 
sql_»suÉ_t
 * 
sql_»suÉ
)

247 
SQLRETURN
 
rc
;

249 ià(
sql_»suÉ
->
Ëngths
) {

250 
	`ä“
(
sql_»suÉ
->
Ëngths
);

251 
sql_»suÉ
->
Ëngths
=
NULL
;

254 
rc
 = 
	`SQLClo£CursÜ
(
dbc
->
h¡mt
);

255 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

256 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

260 
	}
}

262 
	$dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
,

263 
sql_»suÉ_t
 * 
sql_»suÉ
)

265 
SQLRETURN
 
rc
;

267 
rc
 = 
	`SQLF‘ch
(
dbc
->
h¡mt
);

269 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

270 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

272 
sql_»suÉ
->
cu¼’t_row
= 0;

277 
	}
}

279 *
	$dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
,

280 
sql_»suÉ_t
 *
sql_»suÉ
, 
f›ld
)

282 
SQLRETURN
 
rc
;

283 *
tmp
;

285 
tmp
 = 
NULL
;

286 
SQLINTEGER
 
cb_v¬
 = 0;

288 ià(
sql_»suÉ
->
cu¼’t_row
 && 
f›ld
 < sql_»suÉ->
num_f›lds
) {

289 ià((
tmp
 = 
	`ÿÎoc
((), 
sql_»suÉ
->
Ëngths
[
f›ld
] + 1))) {

290 
rc
 = 
	`SQLG‘D©a
(
dbc
->
h¡mt
, 
f›ld
 + 1, 
SQL_C_CHAR
, 
tmp
,

291 
sql_»suÉ
->
Ëngths
[
f›ld
] + 1, &
cb_v¬
);

292 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

293 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
dbc
->
h¡mt
);

296 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: CALLOC FAILED fÜ v®uäom f›ld=%d\n", 
f›ld
);

298 #ifdeà
DEBUG_QUERY


300 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: FIELD %d cu¼’t_row %d\nQUERY --- %s\n", 
f›ld
, 
sql_»suÉ
->
cu¼’t_row
, sql_»suÉ->
qu”y
);

303  
tmp
;

304 
	}
}

	@odbc/dbc_delivery.c

10 
	~<odbc_d–iv”y.h
>

12 
	$execu‹_d–iv”y
(
db_cÚ‹xt_t
 *
odbcc
, 
d–iv”y_t
 *
d©a
)

14 
SQLRETURN
 
rc
;

15 
i
 = 1;

18 
rc
 = 
	`SQLP»·»
(
odbcc
->
h¡mt
, 
STMT_DELIVERY
, 
SQL_NTS
);

19 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

20 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

21  
ERROR
;

25 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

26 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

27 &
d©a
->
w_id
, 0, 
NULL
);

28 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

29 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

30  
ERROR
;

32 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

33 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

34 &
d©a
->
o_ÿ¼›r_id
, 0, 
NULL
);

35 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

36 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

37  
ERROR
;

41 
rc
 = 
	`SQLExecu‹
(
odbcc
->
h¡mt
);

42 ià(
	`check_odbc_rc
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
, 
rc
è=ğ
ERROR
) {

43 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

44  
ERROR
;

47  
OK
;

48 
	}
}

	@odbc/dbc_integrity.c

10 
	~"odbc_š‹gr™y.h
"

12 
	$execu‹_š‹gr™y
(
db_cÚ‹xt_t
 *
dbc
, 
š‹gr™y_t
 *
d©a
)

17  
OK
;

18 
	}
}

	@odbc/dbc_new_order.c

11 
	~<odbc_Ãw_Üd”.h
>

13 
	$execu‹_Ãw_Üd”
(
db_cÚ‹xt_t
 *
odbcc
, 
Ãw_Üd”_t
 *
d©a
)

15 
SQLRETURN
 
rc
;

16 
i
 = 1;

17 
j
;

20 
rc
 = 
	`SQLP»·»
(
odbcc
->
h¡mt
, 
STMT_NEW_ORDER
, 
SQL_NTS
);

21 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

22 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

23  
ERROR
;

27 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

28 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

29 &
d©a
->
w_id
, 0, 
NULL
);

30 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

31 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

32  
ERROR
;

34 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

35 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

36 &
d©a
->
d_id
, 0, 
NULL
);

37 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

38 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

39  
ERROR
;

41 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

42 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

43 &
d©a
->
c_id
, 0, 
NULL
);

44 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

45 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

46  
ERROR
;

48 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

49 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

50 &
d©a
->
o_®l_loÿl
, 0, 
NULL
);

51 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

52 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

53  
ERROR
;

55 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

56 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

57 &
d©a
->
o_Ş_út
, 0, 
NULL
);

58 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

59 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

60  
ERROR
;

62 
j
 = 0; j < 
O_OL_CNT_MAX
; j++) {

63 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

64 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

65 &
d©a
->
Üd”_lše
[
j
].
Ş_i_id
, 0, 
NULL
);

66 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

67 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

68  
ERROR
;

70 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

71 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

72 &
d©a
->
Üd”_lše
[
j
].
Ş_suµly_w_id
, 0, 
NULL
);

73 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

74 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

75  
ERROR
;

77 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

78 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

79 &
d©a
->
Üd”_lše
[
j
].
Ş_quªt™y
, 0, 
NULL
);

80 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

81 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

82  
ERROR
;

84 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

85 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

86 
d©a
->
Üd”_lše
[
j
].
i_Çme
,

87 (
d©a
->
Üd”_lše
[
j
].
i_Çme
), 
NULL
);

88 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

89 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

90  
ERROR
;

92 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

93 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

94 &
d©a
->
Üd”_lše
[
j
].
i_´iû
, 0, 
NULL
);

95 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

96 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

97  
ERROR
;

99 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

100 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

101 &
d©a
->
Üd”_lše
[
j
].
s_quªt™y
, 0, 
NULL
);

102 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

103 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

104  
ERROR
;

106 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

107 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

108 &
d©a
->
Üd”_lše
[
j
].
Ş_amouÁ
, 0, 
NULL
);

109 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

110 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

111  
ERROR
;

114 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

115 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

116 &
d©a
->
o_id
, 0, 
NULL
);

117 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

118 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

119  
ERROR
;

121 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

122 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

123 &
d©a
->
tÙ®_amouÁ
, 0, 
NULL
);

124 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

125 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

126  
ERROR
;

128 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

129 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

130 &
d©a
->
w_x
, 0, 
NULL
);

131 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

132 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

133  
ERROR
;

135 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

136 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

137 &
d©a
->
d_x
, 0, 
NULL
);

138 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

139 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

140  
ERROR
;

142 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

143 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

144 
d©a
->
c_Ï¡
,

145 (
d©a
->
c_Ï¡
), 
NULL
);

146 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

147 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

148  
ERROR
;

150 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

151 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

152 
d©a
->
c_üed™
,

153 (
d©a
->
c_üed™
), 
NULL
);

154 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

155 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

156  
ERROR
;

158 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

159 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

160 &
d©a
->
c_discouÁ
, 0, 
NULL
);

161 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

162 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

163  
ERROR
;

165 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

166 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

167 &
d©a
->
rŞlback
, 0, 
NULL
);

168 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

169 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

170  
ERROR
;

174 
rc
 = 
	`SQLExecu‹
(
odbcc
->
h¡mt
);

175 ià(
	`check_odbc_rc
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
, 
rc
è=ğ
ERROR
) {

176 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

177  
ERROR
;

180  
OK
;

181 
	}
}

	@odbc/dbc_order_status.c

11 
	~<odbc_Üd”_¡©us.h
>

13 
	$execu‹_Üd”_¡©us
(
db_cÚ‹xt_t
 *
odbcc
,

14 
Üd”_¡©us_t
 *
d©a
)

16 
SQLRETURN
 
rc
;

17 
i
 = 1;

18 
j
;

21 
rc
 = 
	`SQLP»·»
(
odbcc
->
h¡mt
, 
STMT_ORDER_STATUS
, 
SQL_NTS
);

22 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

23 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

24  
ERROR
;

28 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

29 
i
++, 
SQL_PARAM_INPUT_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

30 &
d©a
->
c_id
, 0, 
NULL
);

31 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

32 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

33  
ERROR
;

35 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

36 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

37 &
d©a
->
c_w_id
, 0, 
NULL
);

38 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

39 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

40  
ERROR
;

42 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

43 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

44 &
d©a
->
c_d_id
, 0, 
NULL
);

45 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

46 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

47  
ERROR
;

49 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

50 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

51 
d©a
->
c_fœ¡
,

52 (
d©a
->
c_fœ¡
), 
NULL
);

53 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

54 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

55  
ERROR
;

57 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

58 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

59 
d©a
->
c_middË
,

60 (
d©a
->
c_middË
), 
NULL
);

61 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

62 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

63  
ERROR
;

65 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

66 
i
++, 
SQL_PARAM_INPUT_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

67 
d©a
->
c_Ï¡
,

68 (
d©a
->
c_Ï¡
), 
NULL
);

69 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

70 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

71  
ERROR
;

73 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

74 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

75 &
d©a
->
c_b®ªû
, 0, 
NULL
);

76 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

77 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

78  
ERROR
;

80 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

81 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

82 &
d©a
->
o_id
, 0, 
NULL
);

83 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

84 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

85  
ERROR
;

87 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

88 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

89 &
d©a
->
o_ÿ¼›r_id
, 0, 
NULL
);

90 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

91 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

92  
ERROR
;

94 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

95 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

96 
d©a
->
o_’Œy_d
,

97 (
d©a
->
o_’Œy_d
), 
NULL
);

98 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

99 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

100  
ERROR
;

102 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

103 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

104 &
d©a
->
o_Ş_út
, 0, 
NULL
);

105 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

106 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

107  
ERROR
;

109 
j
 = 0; j < 
O_OL_CNT_MAX
; j++) {

110 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

111 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

112 &
d©a
->
Üd”_lše
[
j
].
Ş_suµly_w_id
, 0, 
NULL
);

113 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

114 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

115  
ERROR
;

117 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

118 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

119 &
d©a
->
Üd”_lše
[
j
].
Ş_i_id
, 0, 
NULL
);

120 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

121 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

122  
ERROR
;

124 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

125 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

126 &
d©a
->
Üd”_lše
[
j
].
Ş_quªt™y
, 0, 
NULL
);

127 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

128 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

129  
ERROR
;

131 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

132 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

133 &
d©a
->
Üd”_lše
[
j
].
Ş_amouÁ
, 0, 
NULL
);

134 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

135 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

136  
ERROR
;

138 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

139 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

140 
d©a
->
Üd”_lše
[
j
].
Ş_d–iv”y_d
,

141 (
d©a
->
Üd”_lše
[
j
].
Ş_d–iv”y_d
), 
NULL
);

142 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

143 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

144  
ERROR
;

149 
rc
 = 
	`SQLExecu‹
(
odbcc
->
h¡mt
);

150 ià(
	`check_odbc_rc
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
, 
rc
è=ğ
ERROR
) {

151 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

152  
ERROR
;

155  
OK
;

156 
	}
}

	@odbc/dbc_payment.c

11 
	~<odbc_·ym’t.h
>

13 
	$execu‹_·ym’t
(
db_cÚ‹xt_t
 *
odbcc
, 
·ym’t_t
 *
d©a
)

15 
SQLRETURN
 
rc
;

16 
i
 = 1;

19 
rc
 = 
	`SQLP»·»
(
odbcc
->
h¡mt
, 
STMT_PAYMENT
, 
SQL_NTS
);

20 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

21 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

22  
ERROR
;

26 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

27 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

28 &
d©a
->
w_id
, 0, 
NULL
);

29 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

30 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

31  
ERROR
;

33 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

34 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

35 &
d©a
->
d_id
, 0, 
NULL
);

36 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

37 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

38  
ERROR
;

40 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

41 
i
++, 
SQL_PARAM_INPUT_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

42 &
d©a
->
c_id
, 0, 
NULL
);

43 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

44 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

45  
ERROR
;

47 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

48 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

49 &
d©a
->
c_w_id
, 0, 
NULL
);

50 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

51 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

52  
ERROR
;

54 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

55 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

56 &
d©a
->
c_d_id
, 0, 
NULL
);

57 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

58 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

59  
ERROR
;

61 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

62 
i
++, 
SQL_PARAM_INPUT_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

63 
d©a
->
c_Ï¡
, (d©a->c_Ï¡), 
NULL
);

64 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

65 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

66  
ERROR
;

68 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

69 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

70 &
d©a
->
h_amouÁ
, 0, 
NULL
);

71 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

72 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

73  
ERROR
;

75 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

76 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

77 
d©a
->
w_Çme
, (d©a->w_Çme), 
NULL
);

78 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

79 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

80  
ERROR
;

82 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

83 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

84 
d©a
->
w_¡»‘_1
, (d©a->w_¡»‘_1), 
NULL
);

85 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

86 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

87  
ERROR
;

89 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

90 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

91 
d©a
->
w_¡»‘_2
, (d©a->w_¡»‘_2), 
NULL
);

92 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

93 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

94  
ERROR
;

96 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

97 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

98 
d©a
->
w_c™y
, (d©a->w_c™y), 
NULL
);

99 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

100 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

101  
ERROR
;

103 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

104 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

105 
d©a
->
w_¡©e
, (d©a->w_¡©e), 
NULL
);

106 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

107 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

108  
ERROR
;

110 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

111 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

112 
d©a
->
w_z
, (d©a->w_z), 
NULL
);

113 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

114 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

115  
ERROR
;

117 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

118 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

119 
d©a
->
d_Çme
, (d©a->d_Çme), 
NULL
);

120 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

121 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

122  
ERROR
;

124 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

125 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

126 
d©a
->
d_¡»‘_1
, (d©a->d_¡»‘_1), 
NULL
);

127 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

128 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

129  
ERROR
;

131 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

132 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

133 
d©a
->
d_¡»‘_2
, (d©a->d_¡»‘_2), 
NULL
);

134 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

135 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

136  
ERROR
;

138 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

139 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

140 
d©a
->
d_c™y
, (d©a->d_c™y), 
NULL
);

141 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

142 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

143  
ERROR
;

145 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

146 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

147 
d©a
->
d_¡©e
, (d©a->d_¡©e), 
NULL
);

148 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

149 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

150  
ERROR
;

152 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

153 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

154 
d©a
->
d_z
, (d©a->d_z), 
NULL
);

155 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

156 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

157  
ERROR
;

159 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

160 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

161 
d©a
->
c_fœ¡
, (d©a->c_fœ¡), 
NULL
);

162 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

163 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

164  
ERROR
;

166 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

167 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

168 
d©a
->
c_middË
, (d©a->c_middË), 
NULL
);

169 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

170 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

171  
ERROR
;

173 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

174 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

175 
d©a
->
c_¡»‘_1
, (d©a->c_¡»‘_1), 
NULL
);

176 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

177 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

178  
ERROR
;

180 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

181 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

182 
d©a
->
c_¡»‘_2
, (d©a->c_¡»‘_2), 
NULL
);

183 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

184 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

185  
ERROR
;

187 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

188 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

189 
d©a
->
c_c™y
, (d©a->c_c™y), 
NULL
);

190 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

191 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

192  
ERROR
;

194 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

195 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

196 
d©a
->
c_¡©e
, (d©a->c_¡©e), 
NULL
);

197 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

198 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

199  
ERROR
;

201 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

202 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

203 
d©a
->
c_z
, (d©a->c_z), 
NULL
);

204 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

205 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

206  
ERROR
;

208 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

209 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

210 
d©a
->
c_phÚe
, (d©a->c_phÚe), 
NULL
);

211 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

212 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

213  
ERROR
;

215 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

216 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_VARCHAR
, 0, 0,

217 
d©a
->
c_sšû
, (d©a->c_sšû), 
NULL
);

218 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

219 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

220  
ERROR
;

222 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

223 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

224 
d©a
->
c_üed™
, (d©a->c_üed™), 
NULL
);

225 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

226 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

227  
ERROR
;

229 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

230 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

231 &
d©a
->
c_üed™_lim
, 0, 
NULL
);

232 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

233 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

234  
ERROR
;

236 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

237 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

238 &
d©a
->
c_discouÁ
, 0, 
NULL
);

239 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

240 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

241  
ERROR
;

243 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

244 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_DOUBLE
, 
SQL_DOUBLE
, 0, 0,

245 &
d©a
->
c_b®ªû
, 0, 
NULL
);

246 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

247 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

248  
ERROR
;

250 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

251 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_CHAR
, 
SQL_CHAR
, 0, 0,

252 
d©a
->
c_d©a
, (d©a->c_d©a), 
NULL
);

253 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

254 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

255  
ERROR
;

259 
rc
 = 
	`SQLExecu‹
(
odbcc
->
h¡mt
);

260 ià(
	`check_odbc_rc
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
, 
rc
è=ğ
ERROR
) {

261 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

262  
ERROR
;

265  
OK
;

266 
	}
}

	@odbc/dbc_stock_level.c

11 
	~"odbc_¡ock_Ëv–.h
"

13 
	$execu‹_¡ock_Ëv–
(
db_cÚ‹xt_t
 *
odbcc
, 
¡ock_Ëv–_t
 *
d©a
)

15 
SQLRETURN
 
rc
;

16 
i
 = 1;

19 
rc
 = 
	`SQLP»·»
(
odbcc
->
h¡mt
, 
STMT_STOCK_LEVEL
, 
SQL_NTS
);

20 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

21 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

22  
ERROR
;

26 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

27 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

28 &
d©a
->
w_id
, 0, 
NULL
);

29 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

30 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

31  
ERROR
;

33 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

34 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

35 &
d©a
->
d_id
, 0, 
NULL
);

36 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

37 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

38  
ERROR
;

40 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

41 
i
++, 
SQL_PARAM_INPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

42 &
d©a
->
th»shŞd
, 0, 
NULL
);

43 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

44 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

45  
ERROR
;

47 
rc
 = 
	`SQLBšdP¬am‘”
(
odbcc
->
h¡mt
,

48 
i
++, 
SQL_PARAM_OUTPUT
, 
SQL_C_SLONG
, 
SQL_INTEGER
, 0, 0,

49 &
d©a
->
low_¡ock
, 0, 
NULL
);

50 ià(
rc
 !ğ
SQL_SUCCESS
 &&„ø!ğ
SQL_SUCCESS_WITH_INFO
) {

51 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

52  
ERROR
;

56 
rc
 = 
	`SQLExecu‹
(
odbcc
->
h¡mt
);

57 ià(
	`check_odbc_rc
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
, 
rc
è=ğ
ERROR
) {

58 
	`LOG_ODBC_ERROR
(
SQL_HANDLE_STMT
, 
odbcc
->
h¡mt
);

59  
ERROR
;

62  
OK
;

63 
	}
}

	@sqlite/dbc_common.c

11 
	~"commÚ.h
"

12 
	~"loggšg.h
"

13 
	~"sql™e_commÚ.h
"

14 
	~<¡dio.h
>

15 
	#_GNU_SOURCE


	)

16 
	~<¡ršg.h
>

19 
	gsql™e_dbÇme
[256] = "./dbt2.sqlite";

21 
	$comm™_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

23 ià(
dbc
->
šT¿n§ùiÚ
)

25 ià(
	`sql™e3_exec
(
dbc
->
db
, "COMMIT TRANSACTION;", 
NULL
, NULL, NULLè!ğ
SQLITE_OK
)

27 
	`LOG_ERROR_MESSAGE
("COMMIT TRANSACTION;\nsql™»pÜts: %d %s", 
	`sql™e3_”rcode
(
dbc
->
db
), 
	`sql™e3_”rmsg
(dbc->db));

28  
ERROR
;

30 
dbc
->
šT¿n§ùiÚ
 = 0;

31 #ifdeà
DEBUG_QUERY


32 
	`LOG_ERROR_MESSAGE
("COMMIT TRANSACTION;\n");

36  
OK
;

37 
	}
}

40 
	$_cÚÃù_to_db
(
db_cÚ‹xt_t
 *
dbc
)

42 
rc
;

44 
rc
 = 
	`sql™e3_İ’
(
sql™e_dbÇme
, &
dbc
->
db
);

45 
dbc
->
šT¿n§ùiÚ
 = 0;

46 ià(
rc
) {

47 
	`LOG_ERROR_MESSAGE
("CÚÃùiÚØd©aba£ '%s' faed (”rÜ cod%d).", 
sql™e_dbÇme
, 
rc
);

48 
	`sql™e3_şo£
(
dbc
->
db
);

49  
ERROR
;

52  
OK
;

53 
	}
}

56 
	$_discÚÃù_äom_db
(
db_cÚ‹xt_t
 *
dbc
)

58 
	`sql™e3_şo£
(
dbc
->
db
);

59  
OK
;

60 
	}
}

62 
	$_db_š™
(* 
_dbÇme
)

65 ià(
_dbÇme
 !ğ
NULL
) {

66 
	`¡rıy
(
sql™e_dbÇme
, 
_dbÇme
);

68  
OK
;

69 
	}
}

71 
	$rŞlback_Œª§ùiÚ
(
db_cÚ‹xt_t
 *
dbc
)

73 
	`LOG_ERROR_MESSAGE
("ROLLBACK INITIATED\n");

75 ià(
dbc
->
šT¿n§ùiÚ
)

77 ià(
	`sql™e3_exec
(
dbc
->
db
, "ROLLBACK TRANSACTION;", 
NULL
, NULL, NULLè!ğ
SQLITE_OK
)

79 
	`LOG_ERROR_MESSAGE
("ROLLBACK TRANSACTION;\nsql™»pÜts: %d %s", 
	`sql™e3_”rcode
(
dbc
->
db
), 
	`sql™e3_”rmsg
(dbc->db));

80  
ERROR
;

82 
dbc
->
šT¿n§ùiÚ
 = 0;

85  
STATUS_ROLLBACK
;

86 
	}
}

88 
	$dbt2_sql_execu‹
(
db_cÚ‹xt_t
 *
dbc
, * 
qu”y
, 
sql_»suÉ_t
 * 
sql_»suÉ
,

89 * 
qu”y_Çme
)

91 
sql_»suÉ
->
”rÜ
 = 0;

92 
sql_»suÉ
->
qu”y_ruÂšg
 = 0;

93 
sql_»suÉ
->
´eãtched
 = 0;

95 ià(!
dbc
->
šT¿n§ùiÚ
)

97 ià(
	`sql™e3_exec
(
dbc
->
db
, "BEGIN TRANSACTION;", 
NULL
, NULL, NULLè!ğ
SQLITE_OK
)

99 
	`LOG_ERROR_MESSAGE
("%s: BEGIN TRANSACTION;\nsql™»pÜts: %d %s", 
qu”y_Çme
, 
	`sql™e3_”rcode
(
dbc
->
db
), 
	`sql™e3_”rmsg
(dbc->db));

102 
dbc
->
šT¿n§ùiÚ
 = 1;

105 ià(
	`sql™e3_´•¬e_v2
(
dbc
->
db
, 
qu”y
, 
	`¡¾’
(qu”y)+1, &
sql_»suÉ
->
pStmt
, 
NULL
è!ğ
SQLITE_OK
)

107 
	`LOG_ERROR_MESSAGE
("%s: %s\nsql™»pÜts: %d %s",
qu”y_Çme
, 
qu”y
,

108 
	`sql™e3_”rcode
(
dbc
->
db
), 
	`sql™e3_”rmsg
(dbc->db));

109 
	`sql™e3_fš®ize
(
sql_»suÉ
->
pStmt
);

112 
sql_»suÉ
->
num_f›lds
 = 
	`sql™e3_cŞumn_couÁ
(sql_»suÉ->
pStmt
);

113 
sql_»suÉ
->
qu”y_ruÂšg
 = 1;

114 
	`dbt2_sql_ãtchrow
(
dbc
, 
sql_»suÉ
);

115 ià(
sql_»suÉ
->
”rÜ
)

119 
sql_»suÉ
->
´eãtched
 = 1;

121 
	}
}

123 
	$dbt2_sql_ãtchrow
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
)

125 
rc
;

127 ià(!
sql_»suÉ
->
qu”y_ruÂšg
)

132 ià(
sql_»suÉ
->
´eãtched
)

134 
sql_»suÉ
->
´eãtched
 = 0;

138 
rc
 = 
	`sql™e3_¡•
(
sql_»suÉ
->
pStmt
);

140 ià(
rc
 =ğ
SQLITE_ROW
)

144 ià(
rc
 =ğ
SQLITE_DONE
)

146 
rc
 = 
	`sql™e3_fš®ize
(
sql_»suÉ
->
pStmt
);

147 ià(
rc
 !ğ
SQLITE_OK
)

149 
sql_»suÉ
->
”rÜ
 = 1;

151 
sql_»suÉ
->
qu”y_ruÂšg
 = 0;

156 
	`LOG_ERROR_MESSAGE
("SQLITEƒ¼Ü %d: %s\n", 
rc
, 
	`sql™e3_”rmsg
(
dbc
->
db
));

157 
sql_»suÉ
->
”rÜ
 = 1;

158 
	`sql™e3_fš®ize
(
sql_»suÉ
->
pStmt
);

159 
sql_»suÉ
->
qu”y_ruÂšg
 = 0;

162 
	}
}

164 
	$dbt2_sql_şo£_cursÜ
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
)

166 
rc
;

168 ià(
sql_»suÉ
->
qu”y_ruÂšg
)

170 
sql_»suÉ
->
qu”y_ruÂšg
 = 0;

171 
rc
 = 
	`sql™e3_fš®ize
(
sql_»suÉ
->
pStmt
);

172 ià(
rc
 !ğ
SQLITE_OK
 || 
sql_»suÉ
->
”rÜ
)

179 
	}
}

182 * 
	$dbt2_sql_g‘v®ue
(
db_cÚ‹xt_t
 *
dbc
, 
sql_»suÉ_t
 * 
sql_»suÉ
, 
f›ld
)

184 * 
tmp
;

186 
tmp
ğ
NULL
;

187 ià(
sql_»suÉ
->
qu”y_ruÂšg
 && 
f›ld
 < sql_»suÉ->
num_f›lds
)

189 
tmp
 = 
	`¡ºdup
(
	`sql™e3_cŞumn_‹xt
(
sql_»suÉ
->
pStmt
, 
f›ld
), 
	`sql™e3_cŞumn_by‹s
(sql_result->pStmt, field));

190 ià(!
tmp
)

192 #ifdeà
DEBUG_QUERY


193 
	`LOG_ERROR_MESSAGE
("dbt2_sql_g‘v®ue: v¬[%d]=NULL\n", 
f›ld
);

199 #ifdeà
DEBUG_QUERY


200 
	`LOG_ERROR_MESSAGE
("dbt2_sql_getvalue: POSSIBLE NULL VALUE or ERROR\nQuery: %s\nField: %d from %d",

201 
	`sql™e3_sql
(
sql_»suÉ
->
pStmt
), 
f›ld
, sql_»suÉ->
num_f›lds
);

205  
tmp
;

206 
	}
}

	@transaction_data.c

10 
	~<Œª§ùiÚ_d©a.h
>

11 
	~<±h»ad.h
>

13 
±h»ad_mu‹x_t
 
	gmut
 = 
PTHREAD_MUTEX_INITIALIZER
;

14 
	ud©a_poš‹r_t


16 
d–iv”y_t
 *
	mde
;

17 
Ãw_Üd”_t
 *
	mno
;

18 
Üd”_¡©us_t
 *
	mos
;

19 
·ym’t_t
 *
	m·
;

20 
¡ock_Ëv–_t
 *
	m¦
;

23 
	$dump
(
FILE
 *
å
, 
ty³
, *
d©a
)

25 
i
;

26 
d©a_poš‹r_t
 
±r
;

28 
ty³
) {

29 
DELIVERY
:

30 
±r
.
de
 = (
d–iv”y_t
 *è
d©a
;

31 
	`±h»ad_mu‹x_lock
(&
mut
);

32 
	`årštf
(
å
, "w_id = %d\n", 
±r
.
de
->
w_id
);

33 
	`årštf
(
å
, "o_ÿ¼›r_id = %d\n", 
±r
.
de
->
o_ÿ¼›r_id
);

34 
	`±h»ad_mu‹x_uÆock
(&
mut
);

36 
NEW_ORDER
:

37 
±r
.
no
 = (
Ãw_Üd”_t
 *è
d©a
;

38 
	`±h»ad_mu‹x_lock
(&
mut
);

39 
	`årštf
(
å
, "w_id = %d\n", 
±r
.
no
->
w_id
);

40 
	`årštf
(
å
, "w_x = %0.4f\n", 
±r
.
no
->
w_x
);

41 
	`årštf
(
å
, "d_id = %d\n", 
±r
.
no
->
d_id
);

42 
	`årštf
(
å
, "d_x = %0.4f\n", 
±r
.
no
->
d_x
);

43 
	`årštf
(
å
, "c_id = %d\n", 
±r
.
no
->
c_id
);

44 
	`årštf
(
å
, "c_Ï¡ = %s\n", 
±r
.
no
->
c_Ï¡
);

45 
	`årštf
(
å
, "c_üed™ = %s\n", 
±r
.
no
->
c_üed™
);

46 
	`årštf
(
å
, "c_discouÁ = %0.4f\n", 
±r
.
no
->
c_discouÁ
);

47 
	`årštf
(
å
, "o_®l_loÿÈğ%d\n", 
±r
.
no
->
o_®l_loÿl
);

48 
	`årštf
(
å
, "o_Ş_úˆğ%d\n", 
±r
.
no
->
o_Ş_út
);

49 
	`årštf
(
å
, "%-2s %-7s %-24s %-9s %-14s %-11s %-10s %-10s\n",

53 
	`årštf
(
å
, "%-2s %-7s %-24s %-9s %-14s %-11s %-10s %-10s\n",

55 
i
 = 0; i < 
±r
.
no
->
o_Ş_út
; i++) {

56 
	`årštf
(
å
,

58 
i
 + 1,

59 
±r
.
no
->
Üd”_lše
[
i
].
Ş_i_id
,

60 
±r
.
no
->
Üd”_lše
[
i
].
i_Çme
,

61 
±r
.
no
->
Üd”_lše
[
i
].
i_´iû
,

62 
±r
.
no
->
Üd”_lše
[
i
].
Ş_suµly_w_id
,

63 
±r
.
no
->
Üd”_lše
[
i
].
Ş_quªt™y
,

64 
±r
.
no
->
Üd”_lše
[
i
].
s_quªt™y
,

65 
±r
.
no
->
Üd”_lše
[
i
].
Ş_amouÁ
);

67 
	`årštf
(
å
, "o_id = %d\n", 
±r
.
no
->
o_id
);

68 
	`årštf
(
å
, "tÙ®_amouÁ = %0.2f\n", 
±r
.
no
->
tÙ®_amouÁ
);

69 
	`±h»ad_mu‹x_uÆock
(&
mut
);

70 
	`±h»ad_mu‹x_uÆock
(&
mut
);

72 
ORDER_STATUS
:

73 
±r
.
os
 = (
Üd”_¡©us_t
 *è
d©a
;

74 
	`±h»ad_mu‹x_lock
(&
mut
);

75 
	`årštf
(
å
, "c_id = %d\n", 
±r
.
os
->
c_id
);

76 
	`årštf
(
å
, "c_w_id = %d\n", 
±r
.
os
->
c_w_id
);

77 
	`årštf
(
å
, "c_d_id = %d\n", 
±r
.
os
->
c_d_id
);

78 
	`årštf
(
å
, "c_fœ¡ = %s\n", 
±r
.
os
->
c_fœ¡
);

79 
	`årštf
(
å
, "c_middË = %s\n", 
±r
.
os
->
c_middË
);

80 
	`årštf
(
å
, "c_Ï¡ = %s\n", 
±r
.
os
->
c_Ï¡
);

81 
	`årštf
(
å
, "c_b®ªû = %0.2f\n", 
±r
.
os
->
c_b®ªû
);

82 
	`årštf
(
å
, "o_id = %d\n", 
±r
.
os
->
o_id
);

83 
	`årštf
(
å
, "o_ÿ¼›r_id = %d\n", 
±r
.
os
->
o_ÿ¼›r_id
);

84 
	`årštf
(
å
, "o_’Œy_d = %s\n", 
±r
.
os
->
o_’Œy_d
);

85 
	`årštf
(
å
, "o_Ş_úˆğ%d\n", 
±r
.
os
->
o_Ş_út
);

86 
	`årštf
(
å
, "## ol_i_id ol_supply_w_id ol_quantity ol_amount ol_delivery_d\n");

87 
i
 = 0; i < 
±r
.
os
->
o_Ş_út
; i++) {

88 
	`årštf
(
å
, "%2d %7d %14d %11d %9.2à %s\n", 
i
,

89 
±r
.
os
->
Üd”_lše
[
i
].
Ş_i_id
,

90 
±r
.
os
->
Üd”_lše
[
i
].
Ş_suµly_w_id
,

91 
±r
.
os
->
Üd”_lše
[
i
].
Ş_quªt™y
,

92 
±r
.
os
->
Üd”_lše
[
i
].
Ş_amouÁ
,

93 
±r
.
os
->
Üd”_lše
[
i
].
Ş_d–iv”y_d
);

95 
	`±h»ad_mu‹x_uÆock
(&
mut
);

97 
PAYMENT
:

98 
±r
.
·
 = (
·ym’t_t
 *è
d©a
;

99 
	`±h»ad_mu‹x_lock
(&
mut
);

100 
	`årštf
(
å
, "w_id = %d\n", 
±r
.
·
->
w_id
);

101 
	`årštf
(
å
, "w_Çmğ%s\n", 
±r
.
·
->
w_Çme
);

102 
	`årštf
(
å
, "w_¡»‘_1 = %s\n", 
±r
.
·
->
w_¡»‘_1
);

103 
	`årštf
(
å
, "w_¡»‘_2 = %s\n", 
±r
.
·
->
w_¡»‘_2
);

104 
	`årštf
(
å
, "w_c™y = %s\n", 
±r
.
·
->
w_c™y
);

105 
	`årštf
(
å
, "w_¡©ğ%s\n", 
±r
.
·
->
w_¡©e
);

106 
	`årštf
(
å
, "w_z = %s\n", 
±r
.
·
->
w_z
);

107 
	`årštf
(
å
, "d_id = %d\n", 
±r
.
·
->
d_id
);

108 
	`årštf
(
å
, "d_Çmğ%s\n", 
±r
.
·
->
d_Çme
);

109 
	`årštf
(
å
, "d_¡»‘_1 = %s\n", 
±r
.
·
->
d_¡»‘_1
);

110 
	`årštf
(
å
, "d_¡»‘_2 = %s\n", 
±r
.
·
->
d_¡»‘_2
);

111 
	`årštf
(
å
, "d_c™y = %s\n", 
±r
.
·
->
d_c™y
);

112 
	`årštf
(
å
, "d_¡©ğ%s\n", 
±r
.
·
->
d_¡©e
);

113 
	`årštf
(
å
, "d_z = %s\n", 
±r
.
·
->
d_z
);

114 
	`årštf
(
å
, "c_id = %d\n", 
±r
.
·
->
c_id
);

115 
	`årštf
(
å
, "c_Ï¡ = %s\n", 
±r
.
·
->
c_Ï¡
);

116 
	`årštf
(
å
, "c_w_id = %d\n", 
±r
.
·
->
c_w_id
);

117 
	`årštf
(
å
, "c_d_id = %d\n", 
±r
.
·
->
c_d_id
);

118 
	`årštf
(
å
, "c_fœ¡ = %s\n", 
±r
.
·
->
c_fœ¡
);

119 
	`årštf
(
å
, "c_middË = %s\n", 
±r
.
·
->
c_middË
);

120 
	`årštf
(
å
, "c_¡»‘_1 = %s\n", 
±r
.
·
->
c_¡»‘_1
);

121 
	`årštf
(
å
, "c_¡»‘_2 = %s\n", 
±r
.
·
->
c_¡»‘_2
);

122 
	`årštf
(
å
, "c_c™y = %s\n", 
±r
.
·
->
c_c™y
);

123 
	`årštf
(
å
, "c_¡©ğ%s\n", 
±r
.
·
->
c_¡©e
);

124 
	`årštf
(
å
, "c_z = %s\n", 
±r
.
·
->
c_z
);

125 
	`årštf
(
å
, "c_phÚğ%s\n", 
±r
.
·
->
c_phÚe
);

126 
	`årštf
(
å
, "c_sšû = %s\n", 
±r
.
·
->
c_sšû
);

127 
	`årštf
(
å
, "c_üed™ = %s\n", 
±r
.
·
->
c_üed™
);

128 
	`årštf
(
å
, "c_üed™_lim = %0.2f\n", 
±r
.
·
->
c_üed™_lim
);

129 
	`årštf
(
å
, "c_discouÁ = %0.4f\n", 
±r
.
·
->
c_discouÁ
);

130 
	`årštf
(
å
, "c_b®ªû = %0.2f\n", 
±r
.
·
->
c_b®ªû
);

131 
	`årštf
(
å
, "c_d©¨ğ%s\n", 
±r
.
·
->
c_d©a
);

132 
	`årštf
(
å
, "h_amouÁ = %0.2f\n", 
±r
.
·
->
h_amouÁ
);

133 
	`±h»ad_mu‹x_uÆock
(&
mut
);

135 
STOCK_LEVEL
:

136 
±r
.
¦
 = (
¡ock_Ëv–_t
 *è
d©a
;

137 
	`±h»ad_mu‹x_lock
(&
mut
);

138 
	`årštf
(
å
, "w_id = %d\n", 
±r
.
¦
->
w_id
);

139 
	`årštf
(
å
, "d_id = %d\n", 
±r
.
¦
->
d_id
);

140 
	`årštf
(
å
, "th»shŞd = %d\n", 
±r
.
¦
->
th»shŞd
);

141 
	`årštf
(
å
, "low_¡ock = %d\n", 
±r
.
¦
->
low_¡ock
);

142 
	`±h»ad_mu‹x_uÆock
(&
mut
);

145  
ERROR
;

147  
OK
;

148 
	}
}

	@transaction_queue.c

10 
	~<commÚ.h
>

11 
	~<loggšg.h
>

12 
	~<Œª§ùiÚ_queue.h
>

13 #ifdeà
DEBUG


14 
	~<uni¡d.h
>

15 
	~<¡ršg.h
>

17 
dump_queue
();

20 
£m_t
 
	gqueue_Ëngth
;

21 
Œª§ùiÚ_queue_node_t
 *
	gŒª§ùiÚ_h—d
, *
	gŒª§ùiÚ_
;

22 
±h»ad_mu‹x_t
 
	gmu‹x_queue
 = 
PTHREAD_MUTEX_INITIALIZER
;

23 
	gŒª§ùiÚ_id
;

24 
	gŒª§ùiÚ_couÁ”
[2][
TRANSACTION_MAX
] = {

28 
±h»ad_mu‹x_t
 
	gmu‹x_Œª§ùiÚ_couÁ”
[2][
TRANSACTION_MAX
] = {

29 { 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

30 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

31 
PTHREAD_MUTEX_INITIALIZER
 },

32 { 
PTHREAD_MUTEX_INITIALIZER
,

33 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER,

34 
PTHREAD_MUTEX_INITIALIZER
, PTHREAD_MUTEX_INITIALIZER }

37 #ifdeà
DEBUG


38 
	$dump_queue
()

40 
Œª§ùiÚ_queue_node_t
 *
node
;

41 
li¡
[1024] = "";

42 
Œªs
[2] = "a";

44 
node
 = 
Œª§ùiÚ_h—d
;

45 
	`¡rÿt
(
li¡
, "HEAD");

46 
node
 !ğ
NULL
) {

47 
	`¡rÿt
(
li¡
, " <- ");

48 
Œªs
[0] =

49 
Œª§ùiÚ_shÜt_Çme
[
node
->
ş›Á_d©a
.
Œª§ùiÚ
];

50 
	`¡rÿt
(
li¡
, 
Œªs
);

51 
node
 =‚ode->
Ãxt
;

53 
	`¡rÿt
(
li¡
, " <- TAIL");

54 
	`LOG_ERROR_MESSAGE
(
li¡
);

56  
OK
;

57 
	}
}

61 
Œª§ùiÚ_queue_node_t
 *
	$dequeue_Œª§ùiÚ
()

63 
Œª§ùiÚ_queue_node_t
 *
node
;

65 
	`£m_wa™
(&
queue_Ëngth
);

66 
	`±h»ad_mu‹x_lock
(&
mu‹x_queue
);

67 
node
 = 
Œª§ùiÚ_h—d
;

68 ià(
Œª§ùiÚ_h—d
 =ğ
NULL
) {

69 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_queue
);

70  
NULL
;

71 } ià(
Œª§ùiÚ_h—d
->
Ãxt
 =ğ
NULL
) {

72 
Œª§ùiÚ_h—d
 = 
Œª§ùiÚ_
 = 
NULL
;

74 
Œª§ùiÚ_h—d
 =¿n§ùiÚ_h—d->
Ãxt
;

76 #ifdeà
DEBUG


77 
	`LOG_ERROR_MESSAGE
("dequeu[%d] %øŒª§ùiÚ", 
node
->
id
,

78 
Œª§ùiÚ_shÜt_Çme
[
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

79 
	`dump_queue
();

81 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_queue
);

83 
	`±h»ad_mu‹x_lock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_QUEUED
][

84 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

85 --
Œª§ùiÚ_couÁ”
[
REQ_QUEUED
][
node
->
ş›Á_d©a
.
Œª§ùiÚ
];

86 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_QUEUED
][

87 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

88 
	`±h»ad_mu‹x_lock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_EXECUTING
][

89 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

90 ++
Œª§ùiÚ_couÁ”
[
REQ_EXECUTING
][
node
->
ş›Á_d©a
.
Œª§ùiÚ
];

91 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_EXECUTING
][

92 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

94  
node
;

95 
	}
}

98 
	$’queue_Œª§ùiÚ
(
Œª§ùiÚ_queue_node_t
 *
node
)

100 
	`±h»ad_mu‹x_lock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_QUEUED
][

101 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

102 ++
Œª§ùiÚ_couÁ”
[
REQ_QUEUED
][
node
->
ş›Á_d©a
.
Œª§ùiÚ
];

103 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_Œª§ùiÚ_couÁ”
[
REQ_QUEUED
][

104 
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

106 
	`±h»ad_mu‹x_lock
(&
mu‹x_queue
);

107 
node
->
Ãxt
 = 
NULL
;

108 
node
->
id
 = ++
Œª§ùiÚ_id
;

109 ià(
Œª§ùiÚ_
 !ğ
NULL
) {

110 
Œª§ùiÚ_
->
Ãxt
 = 
node
;

111 
Œª§ùiÚ_
 = 
node
;

113 
Œª§ùiÚ_h—d
 = 
Œª§ùiÚ_
 = 
node
;

115 #ifdeà
DEBUG


116 
	`LOG_ERROR_MESSAGE
("’queu[%d] %øŒª§ùiÚ", 
node
->
id
,

117 
Œª§ùiÚ_shÜt_Çme
[
node
->
ş›Á_d©a
.
Œª§ùiÚ
]);

118 
	`dump_queue
();

120 
	`£m_po¡
(&
queue_Ëngth
);

121 
	`±h»ad_mu‹x_uÆock
(&
mu‹x_queue
);

123  
OK
;

124 
	}
}

126 
	$š™_Œª§ùiÚ_queue
()

128 
Œª§ùiÚ_id
 = 0;

129 
Œª§ùiÚ_h—d
 = 
Œª§ùiÚ_
 = 
NULL
;

130 ià(
	`£m_š™
(&
queue_Ëngth
, 0, 0) != 0) {

131 
	`LOG_ERROR_MESSAGE
("cannot init queue_length");

132  
ERROR
;

135  
OK
;

136 
	}
}

	@transaction_test.c

10 #ifdeà
HAVE_CONFIG_H


11 
	~<cÚfig.h
>

14 
	~<¡dio.h
>

15 
	~<¡ršg.h
>

16 
	~<¡ršgs.h
>

18 
	~"commÚ.h
"

19 
	~"ş›Á_š‹rçû.h
"

20 
	~"db.h
"

21 
	~"šput_d©a_g’”©Ü.h
"

22 
	~"loggšg.h
"

23 
	~"Œª§ùiÚ_d©a.h
"

25 #ifdeà
LIBPQ


26 
	gpo¡ma¡”_pÜt
[32];

28 
	gcÚÃù_¡r
[32] = "";

29 
	gmode_®‹»d
 = 0;

31 
	$maš
(
¬gc
, *
¬gv
[])

33 
i
;

34 
Œª§ùiÚ
 = -1;

35 
db_cÚ‹xt_t
 
dbc
;

36 
Œª§ùiÚ_d©a_t
 
Œª§ùiÚ_d©a
;

38 
pÜt
 = 0;

39 
sockfd
;

40 
ş›Á_Œª§ùiÚ_t
 
ş›Á_txn
;

42 
	`š™_commÚ
();

43 
	`š™_loggšg
();

45 ià(
¬gc
 < 3) {

46 
	`´štf
("usage: %s -d <connect string> -t d/n/o/p/s [-w #] [-c #] [-i #] [-o #] [-n #] [-p #]",

47 
¬gv
[0]);

48 #ifdeà
LIBPQ


49 
	`´štf
(" -l #");

51 
	`´štf
("\n\n");

52 
	`´štf
("-d <connect string>\n");

53 #ifdeà
ODBC


54 
	`´štf
("\tdatabase connect string\n");

56 #ifdeà
LIBPQ


57 
	`´štf
("\tdatabase hostname\n");

58 
	`´štf
("-l #\n");

59 
	`´štf
("\tport ofhe…ostmaster\n");

61 
	`´štf
("-t (d|n|o|p|s)\n");

62 
	`´štf
("\td = Delivery,‚ = New-Order, o = Order-Status,\n");

63 
	`´štf
("\tp = Payment, s = Stock-Level\n");

64 
	`´štf
("-w #\n");

65 
	`´štf
("\tnumber of warehouses, default 1\n");

66 
	`´štf
("-c #\n");

67 
	`´štf
("\tcustomer cardinality, default %d\n",

68 
CUSTOMER_CARDINALITY
);

69 
	`´štf
("-i #\n");

70 
	`´štf
("\t™em c¬dš®™y, deçuÉ %d\n", 
ITEM_CARDINALITY
);

71 
	`´štf
("-o #\n");

72 
	`´štf
("\tÜd” c¬dš®™y, deçuÉ %d\n", 
ORDER_CARDINALITY
);

73 
	`´štf
("-n #\n");

74 
	`´štf
("\tnew-order cardinality, default %d\n",

75 
NEW_ORDER_CARDINALITY
);

76 
	`´štf
("-p #\n");

77 
	`´štf
("\tport of client…rogram, if -d is used, -dakeshe‡ddress\n");

78 
	`´štf
("\tofhe client…rogram host system\n");

82 
i
 = 1; i < 
¬gc
; i += 2) {

83 ià(
	`¡¾’
(
¬gv
[
i
]) != 2) {

84 
	`´štf
("šv®id fÏg: %s\n", 
¬gv
[
i
]);

87 ià(
¬gv
[
i
][1] == 'd') {

88 
	`¡rıy
(
cÚÃù_¡r
, 
¬gv
[
i
 + 1]);

89 } ià(
¬gv
[
i
][1] == 't') {

90 ià(
¬gv
[
i
 + 1][0] == 'd') {

91 
Œª§ùiÚ
 = 
DELIVERY
;

92 } ià(
¬gv
[
i
 + 1][0] == 'n') {

93 
Œª§ùiÚ
 = 
NEW_ORDER
;

94 } ià(
¬gv
[
i
 + 1][0] == 'o') {

95 
Œª§ùiÚ
 = 
ORDER_STATUS
;

96 } ià(
¬gv
[
i
 + 1][0] == 'p') {

97 
Œª§ùiÚ
 = 
PAYMENT
;

98 } ià(
¬gv
[
i
 + 1][0] == 's') {

99 
Œª§ùiÚ
 = 
STOCK_LEVEL
;

101 
	`´štf
("unknownransaction: %s\n",

102 
¬gv
[
i
 + 1]);

105 } ià(
¬gv
[
i
][1] == 'w') {

106 
bË_ÿrdš®™y
.
w¬ehou£s
 = 
	`©oi
(
¬gv
[
i
 + 1]);

107 } ià(
¬gv
[
i
][1] == 'c') {

108 
bË_ÿrdš®™y
.
cu¡om”s
 = 
	`©oi
(
¬gv
[
i
 + 1]);

109 } ià(
¬gv
[
i
][1] == 'i') {

110 
bË_ÿrdš®™y
.
™ems
 = 
	`©oi
(
¬gv
[
i
 + 1]);

111 } ià(
¬gv
[
i
][1] == 'o') {

112 
bË_ÿrdš®™y
.
Üd”s
 = 
	`©oi
(
¬gv
[
i
 + 1]);

113 } ià(
¬gv
[
i
][1] == 'n') {

114 
bË_ÿrdš®™y
.
Ãw_Üd”s
 = 
	`©oi
(
¬gv
[
i
 + 1]);

115 } ià(
¬gv
[
i
][1] == 'p') {

116 
pÜt
 = 
	`©oi
(
¬gv
[
i
 + 1]);

117 #ifdeà
LIBPQ


118 } ià(
¬gv
[
i
][1] == 'l') {

119 
	`¡rıy
(
po¡ma¡”_pÜt
, 
¬gv
[
i
 + 1]);

122 
	`´štf
("šv®id fÏg: %s\n", 
¬gv
[
i
]);

127 ià(
	`¡¾’
(
cÚÃù_¡r
) == 0) {

128 
	`´štf
("-d flag was‚ot used.\n");

132 ià(
Œª§ùiÚ
 == -1) {

133 
	`´štf
("-t flag was‚ot used.\n");

138 
	`´štf
("\n");

139 
	`´štf
("databaseable cardinalities:\n");

140 
	`´štf
("w¬ehou£ ğ%d\n", 
bË_ÿrdš®™y
.
w¬ehou£s
);

141 
	`´štf
("di¡riù ğ%d\n", 
bË_ÿrdš®™y
.
di¡riùs
);

142 
	`´štf
("cu¡om” ğ%d\n", 
bË_ÿrdš®™y
.
cu¡om”s
);

143 
	`´štf
("™em ğ%d\n", 
bË_ÿrdš®™y
.
™ems
);

144 
	`´štf
("Üd” ğ%d\n", 
bË_ÿrdš®™y
.
Üd”s
);

145 
	`´štf
("¡ock = %d\n", 
bË_ÿrdš®™y
.
™ems
);

146 
	`´štf
("Ãw-Üd” ğ%d\n", 
bË_ÿrdš®™y
.
Ãw_Üd”s
);

147 
	`´štf
("\n");

149 
	`¤ªd
(
	`time
(
NULL
));

152 
	`bz”o
(&
Œª§ùiÚ_d©a
, (
Œª§ùiÚ_d©a_t
));

153 
Œª§ùiÚ
) {

154 
DELIVERY
:

155 
	`g’”©e_šput_d©a
(
DELIVERY
,

156 (*è&
Œª§ùiÚ_d©a
.
d–iv”y
,

157 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
w¬ehou£s
) + 1);

159 
NEW_ORDER
:

160 
	`g’”©e_šput_d©a
(
NEW_ORDER
,

161 (*è&
Œª§ùiÚ_d©a
.
Ãw_Üd”
,

162 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
w¬ehou£s
) + 1);

164 
ORDER_STATUS
:

165 
	`g’”©e_šput_d©a
(
ORDER_STATUS
,

166 (*è&
Œª§ùiÚ_d©a
.
Üd”_¡©us
,

167 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
w¬ehou£s
) + 1);

169 
PAYMENT
:

170 
	`g’”©e_šput_d©a
(
PAYMENT
, (*è&
Œª§ùiÚ_d©a
.
·ym’t
,

171 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
w¬ehou£s
) + 1);

173 
STOCK_LEVEL
:

174 
	`g’”©e_šput_d©a2
(
STOCK_LEVEL
,

175 (*è&
Œª§ùiÚ_d©a
.
¡ock_Ëv–
,

176 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
w¬ehou£s
) + 1,

177 
	`g‘_¿ndom
(
bË_ÿrdš®™y
.
di¡riùs
) + 1);

181 ià(
pÜt
 == 0) {

185 
	`´štf
("connecting directlyohe database...\n");

186 #ifdeà
ODBC


187 
	`db_š™
(
cÚÃù_¡r
, 
DB_USER
, 
DB_PASS
);

189 #ifdeà
LIBPQ


190 
	`db_š™
(
DB_NAME
, 
cÚÃù_¡r
, 
po¡ma¡”_pÜt
);

192 ià(
	`cÚÃù_to_db
(&
dbc
è!ğ
OK
) {

193 
	`´štf
("cannotƒstablish‡ database connection\n");

196 ià(
	`´oûss_Œª§ùiÚ
(
Œª§ùiÚ
, &
dbc
,

197 (*è&
Œª§ùiÚ_d©a
è!ğ
OK
) {

198 
	`discÚÃù_äom_db
(&
dbc
);

199 
	`´štf
("transaction failed\n");

202 
	`discÚÃù_äom_db
(&
dbc
);

205 
	`´štf
("cÚÃùšgØş›Á…rog¿m oÀpÜˆ%d...\n", 
pÜt
);

207 
sockfd
 = 
	`cÚÃù_to_ş›Á
(
cÚÃù_¡r
, 
pÜt
);

208 ià(
sockfd
 > 0) {

209 
	`´štf
("connectedo client\n");

212 
ş›Á_txn
.
Œª§ùiÚ
 =ransaction;

213 
	`memıy
(&
ş›Á_txn
.
Œª§ùiÚ_d©a
, &transaction_data,

214 (
Œª§ùiÚ_d©a_t
));

215 
	`´štf
("sendingransaction data...\n");

216 ià(
	`£nd_Œª§ùiÚ_d©a
(
sockfd
, &
ş›Á_txn
è!ğ
OK
) {

217 
	`´štf
("send_transaction_data()ƒrror\n");

221 
	`´štf
("receivingransaction data...\n");

222 ià(
	`»ûive_Œª§ùiÚ_d©a
(
sockfd
, &
ş›Á_txn
è!ğ
OK
) {

223 
	`´štf
("receive_transaction_data()ƒrror\n");

227 
	`memıy
(&
Œª§ùiÚ_d©a
, &
ş›Á_txn
.transaction_data,

228 (
Œª§ùiÚ_d©a_t
));

231 
	`dump
(
¡dout
, 
Œª§ùiÚ
, (*è&
Œª§ùiÚ_d©a
);

232 
	`´štf
("\ndone.\n");

235 
	}
}

	@
1
.
0
94
2057
_semaphore.c
_socket.c
client.c
client_interface.c
common.c
datagen.c
db.c
db_threadpool.c
driver.c
driver_main.c
drizzle/dbc_common.c
include/_semaphore.h
include/_socket.h
include/client_interface.h
include/common.h
include/db.h
include/db_threadpool.h
include/driver.h
include/drizzle_common.h
include/drizzle_delivery.h
include/drizzle_integrity.h
include/drizzle_new_order.h
include/drizzle_order_status.h
include/drizzle_payment.h
include/drizzle_stock_level.h
include/input_data_generator.h
include/libpq_common.h
include/libpq_delivery.h
include/libpq_integrity.h
include/libpq_new_order.h
include/libpq_order_status.h
include/libpq_payment.h
include/libpq_stock_level.h
include/listener.h
include/logging.h
include/mysql_common.h
include/mysql_delivery.h
include/mysql_integrity.h
include/mysql_new_order.h
include/mysql_order_status.h
include/mysql_payment.h
include/mysql_stock_level.h
include/nonsp_common.h
include/nonsp_delivery.h
include/nonsp_integrity.h
include/nonsp_new_order.h
include/nonsp_order_status.h
include/nonsp_payment.h
include/nonsp_stock_level.h
include/odbc_common.h
include/odbc_delivery.h
include/odbc_integrity.h
include/odbc_new_order.h
include/odbc_order_status.h
include/odbc_payment.h
include/odbc_stock_level.h
include/sqlite_common.h
include/transaction_data.h
include/transaction_queue.h
input_data_generator.c
libpq/dbc_common.c
libpq/dbc_delivery.c
libpq/dbc_integrity.c
libpq/dbc_new_order.c
libpq/dbc_order_status.c
libpq/dbc_payment.c
libpq/dbc_stock_level.c
listener.c
logging.c
mysql/dbc_common.c
mysql/dbc_delivery.c
mysql/dbc_integrity.c
mysql/dbc_new_order.c
mysql/dbc_order_status.c
mysql/dbc_payment.c
mysql/dbc_stock_level.c
nonsp/dbc_delivery.c
nonsp/dbc_integrity.c
nonsp/dbc_new_order.c
nonsp/dbc_nonsp.c
nonsp/dbc_order_status.c
nonsp/dbc_payment.c
nonsp/dbc_stock_level.c
odbc/dbc_common.c
odbc/dbc_delivery.c
odbc/dbc_integrity.c
odbc/dbc_new_order.c
odbc/dbc_order_status.c
odbc/dbc_payment.c
odbc/dbc_stock_level.c
sqlite/dbc_common.c
transaction_data.c
transaction_queue.c
transaction_test.c
